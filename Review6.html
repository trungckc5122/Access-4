<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Access 4 - Review Module 6</title>
    <style>
        :root {
            --primary: #2980b9; 
            --primary-dark: #1c5982; 
            --success: #27ae60;
            --error: #e74c3c; 
            --warning: #f1c40f; 
            --bg: #f4f7f9;
            --text: #2c3e50; 
            --card: #ffffff;
            --selection: #3498db;
            --selection-bg: #ebf5fb;
        }
        
        body { 
            font-family: 'Times New Roman', serif; 
            font-size: 13pt; 
            background-color: var(--bg); 
            color: var(--text); 
            margin: 0; 
            padding: 20px 20px 150px 20px;
            line-height: 1.6; 
        }
        
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
        }
        
        .sticky-bank { 
            position: sticky; 
            top: 15px; 
            z-index: 100;
            background-color: #fff; 
            padding: 15px; 
            border-radius: 10px; 
            margin-bottom: 25px; 
            border: 2px solid var(--primary); 
            display: flex; 
            flex-wrap: wrap; 
            gap: 10px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }
        
        .word-item { 
            background: #eef2f7; 
            border: 1px solid var(--primary); 
            color: var(--primary-dark); 
            padding: 6px 12px; 
            border-radius: 5px; 
            cursor: grab; 
            user-select: none; 
            transition: 0.2s; 
            font-size: 0.9em; 
            font-weight: 500;
        }
        
        .word-item.used { 
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        .word-item:hover:not(.used) { 
            background: var(--primary); 
            color: white; 
        }

        .exercise-card { 
            background: var(--card); 
            border-radius: 12px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); 
            padding: 25px; 
            margin-bottom: 30px; 
        }
        
        .exercise-title { 
            font-weight: bold; 
            font-size: 1.25em; 
            margin-bottom: 18px; 
            color: var(--primary-dark); 
            border-bottom: 2px solid #eee; 
            padding-bottom: 8px; 
        }
        
        .question-row { 
            margin-bottom: 18px; 
            line-height: 2.2; 
            border-bottom: 1px solid #f9f9f9; 
            padding-bottom: 10px; 
            position: relative; 
        }
        
        input[type="text"] { 
            border: none; 
            border-bottom: 2px solid #bdc3c7; 
            background: #fafafa; 
            padding: 2px 8px; 
            font-size: 1em; 
            transition: 0.2s; 
            outline: none;
            min-width: 60px; 
            border-radius: 4px 4px 0 0; 
            text-align: center; 
            font-family: 'Times New Roman';
            box-sizing: border-box;
        }
        
        input.letter-input { 
            width: 45px; 
            min-width: 45px; 
            max-width: 80px;
            text-transform: uppercase; 
            font-weight: bold; 
            color: var(--primary-dark); 
        }
        
        input.word-input { 
            min-width: 120px; 
            max-width: 800px;
            text-align: left; 
        }
        
        input.correct { 
            border-bottom-color: var(--success) !important; 
            background-color: #e8f8f5 !important; 
            color: #1e8449 !important; 
        }
        
        input.incorrect-marked { 
            border-bottom-color: var(--error) !important; 
            background-color: #fdedec !important; 
        }

        .row-btns { 
            display: inline-flex; 
            gap: 5px; 
            vertical-align: middle; 
            margin-left: 10px; 
        }
        
        .btn-small { 
            background: #eee; 
            border: 1px solid #ccc; 
            border-radius: 4px; 
            width: 28px; 
            height: 28px; 
            cursor: pointer; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 14px; 
            transition: 0.2s;
        }
        
        .btn-small:hover {
            background: #ddd;
        }
        
        .btn-small.active {
            background: #3498db;
            color: white;
            border-color: #2980b9;
        }
        
        .info-btn { 
            background: #95a5a6; 
            color: white; 
            border: none; 
            border-radius: 50%; 
            width: 20px; 
            height: 20px; 
            font-size: 11px; 
            cursor: pointer; 
            display: inline-flex; 
            align-items: center; 
            justify-content: center; 
            transition: 0.2s;
        }
        
        .info-btn:hover {
            background: #7f8c8d;
        }
        
        .info-btn.active {
            background: #5d6d6e;
        }
        
        .hint-box { 
            display: none; 
            margin-top: 8px; 
            padding: 10px; 
            background-color: #fef9e7; 
            border-left: 4px solid var(--warning); 
            color: #7d6608; 
            border-radius: 4px; 
            font-size: 0.85em; 
        }
        
        .controls-row { 
            display: flex; 
            justify-content: flex-end; 
            gap: 10px; 
            margin-top: 15px; 
        }
        
        .btn { 
            padding: 8px 20px; 
            border-radius: 6px; 
            cursor: pointer; 
            border: none; 
            font-weight: bold; 
            transition: 0.3s; 
        }
        
        .btn-reset { 
            background: #95a5a6; 
            color: white; 
        }
        
        .btn-show-all { 
            background: var(--primary); 
            color: white; 
        }
        
        .check-all-btn { 
            position: fixed; 
            right: 45px;
            bottom: 30px; 
            background-color: var(--success); 
            color: white; 
            padding: 15px 30px; 
            border-radius: 50px; 
            cursor: pointer; 
            z-index: 10000;
            font-weight: bold; 
            border: none; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.2); 
        }
        
        .instructions {
            color: #7f8c8d;
            font-size: 0.95em;
            margin-bottom: 15px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        
        .option-container {
            display: inline-flex;
            gap: 10px;
            margin-left: 10px;
            margin-right: 10px;
            flex-wrap: wrap;
        }
        
        .option-btn {
            background: #eef2f7;
            border: 2px solid #bdc3c7;
            border-radius: 6px;
            padding: 6px 15px;
            cursor: pointer;
            font-weight: 500;
            transition: 0.2s;
            min-width: 80px;
            text-align: center;
            font-size: 0.9em;
        }
        
        .option-btn:hover {
            background: #dfe6f0;
            border-color: #95a5a6;
        }
        
        .option-btn.selected {
            background: #3498db;
            color: white;
            border-color: #2980b9;
        }
        
        .option-btn.correct-option {
            background: #27ae60;
            color: white;
            border-color: #219653;
        }
        
        .option-btn.incorrect-option {
            background: #e74c3c;
            color: white;
            border-color: #c0392b;
        }
        
        .bold-option {
            font-weight: bold;
            color: var(--primary-dark);
        }
        
        .mcq-question {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .mcq-question p {
            margin-bottom: 12px;
            font-weight: 500;
            font-size: 1.05em;
        }
        
        .mcq-options-container {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .mcq-option {
            margin-bottom: 5px;
            padding: 10px 12px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            background-color: #f9f9f9;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            width: 100%;
        }
        
        .mcq-option:hover {
            background-color: #f0f0f0;
            border-color: #bdc3c7;
        }
        
        .mcq-option.selected {
            background-color: #e3f2fd;
            border-color: #3498db;
        }
        
        .mcq-option.correct {
            background-color: #d4edda;
            border-color: #27ae60;
            color: #155724;
        }
        
        .mcq-option.incorrect {
            background-color: #f8d7da;
            border-color: #e74c3c;
            color: #721c24;
        }
        
        .option-letter {
            display: inline-block;
            width: 24px;
            height: 24px;
            line-height: 24px;
            text-align: center;
            background-color: #3498db;
            color: white;
            border-radius: 50%;
            margin-right: 15px;
            font-weight: bold;
            flex-shrink: 0;
        }
        
        .mcq-option.selected .option-letter,
        .mcq-option.correct .option-letter,
        .mcq-option.incorrect .option-letter {
            background-color: rgba(255,255,255,0.3);
            color: white;
        }
        
        .paragraph-exercise {
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            margin: 20px 0;
            line-height: 1.8;
        }
        
        .paragraph-exercise p {
            margin: 0 0 15px 0;
        }
        
        .gap-input {
            border: none;
            border-bottom: 2px dashed #3498db;
            background-color: #f0f8ff;
            padding: 2px 6px;
            margin: 0 5px;
            min-width: 80px;
            text-align: center;
            font-family: 'Times New Roman', serif;
            font-size: 1em;
            border-radius: 0;
        }
        
        .gap-input.correct {
            border-bottom-color: #27ae60;
            background-color: #e8f8f5;
            color: #1e8449;
        }
        
        .gap-input.incorrect {
            border-bottom-color: #e74c3c;
            background-color: #fdedec;
            color: #c0392b;
        }
        
        @media (max-width: 768px) {
            .check-all-btn {
                right: 15px;
                bottom: 20px;
                padding: 12px 20px;
                font-size: 0.9em;
            }
            
            body {
                padding: 15px 15px 120px 15px;
            }
            
            .mcq-options-container {
                grid-template-columns: 1fr;
            }
        }
        
        .preposition-exercise {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            margin: 15px 0;
        }
        
        .preposition-row {
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .preposition-label {
            font-weight: bold;
            min-width: 150px;
        }
        
        .word-formation-input {
            border: none;
            border-bottom: 2px solid #3498db;
            background-color: #f0f8ff;
            padding: 2px 6px;
            min-width: 120px;
            text-align: left;
            font-family: 'Times New Roman', serif;
            font-size: 1em;
            border-radius: 4px 4px 0 0;
        }
        
        .word-formation-input.correct {
            border-bottom-color: #27ae60;
            background-color: #e8f8f5;
            color: #1e8449;
        }
        
        .word-formation-input.incorrect {
            border-bottom-color: #e74c3c;
            background-color: #fdedec;
            color: #c0392b;
        }
        
        .phrasal-verb-container {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #e9ecef;
            margin: 20px 0;
        }
        
        .phrasal-verb-bank {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
            padding: 15px;
            background-color: #eef2f7;
            border-radius: 8px;
            border: 1px solid #bdc3c7;
        }
        
        .phrasal-verb-item {
            background: #dfe6f0;
            border: 1px solid #95a5a6;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: 0.2s;
        }
        
        .phrasal-verb-item:hover {
            background: #3498db;
            color: white;
            border-color: #2980b9;
        }
        
        .phrasal-verb-item.used {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        /* Reading section with split screen */
        .reading-container {
            display: flex;
            margin: 20px 0;
            position: relative;
            min-height: 500px;
            height: 600px;
        }
        
        .text-panel, .questions-panel {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            border: 1px solid #e9ecef;
            overflow-y: auto;
            position: relative;
            height: 100%;
            flex: 1;
        }
        
        .text-panel {
            margin-right: 0;
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
        }
        
        .questions-panel {
            margin-left: 0;
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
        }
        
        .text-panel h3, .questions-panel h3 {
            margin-top: 0;
            color: var(--primary-dark);
            text-align: center;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        
        .reading-text {
            line-height: 1.8;
            text-align: justify;
            user-select: text;
        }
        
        .reading-gap {
            display: inline-block;
            width: 25px;
            text-align: center;
            font-weight: bold;
            color: var(--primary);
            border-bottom: 2px solid var(--primary);
            margin: 0 2px;
        }
        
        .resizer {
            position: relative;
            width: 10px;
            background-color: #ddd;
            cursor: col-resize;
            z-index: 10;
            flex-shrink: 0;
            margin: 0;
        }
        
        .resizer:hover {
            background-color: #3498db;
        }
        
        .resizer::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 2px;
            height: 40px;
            background-color: #95a5a6;
            border-radius: 1px;
        }
        
        .context-menu {
            position: absolute;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 10000;
            min-width: 150px;
            display: none;
        }
        
        .context-menu-item {
            padding: 8px 12px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background-color 0.2s;
        }
        
        .context-menu-item:hover {
            background-color: #f5f5f5;
        }
        
        .highlighted-text {
            background-color: rgba(255, 235, 59, 0.4) !important;
            padding: 0 2px;
            border-radius: 2px;
            color: inherit !important;
            display: inline;
        }
        
        html {
            overflow-x: hidden;
        }
        
        body {
            overflow-y: scroll;
            padding-right: 0 !important;
        }
        
        @media (max-width: 768px) {
            .reading-container {
                flex-direction: column;
                height: 800px;
            }
            
            .text-panel, .questions-panel {
                width: 100% !important;
                height: 50% !important;
                margin: 0;
                border-radius: 10px;
                margin-bottom: 10px;
            }
            
            .resizer {
                display: none;
            }
        }

        /* Matching exercise */
        .matching-container {
            display: flex;
            gap: 30px;
            margin: 20px 0;
        }
        
        .matching-col {
            flex: 1;
        }
        
        .matching-suggestions {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        
        .matching-results {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        
        .matching-item {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding: 10px;
            background: white;
            border-radius: 5px;
            border-left: 4px solid var(--primary);
        }
        
        .matching-number {
            display: inline-block;
            width: 30px;
            height: 30px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 30px;
            margin-right: 15px;
            font-weight: bold;
        }
        
        .matching-letter {
            display: inline-block;
            width: 30px;
            height: 30px;
            background: var(--success);
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 30px;
            margin-right: 15px;
            font-weight: bold;
        }
        
        .matching-input {
            width: 50px;
            text-align: center;
            margin-left: 10px;
            border: 2px solid #bdc3c7;
            border-radius: 4px;
            padding: 3px;
        }
        
        .matching-input.correct {
            border-color: var(--success);
            background-color: #e8f8f5;
        }
        
        .result-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 15px;
            padding: 10px;
            background: white;
            border-radius: 5px;
        }
        
        .result-letter {
            margin-right: 15px;
            font-weight: bold;
            min-width: 30px;
        }
    </style>
</head>
<body>

<div class="container">
    <h1 style="text-align: center; color: var(--primary-dark); margin-bottom: 30px;">Access 4 - Review Module 6</h1>
    
    <!-- B√†i 1: Global Issues -->
    <div class="exercise-card">
        <div class="exercise-title">1. Read the banners and fill in the blanks with the appropriate global issue.</div>
        
        <div id="questions-ex1"></div>
        <div class="controls-row">
            <button class="btn btn-show-all" onclick="showAnswers('ex1')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('ex1')">Reset</button>
        </div>
    </div>
    
    <!-- B√†i 2: Word Bank 1 -->
    <div class="exercise-card">
        <div class="exercise-title">2. Fill in: grow, household, rate, fossil, leading, endangered, developed, global.</div>
        
        <div class="sticky-bank" id="bank-ex2"></div>
        <div id="questions-ex2"></div>
        <div class="controls-row">
            <button class="btn btn-show-all" onclick="showAnswers('ex2')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('ex2')">Reset</button>
        </div>
    </div>
    
    <!-- B√†i 3: Word Bank 2 -->
    <div class="exercise-card">
        <div class="exercise-title">3. Fill in: racial, child, shrinking, environmental, genetically modified, global, acid, toxic.</div>
        
        <div class="sticky-bank" id="bank-ex3"></div>
        <div id="questions-ex3"></div>
        <div class="controls-row">
            <button class="btn btn-show-all" onclick="showAnswers('ex3')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('ex3')">Reset</button>
        </div>
    </div>
    
    <!-- B√†i 4: Choose the correct word -->
    <div class="exercise-card">
        <div class="exercise-title">4. Choose the correct word.</div>
        
        <div id="questions-ex4"></div>
        <div class="controls-row">
            <button class="btn btn-show-all" onclick="showAnswers('ex4')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('ex4')">Reset</button>
        </div>
    </div>
    
    <!-- B√†i 5: Will - Be going to - Present progressive -->
    <div class="exercise-card">
        <div class="exercise-title">5. Complete the sentences using will, be going to or the present progressive.</div>
        
        <div id="questions-ex5"></div>
        <div class="controls-row">
            <button class="btn btn-show-all" onclick="showAnswers('ex5')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('ex5')">Reset</button>
        </div>
    </div>
    
    <!-- B√†i 6: Future progressive - Future perfect -->
    <div class="exercise-card">
        <div class="exercise-title">6. Choose the correct item.</div>
        
        <div id="questions-ex6"></div>
        <div class="controls-row">
            <button class="btn btn-show-all" onclick="showAnswers('ex6')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('ex6')">Reset</button>
        </div>
    </div>
    
    <!-- B√†i 7: Put the verbs in parentheses in the correct tense -->
    <div class="exercise-card">
        <div class="exercise-title">7. Put the verbs in parentheses in the correct tense.</div>
        
        <div id="questions-ex7"></div>
        <div class="controls-row">
            <button class="btn btn-show-all" onclick="showAnswers('ex7')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('ex7')">Reset</button>
        </div>
    </div>
    
    <!-- B√†i 8: Wishes -->
    <div class="exercise-card">
        <div class="exercise-title">8. Write appropriate wishes.</div>
        
        <div id="questions-ex8"></div>
        <div class="controls-row">
            <button class="btn btn-show-all" onclick="showAnswers('ex8')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('ex8')">Reset</button>
        </div>
    </div>
    
    <!-- B√†i 9: Phrasal verbs: run -->
    <div class="exercise-card">
        <div class="exercise-title">9. Fill in the blanks with the correct particle.</div>
        
        <div class="sticky-bank" id="bank-ex9">
            <span class="word-item" data-word="up">up</span>
            <span class="word-item" data-word="into">into</span>
            <span class="word-item" data-word="after">after</span>
            <span class="word-item" data-word="out of">out of</span>
        </div>
        <div id="questions-ex9"></div>
        <div class="controls-row">
            <button class="btn btn-show-all" onclick="showAnswers('ex9')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('ex9')">Reset</button>
        </div>
    </div>
    
    <!-- B√†i 10: Circle the correct item -->
    <div class="exercise-card">
        <div class="exercise-title">10. Circle the correct item.</div>
        
        <div id="questions-ex10"></div>
        <div class="controls-row">
            <button class="btn btn-show-all" onclick="showAnswers('ex10')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('ex10')">Reset</button>
        </div>
    </div>
    
    <!-- B√†i 11: Reading -->
<div class="exercise-card">
    <div class="exercise-title">11. Look at the text in each message. What does it say? Choose the correct letter (A, B, or C).</div>
    
    <div class="reading-container" id="reading-ex11">
        <div class="text-panel" id="text-panel-ex11">
            <h3>Messages</h3>
            <div class="reading-text" id="reading-text-ex11">
                <p><strong>Message 1:</strong> Fran ‚Äî Your piano teacher called about this week's lesson. She is coming on Thursday now instead of Friday, half an hour later than usual.</p>
                <p><strong>Message 2:</strong> Jane, it's a shame you were too ill to come to the party yesterday. Your friend Ian was hoping to see you.</p>
                <p><strong>Message 3:</strong> Take the medicine only when stomach hurts. Never take more than once a day.</p>
                <p><strong>Message 4:</strong> We keep extra stock in a storeroom. Ask a sales assistant to bring more if any product has run out on a shelf.</p>
                <p><strong>Message 5:</strong> To: Jane From: Annie Is it OK if I borrow your silver shoes for the wedding tomorrow? I don't have any that go with my new dress.</p>
            </div>
        </div>
        
        <div class="resizer" id="resizer-ex11"></div>
        
        <div class="questions-panel" id="questions-panel-ex11">
            <h3>Questions</h3>
            <div id="questions-ex11"></div>
        </div>
    </div>
    
    <!-- N√∫t Show All v√† Reset ƒë∆∞·ª£c ƒë·∫∑t ri√™ng b√™n ngo√†i reading-container -->
    <div style="margin-top: 40px !important; display: flex !important; justify-content: flex-end !important; gap: 15px !important; clear: both !important; position: relative !important; z-index: 1000; background: #f8f9fa; padding: 20px; border-radius: 8px; border: 1px solid #e9ecef;">
        <button class="btn btn-show-all" onclick="showAnswers('ex11')">Show All</button>
        <button class="btn btn-reset" onclick="resetSection('ex11')">Reset</button>
    </div>
</div>
    
    <!-- B√†i 12: Matching -->
    <div class="exercise-card">
        <div class="exercise-title">12. Match the suggestions to the results.</div>
        
        <div class="matching-container">
            <div class="matching-col">
                <div class="matching-suggestions">
                    <h3 style="text-align: center; color: var(--primary-dark);">Suggestions</h3>
                    <div id="questions-ex12-suggestions"></div>
                </div>
            </div>
            <div class="matching-col">
                <div class="matching-results">
                    <h3 style="text-align: center; color: var(--primary-dark);">Results</h3>
                    <div id="questions-ex12-results"></div>
                </div>
            </div>
        </div>
        <div id="questions-ex12-inputs"></div>
        <div class="controls-row">
            <button class="btn btn-show-all" onclick="showAnswers('ex12')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('ex12')">Reset</button>
        </div>
    </div>
    
    <!-- B√†i 14: Prepositions -->
    <div class="exercise-card">
        <div class="exercise-title">14. Fill in the blanks with the correct preposition.</div>
        
        <div id="questions-ex14"></div>
        <div class="controls-row">
            <button class="btn btn-show-all" onclick="showAnswers('ex14')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('ex14')">Reset</button>
        </div>
    </div>
    
    <!-- B√†i 15: Word formation -->
    <div class="exercise-card">
        <div class="exercise-title">15. Fill in the blanks with a verb in the correct form derived from the words in capitals.</div>
        
        <div id="questions-ex15"></div>
        <div class="controls-row">
            <button class="btn btn-show-all" onclick="showAnswers('ex15')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('ex15')">Reset</button>
        </div>
    </div>
</div>

<button class="check-all-btn" onclick="checkAll()">CHECK ALL ANSWERS (ENTER)</button>

<div class="context-menu" id="context-menu">
    <div class="context-menu-item" id="highlight-text">Highlight Text</div>
    <div class="context-menu-item" id="remove-highlight">Remove Highlight</div>
    <div class="context-menu-item" id="clear-highlights">Clear All Highlights</div>
</div>

<script>
// Data for Exercise 1: Global Issues
const ex1_data = [
    { q: "\"About one sixth of the world's population makes less than $1 a day.p _ _ _ _ _ _\"", ans: "poverty", hint: "This refers to being extremely poor." },
    { q: "\"Everyone has the right to health care. d _ _ _ _ _ _\"", ans: "disease", hint: "Health care helps prevent and treat illnesses." },
    { q: "\"Please help us fight world hunger. f _ _ _ _ _\"", ans: "famine", hint: "This is extreme scarcity of food." },
    { q: "\"No more people on the streets. h _ _ _ _ _ _ _ _ _ _\"", ans: "homelessness", hint: "People living on the streets without homes." },
    { q: "\"Too many people, too little space left. o _ _ _ _ _ _ _ _ _ _ _\"", ans: "overpopulation", hint: "When there are too many people in an area." },
    { q: "\"Reduce your household waste. Start recycling. p _ _ _ _ _ _ _ _\"", ans: "pollution", hint: "Waste contributes to environmental contamination." }
];

// Data for Exercise 2: Word Bank 1
const ex2_data = [
    { q: "The burning of fossil fuels contributes to ...... warming.", ans: "global", hint: "Global warming is the rise in Earth's temperature." },
    { q: "Each and everyone of us should reduce their ...... waste by recycling.", ans: "household", hint: "Waste produced in homes." },
    { q: "They use their farm to ...... vegetables and fruits, such as tomatoes and apples, for export.", ans: "grow", hint: "To cultivate plants." },
    { q: "Junk food is the ...... cause of weight gain.", ans: "leading", hint: "Main or primary cause." },
    { q: "Unless ...... countries do more to help poor countries, problems such as poverty and famine will get worse and worse.", ans: "developed", hint: "Rich, industrialized nations." },
    { q: "One of the reasons why pandas are rare is their low birth ......", ans: "rate", hint: "Frequency of births." },
    { q: "We should replace ...... fuels such as coal and oil with renewable energy sources.", ans: "fossil", hint: "Fuels formed from ancient organic remains." },
    { q: "WWF helps protect ...... species such as pandas, whales, and sea turtles.", ans: "endangered", hint: "Species at risk of extinction." }
];

const ex2_wordBank = ["grow", "household", "rate", "fossil", "leading", "endangered", "developed", "global"];

// Data for Exercise 3: Word Bank 2
const ex3_data = [
    { q: "...... waste", ans: "toxic", hint: "Poisonous waste." },
    { q: "...... discrimination", ans: "racial", hint: "Discrimination based on race." },
    { q: "...... warming", ans: "global", hint: "Rise in Earth's temperature." },
    { q: "...... rain", ans: "acid", hint: "Rain containing harmful chemicals." },
    { q: "...... labor", ans: "child", hint: "Work done by children." },
    { q: "...... issues", ans: "environmental", hint: "Problems related to the environment." },
    { q: "...... planet", ans: "shrinking", hint: "Getting smaller." },
    { q: "...... food", ans: "genetically modified", hint: "Food altered at genetic level." }
];

const ex3_wordBank = ["racial", "child", "shrinking", "environmental", "genetically modified", "global", "acid", "toxic"];

// Data for Exercise 4: Choose the correct word
const ex4_data = [
    { q: "If we don't take measures against <strong>forestation/ deforestation</strong> in the Amazon, many plant and animal species will become extinct.", ans: "deforestation", options: ["forestation", "deforestation"], hint: "Cutting down forests." },
    { q: "Wealthier countries should help poor countries with <strong>limited/shrinking</strong> resources.", ans: "limited", options: ["limited", "shrinking"], hint: "Restricted or finite." },
    { q: "There has been a decline in agricultural production due to last year's <strong>drought/famine</strong>.", ans: "drought", options: ["drought", "famine"], hint: "Long period without rain." },
    { q: "Some people claim that genetically modified foods could be the solution to <strong>starving/shrinking</strong> millions.", ans: "starving", options: ["starving", "shrinking"], hint: "Suffering from hunger." },
    { q: "As oil is running out, we need to find other sources to cover our <strong>energy/power</strong> needs.", ans: "energy", options: ["energy", "power"], hint: "Capacity for activity." },
    { q: "The Amazon rainforest is rich in <strong>vegetables/vegetation</strong> and it's also home to many rare plant species.", ans: "vegetation", options: ["vegetables", "vegetation"], hint: "Plant life collectively." },
    { q: "Do you think <strong>advanced/advancing</strong> technology will one day replace teachers with computers?", ans: "advanced", options: ["advanced", "advancing"], hint: "Highly developed." },
    { q: "Flowers <strong>release/reduce</strong> carbon dioxide at night.", ans: "release", options: ["release", "reduce"], hint: "Give out or emit." }
];

// Data for Exercise 5: Will - Be going to - Present progressive
const ex5_data = [
    { q: "Don't worry! I ...... (pick) you up from the train station.", ans: "will pick", hint: "Offering help spontaneously." },
    { q: "What ...... (you/do) this weekend?", ans: "are you doing", hint: "Plans or arrangements." },
    { q: "The weather forecast said it ...... (not/be) sunny tomorrow.", ans: "isn't going to be", hint: "Prediction based on evidence." },
    { q: "Look at those boys! They ...... (break) everything!", ans: "are going to break", hint: "Prediction based on present evidence." }
];

// Data for Exercise 6: Future progressive - Future perfect
const ex6_data = [
    { q: "Don't call me tomorrow, I <strong>will be studying/ will have studied</strong> for my exams.", ans: "will be studying", options: ["will be studying", "will have studied"], hint: "Action in progress at a specific future time." },
    { q: "<strong>Will you have finished/Will you have been finishing</strong> your project by 10 o'clock tomorrow morning?", ans: "Will you have finished", options: ["Will you have finished", "Will you have been finishing"], hint: "Action completed before a future time." },
    { q: "This time tomorrow I <strong>will have flown/will be flying</strong> to Madrid.", ans: "will be flying", options: ["will have flown", "will be flying"], hint: "Action in progress at a specific future time." },
    { q: "Sarah <strong>will not have moved/will not be moving</strong> to her new house by the end of this week. Probably next week.", ans: "won't have moved", options: ["will not have moved", "will not be moving"], hint: "Action not completed by a future time." },
    { q: "Our teacher <strong>will have corrected/will be correcting</strong> our essays by the end of this week.", ans: "will have corrected", options: ["will have corrected", "will be correcting"], hint: "Action completed by a future time." }
];

// Data for Exercise 7: Put verbs in correct tense
const ex7_data = [
    { q: "A: I'm starving! B: If I ...... (not/be) busy, I ...... (cook) something for you. Do you want to order in instead?", ans: "weren't, would cook", hint: "Second conditional (unreal present)." },
    { q: "A: Did you have a good time at the party yesterday? B: If it ...... (not/be) for my friends, I ...... (not/enjoy) myself.", ans: "hadn't been, wouldn't have enjoyed", hint: "Third conditional (unreal past)." },
    { q: "A: Have you found your cell phone that you lost in the restaurant the other day? B: No, I haven't. If I ...... (find) it, I ...... (not/buy) a new one!", ans: "had found, wouldn't have bought", hint: "Third conditional (unreal past)." },
    { q: "A: I'm not ready yet. I still haven't decided what to wear. B: Hurry up! If we ...... (not/leave) now, we ...... (be) late.", ans: "don't leave, will be", hint: "First conditional (real present/future)." }
];

// Data for Exercise 8: Wishes
const ex8_data = [
    { q: "I wish I ______ (study) harder for my exams last week.", ans: "had studied", hint: "Past wish about past event." },
    { q: "I wish I ______ (not/be) so busy. I'm so tired!", ans: "weren't", hint: "Present wish about present situation." },
    { q: "I wish my tooth ______ (not/hurt) me so much!", ans: "didn't hurt", hint: "Present wish about present situation." },
    { q: "I wish you ______ (visit) me more often!", ans: "visited", hint: "Present wish about present habit." },
    { q: "I wish it ______ (not/be) so expensive!", ans: "wasn't", hint: "Present wish about present situation." },
    { q: "I wish my brother ______ (not/move) to Chicago. I miss him a lot!", ans: "hadn't moved", hint: "Past wish about past action." }
];

// Data for Exercise 9: Phrasal verbs: run
const ex9_data = [
    { q: "Sue ran ...... a $1,000 telephone bill because she kept calling her friends in France.", ans: "up", hint: "To accumulate a debt/bill." },
    { q: "I ran ...... an old friend in the park yesterday.", ans: "into", hint: "To meet by chance." },
    { q: "The police ran ...... the thief and caught him.", ans: "after", hint: "To chase." },
    { q: "Hurry up! You're running ...... time!", ans: "out of", hint: "To have very little time left." }
];

const ex9_wordBank = ["up", "into", "after", "out of"];

// Data for Exercise 10: Circle the correct item (with numbers)
const ex10_data = [
    { num: "1", q: "I ...... of joining the gym.", options: ["A think", "B am thinking", "C thought"], ans: "B", correct: 1, hint: "Present continuous for current intention." },
    { num: "2", q: "Jane's parents don't let her ...... out late on weekdays.", options: ["A stay", "B to stay", "C staying"], ans: "A", correct: 0, hint: "Let + object + infinitive without 'to'." },
    { num: "3", q: "What ...... you ...... when David told you the truth about his past?", options: ["A did, do", "B have, done", "C are, doing"], ans: "A", correct: 0, hint: "Past simple for completed action in past." },
    { num: "4", q: "This shirt is very expensive. Do you always buy ...... expensive clothes?", options: ["A such", "B so", "C enough"], ans: "A", correct: 0, hint: "Such + adjective + noun." },
    { num: "5", q: "Mike is ...... attractive of the three.", options: ["A the least", "B less", "C little"], ans: "A", correct: 0, hint: "Superlative form." },
    { num: "6", q: "If she ...... so much ice cream, she wouldn't have been sick.", options: ["A didn't eat", "B doesn't eat", "C hadn't eaten"], ans: "C", correct: 2, hint: "Third conditional." },
    { num: "7", q: "Helen was so upset with the sales assistant that she ...... her bag and left the store.", options: ["A was taking", "B had taken", "C took"], ans: "C", correct: 2, hint: "Past simple for sequence of actions." },
    { num: "8", q: "Could I have ...... orange juice, please?", options: ["A some", "B any", "C every"], ans: "A", correct: 0, hint: "Some in polite requests." },
    { num: "9", q: "Jessica ...... in Louisiana for 5 years before she moved to Seattle.", options: ["A was living", "B has lived", "C had lived"], ans: "C", correct: 2, hint: "Past perfect for action before another past action." },
    { num: "10", q: "A: Where is your mother? B: She ...... a walk.", options: ["A is taking", "B takes", "C took"], ans: "A", correct: 0, hint: "Present continuous for action happening now." },
    { num: "11", q: "Peter ...... fishing every Sunday when he lived on an island.", options: ["A went", "B was going", "C goes"], ans: "A", correct: 0, hint: "Past simple for past habit." },
    { num: "12", q: "A: Did you like the movie last night? B: Yes, actually it was much better than I ....", options: ["A had expected", "B was expecting", "C expect"], ans: "A", correct: 0, hint: "Past perfect for expectation before the movie." },
    { num: "13", q: "I feel ...... now that I've passed all my exams.", options: ["A much relaxed", "B most relaxed", "C much more relaxed"], ans: "C", correct: 2, hint: "Comparative form." },
    { num: "14", q: "I ...... for the bus for 20 minutes now, but it hasn't turned up yet.", options: ["A am waiting", "B have been waiting", "C was waiting"], ans: "B", correct: 1, hint: "Present perfect continuous for ongoing action." },
    { num: "15", q: "David is willing to do ...... to achieve his dream of becoming a pop singer.", options: ["A something", "B anything", "C everything"], ans: "B", correct: 1, hint: "Anything = any possible thing." },
    { num: "16", q: "A: Oh no! I forgot to pay the electricity bill! B: Don't worry! I ...... it for you.", options: ["A am doing", "B do", "C will do"], ans: "C", correct: 2, hint: "Will for spontaneous offer." },
    { num: "17", q: "If you ...... junk food, you wouldn't have gained weight.", options: ["A avoided", "B avoid", "C had avoided"], ans: "C", correct: 2, hint: "Third conditional." },
    { num: "18", q: "If I were you, I ...... a new car.", options: ["A will buy", "B would buy", "C would have bought"], ans: "B", correct: 1, hint: "Second conditional." },
    { num: "19", q: "Oh no! That man ...... into the river!", options: ["A dives", "B will dive", "C is going to dive"], ans: "C", correct: 2, hint: "Prediction based on present evidence." },
    { num: "20", q: "Does ...... have a pen I can borrow?", options: ["A someone", "B everyone", "C anyone"], ans: "C", correct: 2, hint: "Anyone in questions." },
    { num: "21", q: "I won't wake you up unless your mom ...... you.", options: ["A calls", "B will call", "C doesn't call"], ans: "A", correct: 0, hint: "Present simple after unless." }
];

// Data for Exercise 11: Reading comprehension
const ex11_data = [
    { 
        message: "1",
        options: [
            "A: Fran will not have a piano lesson this week.",
            "B: Fran will have her lesson sooner than expected this week.",
            "C: Fran will not have her lesson on Thursday this week."
        ], 
        correct: 1, // B
        hint: "The lesson is on Thursday instead of Friday, so sooner than expected."
    },
    { 
        message: "2",
        options: [
            "A: If Jane had gone to the party, she would have seen Ian.",
            "B: If Jane wasn't ill, she would go to the party.",
            "C: If Jane doesn't come to the party, she won't see Ian."
        ], 
        correct: 0, // A
        hint: "Third conditional: past unreal situation."
    },
    { 
        message: "3",
        options: [
            "A: Take the medicine every day until you feel healthy again.",
            "B: Wait until you are in pain before taking the medicine.",
            "C: Taking the medicine more than once a day will make your stomach hurt."
        ], 
        correct: 1, // B
        hint: "Take only when stomach hurts, maximum once daily."
    },
    { 
        message: "4",
        options: [
            "A: Look in the storeroom if you don't see the product you want.",
            "B: Talk to a sales assistant if you are unhappy with a product.",
            "C: If a shelf is empty, tell us and we will fill it again."
        ], 
        correct: 2, // C
        hint: "Ask assistant to bring more if product is out on shelf."
    },
    { 
        message: "5",
        options: [
            "A: to ask her for a pair of shoes.",
            "B: to apologize for borrowing her shoes.",
            "C: to lend her shoes to Jane."
        ], 
        correct: 0, // A
        hint: "Annie is asking to borrow Jane's shoes."
    }
];

// Data for Exercise 12: Matching
const ex12_suggestions = [
    "set up centers for local support",
    "help homeless people to find work",
    "provide accommodation services",
    "give expert medical treatment"
];

const ex12_results = [
    { letter: "A", text: "If they find work to do, they will be able to support themselves." },
    { letter: "B", text: "This will provide a place where homeless people can find daily help." },
    { letter: "C", text: "This will help them to overcome illnesses and addictions." },
    { letter: "D", text: "This way they can find a permanent place to live." }
];

const ex12_correct = [
    { suggestion: 0, result: "B" }, // set up centers -> B
    { suggestion: 1, result: "A" }, // help find work -> A
    { suggestion: 2, result: "D" }, // provide accommodation -> D
    { suggestion: 3, result: "C" }  // medical treatment -> C
];

// Data for Exercise 14: Prepositions
const ex14_data = [
    { q: "According ...... the police, some campers had accidentally started the fire.", ans: "to", hint: "According to = as stated by." },
    { q: "E-waste is a major threat ...... the environment.", ans: "to", hint: "Threat to something." },
    { q: "Trash cans are crucial ...... keeping the city clean.", ans: "for", hint: "Crucial for = essential for." },
    { q: "This zoo is home ...... more than a thousand animal species.", ans: "to", hint: "Home to = habitat for." }
];

// Data for Exercise 15: Word formation
const ex15_data = [
    { q: "He will ______ if Peter makes a mistake. <strong>APOLOGY</strong>", ans: "apologize", hint: "Verb form of apology." },
    { q: "Mark still ______ with his old school friends. <strong>SOCIAL</strong>", ans: "socializes", hint: "Verb: interacts socially." },
    { q: "I'm afraid I cannot ______ my report unless I have all the statistics. <strong>FINAL</strong>", ans: "finalize", hint: "Verb: to complete/make final." },
    { q: "The doctors decided to ______ the young girl as her temperature continued to rise. <strong>HOSPITAL</strong>", ans: "hospitalize", hint: "Verb: to admit to hospital." },
    { q: "Please don't forget to ______ all the company names in this document. <strong>CAPITAL</strong>", ans: "capitalize", hint: "Verb: to write with capital letters." }
];

let answerStates = new Map();
let wordUsageCount = {};
let optionSelections = new Map();
let readingSelections = new Map();
let matchingInputs = [];
let selectedTextRange = null;
let contextMenu = null;

// Render functions
function renderEx1() {
    const container = document.getElementById('questions-ex1');
    container.innerHTML = '';
    
    ex1_data.forEach((item, i) => {
        const qid = `ex1-q${i}`;
        container.innerHTML += `
            <div class="question-row">
                <strong>${i+1}.</strong> ${item.q}
                <input type="text" class="word-input" id="${qid}" data-type="input" data-ans="${item.ans}" oninput="adjustWidth(this)" onclick="this.select()">
                <div class="row-btns">
                    <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')">üëÅÔ∏è</button>
                    <button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')">i</button>
                </div>
                <div class="hint-box" id="${qid}-hint">üí° ${item.hint}</div>
            </div>`;
    });
}

function renderEx2() {
    const bankContainer = document.getElementById('bank-ex2');
    const questionContainer = document.getElementById('questions-ex2');
    
    bankContainer.innerHTML = '';
    wordUsageCount['ex2'] = {};
    
    ex2_wordBank.forEach((word, i) => {
        const wordId = `ex2-word-${i}`;
        bankContainer.innerHTML += `
            <div class="word-item" id="${wordId}" data-word="${word}" draggable="true" ondragstart="dragWord(event)" onclick="selectWordFromBank('${wordId}')">
                ${word}
            </div>`;
        wordUsageCount['ex2'][word] = 0;
    });
    
    questionContainer.innerHTML = '';
    
    ex2_data.forEach((item, i) => {
        const qid = `ex2-q${i}`;
        questionContainer.innerHTML += `
            <div class="question-row">
                <strong>${i+1}.</strong> ${item.q}
                <input type="text" class="word-input" id="${qid}" data-type="input" data-ans="${item.ans}" oninput="adjustWidth(this); updateWordBank('ex2')" ondrop="dropWord(event, '${qid}')" ondragover="allowDrop(event)" onclick="this.select()">
                <div class="row-btns">
                    <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')">üëÅÔ∏è</button>
                    <button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')">i</button>
                </div>
                <div class="hint-box" id="${qid}-hint">üí° ${item.hint}</div>
            </div>`;
    });
    
    addWordBankEventListeners('ex2');
}

function renderEx3() {
    const bankContainer = document.getElementById('bank-ex3');
    const questionContainer = document.getElementById('questions-ex3');
    
    bankContainer.innerHTML = '';
    wordUsageCount['ex3'] = {};
    
    ex3_wordBank.forEach((word, i) => {
        const wordId = `ex3-word-${i}`;
        bankContainer.innerHTML += `
            <div class="word-item" id="${wordId}" data-word="${word}" draggable="true" ondragstart="dragWord(event)" onclick="selectWordFromBank('${wordId}')">
                ${word}
            </div>`;
        wordUsageCount['ex3'][word] = 0;
    });
    
    questionContainer.innerHTML = '';
    
    ex3_data.forEach((item, i) => {
        const qid = `ex3-q${i}`;
        questionContainer.innerHTML += `
            <div class="question-row">
                <strong>${i+1}.</strong> ${item.q}
                <input type="text" class="word-input" id="${qid}" data-type="input" data-ans="${item.ans}" oninput="adjustWidth(this); updateWordBank('ex3')" ondrop="dropWord(event, '${qid}')" ondragover="allowDrop(event)" onclick="this.select()">
                <div class="row-btns">
                    <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')">üëÅÔ∏è</button>
                    <button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')">i</button>
                </div>
                <div class="hint-box" id="${qid}-hint">üí° ${item.hint}</div>
            </div>`;
    });
    
    addWordBankEventListeners('ex3');
}

function renderEx4() {
    const container = document.getElementById('questions-ex4');
    container.innerHTML = '';
    
    ex4_data.forEach((item, i) => {
        const qid = `ex4-q${i}`;
        
        let optionsHtml = '';
        item.options.forEach((option, optIndex) => {
            optionsHtml += `<button class="option-btn" onclick="selectOption('${qid}', '${option}')" id="${qid}-opt${optIndex}">${option}</button>`;
        });
        
        container.innerHTML += `
            <div class="question-row">
                <span class="sentence-text">
                    <strong>${i+1}.</strong> ${item.q}
                    <div class="option-container">
                        ${optionsHtml}
                    </div>
                </span>
                <div class="row-btns">
                    <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')">üëÅÔ∏è</button>
                    <button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')">i</button>
                </div>
                <div class="hint-box" id="${qid}-hint">üí° ${item.hint}</div>
            </div>`;
    });
}

function renderEx5() {
    const container = document.getElementById('questions-ex5');
    container.innerHTML = '';
    
    ex5_data.forEach((item, i) => {
        const qid = `ex5-q${i}`;
        container.innerHTML += `
            <div class="question-row">
                <strong>${i+1}.</strong> ${item.q}
                <input type="text" class="word-input" id="${qid}" data-type="input" data-ans="${item.ans}" oninput="adjustWidth(this)" onclick="this.select()">
                <div class="row-btns">
                    <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')">üëÅÔ∏è</button>
                    <button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')">i</button>
                </div>
                <div class="hint-box" id="${qid}-hint">üí° ${item.hint}</div>
            </div>`;
    });
}

function renderEx6() {
    const container = document.getElementById('questions-ex6');
    container.innerHTML = '';
    
    ex6_data.forEach((item, i) => {
        const qid = `ex6-q${i}`;
        
        let optionsHtml = '';
        item.options.forEach((option, optIndex) => {
            optionsHtml += `<button class="option-btn" onclick="selectOption('${qid}', '${option}')" id="${qid}-opt${optIndex}">${option}</button>`;
        });
        
        container.innerHTML += `
            <div class="question-row">
                <span class="sentence-text">
                    <strong>${i+1}.</strong> ${item.q}
                    <div class="option-container">
                        ${optionsHtml}
                    </div>
                </span>
                <div class="row-btns">
                    <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')">üëÅÔ∏è</button>
                    <button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')">i</button>
                </div>
                <div class="hint-box" id="${qid}-hint">üí° ${item.hint}</div>
            </div>`;
    });
}

function renderEx7() {
    const container = document.getElementById('questions-ex7');
    container.innerHTML = '';
    
    ex7_data.forEach((item, i) => {
        const qid = `ex7-q${i}`;
        container.innerHTML += `
            <div class="question-row">
                <strong>${i+1}.</strong> ${item.q}
                <input type="text" class="word-input" id="${qid}" data-type="input" data-ans="${item.ans}" oninput="adjustWidth(this)" onclick="this.select()">
                <div class="row-btns">
                    <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')">üëÅÔ∏è</button>
                    <button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')">i</button>
                </div>
                <div class="hint-box" id="${qid}-hint">üí° ${item.hint}</div>
            </div>`;
    });
}

function renderEx8() {
    const container = document.getElementById('questions-ex8');
    container.innerHTML = '';
    
    ex8_data.forEach((item, i) => {
        const qid = `ex8-q${i}`;
        container.innerHTML += `
            <div class="question-row">
                <strong>${i+1}.</strong> ${item.q}
                <input type="text" class="word-input" id="${qid}" data-type="input" data-ans="${item.ans}" oninput="adjustWidth(this)" onclick="this.select()">
                <div class="row-btns">
                    <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')">üëÅÔ∏è</button>
                    <button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')">i</button>
                </div>
                <div class="hint-box" id="${qid}-hint">üí° ${item.hint}</div>
            </div>`;
    });
}

function renderEx9() {
    const questionContainer = document.getElementById('questions-ex9');
    
    wordUsageCount['ex9'] = {};
    ex9_wordBank.forEach(word => {
        wordUsageCount['ex9'][word] = 0;
    });
    
    questionContainer.innerHTML = '';
    
    ex9_data.forEach((item, i) => {
        const qid = `ex9-q${i}`;
        questionContainer.innerHTML += `
            <div class="question-row">
                <strong>${i+1}.</strong> ${item.q}
                <input type="text" class="word-input" id="${qid}" data-type="input" data-ans="${item.ans}" oninput="adjustWidth(this); updateWordBank('ex9')" ondrop="dropWord(event, '${qid}')" ondragover="allowDrop(event)" onclick="this.select()">
                <div class="row-btns">
                    <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')">üëÅÔ∏è</button>
                    <button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')">i</button>
                </div>
                <div class="hint-box" id="${qid}-hint">üí° ${item.hint}</div>
            </div>`;
    });
    
    // Add event listeners for bank items
    const wordItems = document.querySelectorAll('#bank-ex9 .word-item');
    wordItems.forEach(item => {
        item.addEventListener('click', function() {
            selectWordFromBankByText(this.dataset.word, 'ex9');
        });
        item.addEventListener('dragstart', function(e) {
            dragWord(e);
        });
    });
}

function renderEx10() {
    const container = document.getElementById('questions-ex10');
    container.innerHTML = '';
    
    ex10_data.forEach((item, i) => {
        const qid = `ex10-q${i}`;
        
        let optionsHtml = '';
        item.options.forEach((option, optIndex) => {
            optionsHtml += `<button class="option-btn" onclick="selectOption('${qid}', '${option}')" id="${qid}-opt${optIndex}">${option}</button>`;
        });
        
        container.innerHTML += `
            <div class="question-row">
                <span class="sentence-text">
                    <strong>${item.num}.</strong> ${item.q}
                    <div class="option-container">
                        ${optionsHtml}
                    </div>
                </span>
                <div class="row-btns">
                    <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')">üëÅÔ∏è</button>
                    <button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')">i</button>
                </div>
                <div class="hint-box" id="${qid}-hint">üí° ${item.hint}</div>
            </div>`;
    });
}

function renderEx11() {
    const questionsContainer = document.getElementById('questions-ex11');
    questionsContainer.innerHTML = '';
    
    ex11_data.forEach((item, i) => {
        const qid = `ex11-q${i}`;
        const optionLetters = ['A', 'B', 'C'];
        
        let optionsHtml = '<div class="mcq-options-container">';
        item.options.forEach((option, optIndex) => {
            const letter = optionLetters[optIndex];
            optionsHtml += `
                <div class="mcq-option" id="${qid}-option-${optIndex}" onclick="selectReadingOption('${qid}', ${optIndex})">
                    <span class="option-letter">${letter}</span>
                    <span class="option-text">${option}</span>
                </div>`;
        });
        optionsHtml += '</div>';
        
        questionsContainer.innerHTML += `
            <div class="mcq-question" id="${qid}-container">
                <p><strong>Message ${item.message}</strong></p>
                ${optionsHtml}
                <div class="row-btns" style="margin-top: 10px;">
                    <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')">üëÅÔ∏è</button>
                    <button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')">i</button>
                </div>
                <div class="hint-box" id="${qid}-hint">üí° ${item.hint}</div>
            </div>`;
    });
}

function renderEx12() {
    const suggestionsContainer = document.getElementById('questions-ex12-suggestions');
    const resultsContainer = document.getElementById('questions-ex12-results');
    const inputsContainer = document.getElementById('questions-ex12-inputs');
    
    suggestionsContainer.innerHTML = '';
    resultsContainer.innerHTML = '';
    inputsContainer.innerHTML = '';
    
    // Render suggestions
    ex12_suggestions.forEach((suggestion, i) => {
        suggestionsContainer.innerHTML += `
            <div class="matching-item">
                <span class="matching-number">${i+1}</span>
                <span class="matching-content">${suggestion}</span>
            </div>`;
    });
    
    // Render results
    ex12_results.forEach((result, i) => {
        resultsContainer.innerHTML += `
            <div class="result-item">
                <span class="matching-letter">${result.letter}</span>
                <span class="matching-content">${result.text}</span>
            </div>`;
    });
    
    // Render input fields
    let inputsHtml = '<div style="display: flex; gap: 20px; flex-wrap: wrap; margin-top: 20px;">';
    ex12_suggestions.forEach((suggestion, i) => {
        const qid = `ex12-match-${i}`;
        inputsHtml += `
            <div style="display: flex; align-items: center; gap: 10px;">
                <span><strong>${i+1} ‚Üí</strong></span>
                <input type="text" class="letter-input matching-input" id="${qid}" data-type="input" data-ans="${ex12_correct[i].result}" maxlength="1" style="width: 50px; text-transform: uppercase;" oninput="this.value = this.value.toUpperCase()" onclick="this.select()">
            </div>`;
    });
    inputsHtml += '</div>';
    
    inputsContainer.innerHTML = inputsHtml;
}

function renderEx14() {
    const container = document.getElementById('questions-ex14');
    container.innerHTML = '';
    
    ex14_data.forEach((item, i) => {
        const qid = `ex14-q${i}`;
        container.innerHTML += `
            <div class="question-row">
                <strong>${i+1}.</strong> ${item.q}
                <input type="text" class="word-input" id="${qid}" data-type="input" data-ans="${item.ans}" oninput="adjustWidth(this)" onclick="this.select()">
                <div class="row-btns">
                    <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')">üëÅÔ∏è</button>
                    <button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')">i</button>
                </div>
                <div class="hint-box" id="${qid}-hint">üí° ${item.hint}</div>
            </div>`;
    });
}

function renderEx15() {
    const container = document.getElementById('questions-ex15');
    container.innerHTML = '';
    
    ex15_data.forEach((item, i) => {
        const qid = `ex15-q${i}`;
        container.innerHTML += `
            <div class="question-row">
                <strong>${i+1}.</strong> ${item.q}
                <input type="text" class="word-formation-input" id="${qid}" data-type="input" data-ans="${item.ans}" oninput="adjustWidth(this)" onclick="this.select()">
                <div class="row-btns">
                    <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')">üëÅÔ∏è</button>
                    <button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')">i</button>
                </div>
                <div class="hint-box" id="${qid}-hint">üí° ${item.hint}</div>
            </div>`;
    });
}

// Helper functions (from original code)
function adjustWidth(el) { 
    let baseWidth;
    if (el.classList.contains('letter-input')) {
        baseWidth = 45;
    } else if (el.classList.contains('word-input') || el.classList.contains('word-formation-input')) {
        baseWidth = 120;
    } else {
        baseWidth = 60;
    }
    
    const charWidth = (el.classList.contains('word-input') || el.classList.contains('word-formation-input')) ? 9 : 10;
    const newWidth = Math.max(el.value.length * charWidth + 40, baseWidth);
    
    let maxWidth = 800;
    
    el.style.width = Math.min(newWidth, maxWidth) + "px";
}

function toggleHint(id) { 
    const h = document.getElementById(id + '-hint'); 
    const infoBtn = document.getElementById(id + '-info');
    
    if (h) {
        if (h.style.display === 'block') {
            h.style.display = 'none';
            if (infoBtn) infoBtn.classList.remove('active');
        } else {
            h.style.display = 'block';
            if (infoBtn) infoBtn.classList.add('active');
        }
    }
}

function toggleSingleAns(id) { 
    const qid = id.replace('-eye', '');
    
    // Check if reading question
    if (qid.startsWith('ex11-q')) {
        const questionIndex = parseInt(qid.split('-q')[1]);
        const questionData = ex11_data[questionIndex];
        const correctAnswerIndex = questionData.correct;
        
        const options = document.querySelectorAll(`#${qid}-container .mcq-option`);
        options.forEach((option, index) => {
            option.classList.remove('correct', 'incorrect', 'selected');
            if (index === correctAnswerIndex) {
                option.classList.add('correct');
            }
        });
        
        const eyeBtn = document.getElementById(id);
        if (eyeBtn) eyeBtn.classList.add('active');
        answerStates.set(`${qid}-state`, true);
        return;
    }
    
    // Check if option-based question
    if (qid.startsWith('ex4-q') || qid.startsWith('ex6-q') || qid.startsWith('ex10-q')) {
        let data;
        if (qid.startsWith('ex4-q')) data = ex4_data;
        else if (qid.startsWith('ex6-q')) data = ex6_data;
        else data = ex10_data;
        
        const questionIndex = parseInt(qid.split('-q')[1]);
        const questionData = data[questionIndex];
        const correctAnswer = questionData.ans;
        
        const optionButtons = [];
        for (let i = 0; i < questionData.options.length; i++) {
            const btn = document.getElementById(`${qid}-opt${i}`);
            if (btn) optionButtons.push(btn);
        }
        
        const stateKey = `${qid}-state`;
        const isCurrentlyShown = answerStates.get(stateKey) || false;
        
        if (isCurrentlyShown) {
            optionButtons.forEach(btn => {
                btn.classList.remove('correct-option', 'incorrect-option');
                const userSelection = optionSelections.get(qid);
                if (userSelection && btn.textContent === userSelection) {
                    btn.classList.add('selected');
                }
            });
            
            const eyeBtn = document.getElementById(id);
            if (eyeBtn) eyeBtn.classList.remove('active');
            answerStates.set(stateKey, false);
        } else {
            optionButtons.forEach(btn => {
                btn.classList.remove('selected', 'correct-option', 'incorrect-option');
                if (btn.textContent === correctAnswer || 
                    (qid.startsWith('ex10-q') && btn.textContent.startsWith(correctAnswer + ' '))) {
                    btn.classList.add('correct-option');
                }
            });
            
            const eyeBtn = document.getElementById(id);
            if (eyeBtn) eyeBtn.classList.add('active');
            answerStates.set(stateKey, true);
        }
        return;
    }
    
    // Regular input
    const el = document.getElementById(qid);
    if (!el) return;
    
    const ans = el.dataset.ans;
    const eyeBtn = document.getElementById(id);
    const stateKey = `${qid}-state`;
    const isCurrentlyShown = answerStates.get(stateKey) || false;
    
    if (isCurrentlyShown) {
        el.value = "";
        el.classList.remove('correct', 'incorrect-marked');
        adjustWidth(el);
        if (eyeBtn) eyeBtn.classList.remove('active');
        answerStates.set(stateKey, false);
    } else {
        if (ans) {
            el.value = ans;
            el.classList.add('correct');
            el.classList.remove('incorrect-marked');
            adjustWidth(el);
            if (eyeBtn) eyeBtn.classList.add('active');
            answerStates.set(stateKey, true);
        }
    }
}

function selectOption(qid, option) {
    const optionButtons = document.querySelectorAll(`[id^="${qid}-opt"]`);
    optionButtons.forEach(btn => {
        btn.classList.remove('selected');
    });
    
    const selectedBtn = Array.from(optionButtons).find(btn => btn.textContent === option);
    if (selectedBtn) {
        selectedBtn.classList.add('selected');
    }
    
    optionSelections.set(qid, option);
}

function selectReadingOption(qid, optionIndex) {
    const options = document.querySelectorAll(`#${qid}-container .mcq-option`);
    options.forEach(option => {
        option.classList.remove('selected');
    });
    
    const selectedOption = document.getElementById(`${qid}-option-${optionIndex}`);
    if (selectedOption) {
        selectedOption.classList.add('selected');
    }
    
    readingSelections.set(qid, optionIndex);
}

function selectWordFromBank(wordId) {
    const wordItem = document.getElementById(wordId);
    if (!wordItem || wordItem.classList.contains('used')) return;
    
    const word = wordItem.dataset.word;
    const taskId = wordId.split('-')[0] + '-' + wordId.split('-')[1];
    
    const inputs = document.querySelectorAll(`#questions-${taskId} input.word-input`);
    let emptyInput = null;
    
    for (const input of inputs) {
        if (!input.value.trim()) {
            emptyInput = input;
            break;
        }
    }
    
    if (emptyInput) {
        emptyInput.value = word;
        adjustWidth(emptyInput);
        updateWordBankUsage(word, taskId);
    }
}

function selectWordFromBankByText(word, taskId) {
    const wordItems = document.querySelectorAll(`#bank-${taskId} .word-item`);
    let wordItem = null;
    
    for (const item of wordItems) {
        if (item.dataset.word === word) {
            wordItem = item;
            break;
        }
    }
    
    if (!wordItem || wordItem.classList.contains('used')) return;
    
    const inputs = document.querySelectorAll(`#questions-${taskId} input.word-input`);
    let emptyInput = null;
    
    for (const input of inputs) {
        if (!input.value.trim()) {
            emptyInput = input;
            break;
        }
    }
    
    if (emptyInput) {
        emptyInput.value = word;
        adjustWidth(emptyInput);
        updateWordBankUsage(word, taskId);
    }
}

function dragWord(event) {
    event.dataTransfer.setData("text/plain", event.target.dataset.word);
    event.dataTransfer.setData("wordId", event.target.id);
}

function allowDrop(event) {
    event.preventDefault();
}

function dropWord(event, inputId) {
    event.preventDefault();
    const word = event.dataTransfer.getData("text/plain");
    const wordId = event.dataTransfer.getData("wordId");
    
    const input = document.getElementById(inputId);
    if (input) {
        input.value = word;
        adjustWidth(input);
        
        const taskId = wordId.split('-')[0] + '-' + wordId.split('-')[1];
        updateWordBankUsage(word, taskId);
    }
}

function updateWordBankUsage(word, taskId) {
    if (!wordUsageCount[taskId]) {
        wordUsageCount[taskId] = {};
    }
    
    if (!wordUsageCount[taskId][word]) {
        wordUsageCount[taskId][word] = 0;
    }
    
    const inputs = document.querySelectorAll(`#questions-${taskId} input.word-input`);
    let count = 0;
    
    inputs.forEach(input => {
        if (input.value.trim().toLowerCase() === word.toLowerCase()) {
            count++;
        }
    });
    
    wordUsageCount[taskId][word] = count;
    
    updateWordBankDisplay(taskId);
}

function updateWordBankDisplay(taskId) {
    const wordItems = document.querySelectorAll(`#bank-${taskId} .word-item`);
    
    wordItems.forEach(item => {
        const word = item.dataset.word;
        const count = wordUsageCount[taskId] && wordUsageCount[taskId][word] ? wordUsageCount[taskId][word] : 0;
        
        if (count > 0) {
            item.classList.add('used');
        } else {
            item.classList.remove('used');
        }
    });
}

function updateWordBank(taskId) {
    const inputs = document.querySelectorAll(`#questions-${taskId} input.word-input`);
    
    if (wordUsageCount[taskId]) {
        Object.keys(wordUsageCount[taskId]).forEach(word => {
            wordUsageCount[taskId][word] = 0;
        });
    }
    
    inputs.forEach(input => {
        const word = input.value.trim().toLowerCase();
        if (word && wordUsageCount[taskId] && wordUsageCount[taskId][word] !== undefined) {
            wordUsageCount[taskId][word]++;
        }
    });
    
    updateWordBankDisplay(taskId);
}

function showAnswers(prefix) {
    if (prefix === 'ex11') {
        ex11_data.forEach((item, i) => {
            const qid = `${prefix}-q${i}`;
            const correctIndex = item.correct;
            
            const options = document.querySelectorAll(`#${qid}-container .mcq-option`);
            options.forEach((option, index) => {
                option.classList.remove('correct', 'incorrect', 'selected');
                if (index === correctIndex) {
                    option.classList.add('correct');
                }
            });
            
            const eyeBtn = document.getElementById(`${qid}-eye`);
            if (eyeBtn) eyeBtn.classList.add('active');
            answerStates.set(`${qid}-state`, true);
        });
        return;
    }
    
    if (prefix === 'ex4' || prefix === 'ex6' || prefix === 'ex10') {
        let data;
        if (prefix === 'ex4') data = ex4_data;
        else if (prefix === 'ex6') data = ex6_data;
        else data = ex10_data;
        
        data.forEach((item, i) => {
            const qid = `${prefix}-q${i}`;
            const correctAnswer = item.ans;
            
            const optionButtons = [];
            for (let j = 0; j < item.options.length; j++) {
                const btn = document.getElementById(`${qid}-opt${j}`);
                if (btn) optionButtons.push(btn);
            }
            
            optionButtons.forEach(btn => {
                btn.classList.remove('selected', 'correct-option', 'incorrect-option');
                if (btn.textContent === correctAnswer || 
                    (prefix === 'ex10' && btn.textContent.startsWith(correctAnswer + ' '))) {
                    btn.classList.add('correct-option');
                }
            });
            
            const eyeBtn = document.getElementById(`${qid}-eye`);
            if (eyeBtn) eyeBtn.classList.add('active');
            answerStates.set(`${qid}-state`, true);
        });
        return;
    }
    
    if (prefix === 'ex12') {
        for (let i = 0; i < ex12_suggestions.length; i++) {
            const qid = `ex12-match-${i}`;
            const input = document.getElementById(qid);
            if (input) {
                input.value = ex12_correct[i].result;
                input.classList.add('correct');
                answerStates.set(`${qid}-state`, true);
            }
        }
        return;
    }
    
    document.querySelectorAll(`[id^="${prefix}-"]`).forEach(el => {
        if (el.dataset && el.dataset.type === 'input') {
            const ans = el.dataset.ans;
            const eyeBtn = document.getElementById(el.id + '-eye');
            
            if (ans) {
                el.value = ans;
                el.classList.add('correct');
                el.classList.remove('incorrect-marked');
                adjustWidth(el);
                if (eyeBtn) eyeBtn.classList.add('active');
                
                answerStates.set(`${el.id}-state`, true);
            }
        }
    });
    
    if (prefix === 'ex2' || prefix === 'ex3' || prefix === 'ex9') {
        updateWordBankDisplay(prefix);
    }
}

function resetSection(prefix) {
    document.querySelectorAll(`[id^="${prefix}"]`).forEach(i => { 
        if(i.tagName === 'INPUT') { 
            i.value = ""; 
            i.classList.remove('correct', 'incorrect-marked'); 
            adjustWidth(i); 
            answerStates.delete(`${i.id}-state`);
        } 
        
        const hBox = document.getElementById(i.id + '-hint'); 
        if(hBox) hBox.style.display = 'none'; 
    });
    
    document.querySelectorAll(`[id$="-eye"], [id$="-info"]`).forEach(btn => {
        if (btn.id.includes(prefix)) {
            btn.classList.remove('active');
        }
    });
    
    if (prefix === 'ex4' || prefix === 'ex6' || prefix === 'ex10' || prefix === 'ex11') {
        const allOptionBtns = document.querySelectorAll(`#questions-${prefix} .option-btn, #questions-${prefix} .mcq-option`);
        allOptionBtns.forEach(btn => {
            btn.classList.remove('selected', 'correct-option', 'incorrect-option', 'correct', 'incorrect');
        });
        
        for (const [key, value] of optionSelections.entries()) {
            if (key.startsWith(`${prefix}-`)) {
                optionSelections.delete(key);
            }
        }
        
        for (const [key, value] of readingSelections.entries()) {
            if (key.startsWith(`${prefix}-`)) {
                readingSelections.delete(key);
            }
        }
        
        for (const [key, value] of answerStates.entries()) {
            if (key.includes(`${prefix}-q`)) {
                answerStates.delete(key);
            }
        }
    }
    
    if (prefix === 'ex2' || prefix === 'ex3' || prefix === 'ex9') {
        const wordItems = document.querySelectorAll(`#bank-${prefix} .word-item`);
        wordItems.forEach(item => {
            item.classList.remove('used');
        });
        
        if (wordUsageCount[prefix]) {
            Object.keys(wordUsageCount[prefix]).forEach(word => {
                wordUsageCount[prefix][word] = 0;
            });
        }
    }
    
    if (prefix === 'ex12') {
        for (let i = 0; i < ex12_suggestions.length; i++) {
            const qid = `ex12-match-${i}`;
            const input = document.getElementById(qid);
            if (input) {
                input.value = "";
                input.classList.remove('correct');
                answerStates.delete(`${qid}-state`);
            }
        }
    }
}

function normalizeAnswer(answer) {
    if (!answer) return '';
    return answer.toLowerCase().trim().replace(/\s+/g, ' ');
}

function validateMultipleAnswers(userAnswer, correctAnswers) {
    const answers = correctAnswers.split('|').map(ans => normalizeAnswer(ans));
    const normalizedUser = normalizeAnswer(userAnswer);
    return answers.some(ans => ans === normalizedUser);
}

function checkAll() {
    document.querySelectorAll('[data-type="input"]').forEach(el => { 
        const correctAnswers = el.dataset.ans;
        const userAnswer = el.value;
        
        el.classList.remove('correct', 'incorrect-marked'); 
        
        if(!userAnswer.trim()) {
            return;
        }
        
        if(validateMultipleAnswers(userAnswer, correctAnswers)) {
            el.classList.add('correct');
        } else {
            el.classList.add('incorrect-marked');
        }
    });
    
    ['ex4', 'ex6', 'ex10'].forEach(taskId => {
        let data;
        if (taskId === 'ex4') data = ex4_data;
        else if (taskId === 'ex6') data = ex6_data;
        else data = ex10_data;
        
        data.forEach((item, i) => {
            const qid = `${taskId}-q${i}`;
            const selectedOption = optionSelections.get(qid);
            const correctAnswer = item.ans;
            
            if (!selectedOption) {
                return;
            }
            
            const optionButtons = [];
            for (let j = 0; j < item.options.length; j++) {
                const btn = document.getElementById(`${qid}-opt${j}`);
                if (btn) optionButtons.push(btn);
            }
            
            optionButtons.forEach(btn => {
                btn.classList.remove('correct-option', 'incorrect-option');
            });
            
            const userSelectedBtn = optionButtons.find(btn => btn.textContent === selectedOption);
            if (userSelectedBtn) {
                if (selectedOption === correctAnswer || 
                    (taskId === 'ex10' && selectedOption.startsWith(correctAnswer + ' '))) {
                    userSelectedBtn.classList.add('correct-option');
                } else {
                    userSelectedBtn.classList.add('incorrect-option');
                }
            }
        });
    });
    
    ex11_data.forEach((item, i) => {
        const qid = `ex11-q${i}`;
        const userSelection = readingSelections.get(qid);
        const correctIndex = item.correct;
        
        const options = document.querySelectorAll(`#${qid}-container .mcq-option`);
        options.forEach((option, index) => {
            option.classList.remove('correct', 'incorrect', 'selected');
            
            if (userSelection !== undefined) {
                if (index === userSelection) {
                    if (userSelection === correctIndex) {
                        option.classList.add('correct');
                    } else {
                        option.classList.add('incorrect');
                    }
                }
            }
        });
    });
}

function addWordBankEventListeners(id) {
    const wordItems = document.querySelectorAll(`#bank-${id} .word-item`);
    const inputs = document.querySelectorAll(`#questions-${id} input.word-input`);
    
    wordItems.forEach(item => {
        item.addEventListener('click', function() {
            selectWordFromBank(this.id);
        });
        
        item.addEventListener('dragstart', function(e) {
            dragWord(e);
        });
    });
    
    inputs.forEach(input => {
        input.addEventListener('dragover', function(e) {
            allowDrop(e);
        });
        
        input.addEventListener('drop', function(e) {
            dropWord(e, this.id);
        });
    });
}

function initializeResizer() {
    const resizer = document.getElementById('resizer-ex11');
    const leftPanel = document.getElementById('text-panel-ex11');
    const rightPanel = document.getElementById('questions-panel-ex11');
    
    if (!resizer || !leftPanel || !rightPanel) return;
    
    leftPanel.style.width = '50%';
    rightPanel.style.flex = '1';
    
    let isResizing = false;
    let startX = 0;
    let startLeftWidth = 0;
    
    resizer.addEventListener('mousedown', function(e) {
        isResizing = true;
        startX = e.clientX;
        startLeftWidth = leftPanel.offsetWidth;
        
        document.body.style.cursor = 'col-resize';
        document.body.style.userSelect = 'none';
        
        document.addEventListener('mousemove', handleMouseMove);
        document.addEventListener('mouseup', handleMouseUp);
    });
    
    function handleMouseMove(e) {
        if (!isResizing) return;
        
        const dx = e.clientX - startX;
        const newLeftWidth = startLeftWidth + dx;
        
        const containerWidth = leftPanel.parentElement.offsetWidth;
        const minWidth = 200;
        const maxWidth = containerWidth - minWidth - resizer.offsetWidth;
        
        if (newLeftWidth >= minWidth && newLeftWidth <= maxWidth) {
            leftPanel.style.width = newLeftWidth + 'px';
            rightPanel.style.flex = '1';
        }
    }
    
    function handleMouseUp() {
        isResizing = false;
        document.body.style.cursor = '';
        document.body.style.userSelect = '';
        
        document.removeEventListener('mousemove', handleMouseMove);
        document.removeEventListener('mouseup', handleMouseUp);
    }
}

function initializeTextHighlighting() {
    contextMenu = document.getElementById('context-menu');
    const highlightBtn = document.getElementById('highlight-text');
    const removeHighlightBtn = document.getElementById('remove-highlight');
    const clearHighlightsBtn = document.getElementById('clear-highlights');
    
    document.addEventListener('contextmenu', function(e) {
        const selection = window.getSelection();
        if (selection.toString().trim() && 
            (e.target.closest('.reading-text') || e.target.closest('.text-panel'))) {
            selectedTextRange = saveSelection();
            
            contextMenu.style.display = 'block';
            contextMenu.style.left = e.pageX + 'px';
            contextMenu.style.top = e.pageY + 'px';
            
            e.preventDefault();
        } else {
            contextMenu.style.display = 'none';
        }
    });
    
    document.addEventListener('click', function(e) {
        if (contextMenu && !contextMenu.contains(e.target)) {
            contextMenu.style.display = 'none';
        }
    });
    
    if (highlightBtn) {
        highlightBtn.addEventListener('click', function() {
            if (selectedTextRange) {
                highlightSelection(selectedTextRange);
                contextMenu.style.display = 'none';
            }
        });
    }
    
    if (removeHighlightBtn) {
        removeHighlightBtn.addEventListener('click', function() {
            if (selectedTextRange) {
                removeHighlightFromSelection(selectedTextRange);
                contextMenu.style.display = 'none';
            }
        });
    }
    
    if (clearHighlightsBtn) {
        clearHighlightsBtn.addEventListener('click', function() {
            clearAllHighlights();
            contextMenu.style.display = 'none';
        });
    }
}

function saveSelection() {
    const selection = window.getSelection();
    if (selection.rangeCount === 0) return null;
    return selection.getRangeAt(0).cloneRange();
}

function highlightSelection(range) {
    if (!range) return;
    
    const span = document.createElement('span');
    span.className = 'highlighted-text';
    
    try {
        range.surroundContents(span);
    } catch(e) {
        const div = document.createElement('div');
        div.innerHTML = range.toString();
        span.innerHTML = div.innerHTML;
        range.deleteContents();
        range.insertNode(span);
    }
    
    window.getSelection().removeAllRanges();
}

function removeHighlightFromSelection(range) {
    if (!range) return;
    
    const parent = range.commonAncestorContainer;
    const highlightSpans = parent.parentElement.querySelectorAll('.highlighted-text');
    
    highlightSpans.forEach(span => {
        if (range.intersectsNode(span)) {
            const parent = span.parentNode;
            while (span.firstChild) {
                parent.insertBefore(span.firstChild, span);
            }
            parent.removeChild(span);
        }
    });
    
    window.getSelection().removeAllRanges();
}

function clearAllHighlights() {
    const highlights = document.querySelectorAll('.highlighted-text');
    highlights.forEach(highlight => {
        const parent = highlight.parentNode;
        while (highlight.firstChild) {
            parent.insertBefore(highlight.firstChild, highlight);
        }
        parent.removeChild(highlight);
    });
}

// Initialize everything
window.onload = () => {
    renderEx1();
    renderEx2();
    renderEx3();
    renderEx4();
    renderEx5();
    renderEx6();
    renderEx7();
    renderEx8();
    renderEx9();
    renderEx10();
    renderEx11();
    renderEx12();
    renderEx14();
    renderEx15();
    initializeResizer();
    initializeTextHighlighting();
};

document.addEventListener('keydown', e => { 
    if(e.key === 'Enter') {
        checkAll(); 
    }
});
</script>
</body>
</html>