<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Access 4 - Review Module 3</title>
    <style>
        :root {
            --primary: #2980b9; 
            --primary-dark: #1c5982; 
            --success: #27ae60;
            --error: #e74c3c; 
            --warning: #f1c40f; 
            --bg: #f4f7f9;
            --text: #2c3e50; 
            --card: #ffffff;
            --selection: #3498db;
            --selection-bg: #ebf5fb;
        }
        
        body { 
            font-family: 'Times New Roman', serif; 
            font-size: 13pt; 
            background-color: var(--bg); 
            color: var(--text); 
            margin: 0; 
            padding: 20px 20px 150px 20px;
            line-height: 1.6; 
        }
        
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
        }
        
        .sticky-bank { 
            position: sticky; 
            top: 15px; 
            z-index: 100;
            background-color: #fff; 
            padding: 15px; 
            border-radius: 10px; 
            margin-bottom: 25px; 
            border: 2px solid var(--primary); 
            display: flex; 
            flex-wrap: wrap; 
            gap: 10px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }
        
        .word-item { 
            background: #eef2f7; 
            border: 1px solid var(--primary); 
            color: var(--primary-dark); 
            padding: 6px 12px; 
            border-radius: 5px; 
            cursor: grab; 
            user-select: none; 
            transition: 0.2s; 
            font-size: 0.9em; 
            font-weight: 500;
        }
        
        .word-item.used { 
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        .word-item:hover:not(.used) { 
            background: var(--primary); 
            color: white; 
        }

        .exercise-card { 
            background: var(--card); 
            border-radius: 12px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); 
            padding: 25px; 
            margin-bottom: 30px; 
        }
        
        .exercise-title { 
            font-weight: bold; 
            font-size: 1.25em; 
            margin-bottom: 18px; 
            color: var(--primary-dark); 
            border-bottom: 2px solid #eee; 
            padding-bottom: 8px; 
        }
        
        .question-row { 
            margin-bottom: 18px; 
            line-height: 2.2; 
            border-bottom: 1px solid #f9f9f9; 
            padding-bottom: 10px; 
            position: relative; 
        }
        
        input[type="text"] { 
            border: none; 
            border-bottom: 2px solid #bdc3c7; 
            background: #fafafa; 
            padding: 2px 8px; 
            font-size: 1em; 
            transition: 0.2s; 
            outline: none;
            min-width: 60px; 
            border-radius: 4px 4px 0 0; 
            text-align: center; 
            font-family: 'Times New Roman';
            box-sizing: border-box;
        }
        
        input.letter-input { 
            width: 45px; 
            min-width: 45px; 
            max-width: 80px;
            text-transform: uppercase; 
            font-weight: bold; 
            color: var(--primary-dark); 
        }
        
        input.word-input { 
            min-width: 120px; 
            max-width: 400px;
            text-align: left; 
        }
        
        input.correct { 
            border-bottom-color: var(--success) !important; 
            background-color: #e8f8f5 !important; 
            color: #1e8449 !important; 
        }
        
        input.incorrect-marked { 
            border-bottom-color: var(--error) !important; 
            background-color: #fdedec !important; 
        }

        .row-btns { 
            display: inline-flex; 
            gap: 5px; 
            vertical-align: middle; 
            margin-left: 10px; 
        }
        
        .btn-small { 
            background: #eee; 
            border: 1px solid #ccc; 
            border-radius: 4px; 
            width: 28px; 
            height: 28px; 
            cursor: pointer; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 14px; 
            transition: 0.2s;
        }
        
        .btn-small:hover {
            background: #ddd;
        }
        
        .btn-small.active {
            background: #3498db;
            color: white;
            border-color: #2980b9;
        }
        
        .info-btn { 
            background: #95a5a6; 
            color: white; 
            border: none; 
            border-radius: 50%; 
            width: 20px; 
            height: 20px; 
            font-size: 11px; 
            cursor: pointer; 
            display: inline-flex; 
            align-items: center; 
            justify-content: center; 
            transition: 0.2s;
        }
        
        .info-btn:hover {
            background: #7f8c8d;
        }
        
        .info-btn.active {
            background: #5d6d6e;
        }
        
        .hint-box { 
            display: none; 
            margin-top: 8px; 
            padding: 10px; 
            background-color: #fef9e7; 
            border-left: 4px solid var(--warning); 
            color: #7d6608; 
            border-radius: 4px; 
            font-size: 0.85em; 
        }
        
        .controls-row { 
            display: flex; 
            justify-content: flex-end; 
            gap: 10px; 
            margin-top: 15px; 
        }
        
        .btn { 
            padding: 8px 20px; 
            border-radius: 6px; 
            cursor: pointer; 
            border: none; 
            font-weight: bold; 
            transition: 0.3s; 
        }
        
        .btn-reset { 
            background: #95a5a6; 
            color: white; 
        }
        
        .btn-show-all { 
            background: var(--primary); 
            color: white; 
        }
        
        .check-all-btn { 
            position: fixed; 
            right: 45px;
            bottom: 30px; 
            background-color: var(--success); 
            color: white; 
            padding: 15px 30px; 
            border-radius: 50px; 
            cursor: pointer; 
            z-index: 10000;
            font-weight: bold; 
            border: none; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.2); 
        }
        
        .odd-one-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        .odd-one-table th {
            background-color: #e3f2fd;
            padding: 12px;
            text-align: left;
            border: 1px solid #ddd;
        }
        
        .odd-one-table td {
            padding: 12px;
            border: 1px solid #ddd;
            vertical-align: top;
        }
        
        .odd-one-table input {
            width: 150px;
            min-width: 150px;
        }
        
        .web-diagram-container {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            justify-content: space-between;
            margin: 20px 0;
        }
        
        .web-category {
            flex: 1;
            min-width: 250px;
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #e9ecef;
        }
        
        .web-category h3 {
            margin-top: 0;
            color: var(--primary-dark);
            text-align: center;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        
        .web-words {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }
        
        .web-word-input {
            width: 100%;
            box-sizing: border-box;
        }
        
        .dual-screen-container {
            display: flex;
            margin: 20px 0;
            position: relative;
            height: 450px;
        }
        
        .people-panel, .restaurants-panel {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #e9ecef;
            overflow-y: auto;
            position: relative;
            user-select: text;
            height: 100%;
        }
        
        .people-panel {
            width: 50%;
            min-width: 200px;
            max-width: calc(100% - 210px);
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
        }
        
        .restaurants-panel {
            width: 50%;
            min-width: 200px;
            max-width: calc(100% - 210px);
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
        }
        
        .people-panel h3, .restaurants-panel h3 {
            margin-top: 0;
            color: var(--primary-dark);
            text-align: center;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        
        .person-item, .restaurant-item {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .person-number, .restaurant-letter {
            font-weight: bold;
            color: var(--primary);
            margin-right: 10px;
            background-color: #e3f2fd;
            padding: 4px 8px;
            border-radius: 4px;
        }
        
        .matching-input {
            width: 80px;
            margin-left: 10px;
            text-align: center;
            font-weight: bold;
        }
        
        .instructions {
            color: #7f8c8d;
            font-size: 0.95em;
            margin-bottom: 15px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        
        .existing-number {
            font-weight: bold;
            color: var(--primary);
            margin-right: 8px;
        }
        
        .option-container {
            display: inline-flex;
            gap: 10px;
            margin-left: 10px;
            margin-right: 10px;
            flex-wrap: wrap;
        }
        
        .option-btn {
            background: #eef2f7;
            border: 2px solid #bdc3c7;
            border-radius: 6px;
            padding: 6px 15px;
            cursor: pointer;
            font-weight: 500;
            transition: 0.2s;
            min-width: 80px;
            text-align: center;
            font-size: 0.9em;
        }
        
        .option-btn:hover {
            background: #dfe6f0;
            border-color: #95a5a6;
        }
        
        .option-btn.selected {
            background: #3498db;
            color: white;
            border-color: #2980b9;
        }
        
        .option-btn.correct-option {
            background: #27ae60;
            color: white;
            border-color: #219653;
        }
        
        .option-btn.incorrect-option {
            background: #e74c3c;
            color: white;
            border-color: #c0392b;
        }
        
        .bold-option {
            font-weight: bold;
            color: var(--primary-dark);
        }
        
        .resizer {
            position: relative;
            width: 10px;
            background-color: #ddd;
            cursor: col-resize;
            z-index: 10;
            flex-shrink: 0;
            margin: 0;
        }
        
        .resizer:hover {
            background-color: #3498db;
        }
        
        .resizer::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 2px;
            height: 40px;
            background-color: #95a5a6;
            border-radius: 1px;
        }
        
        .context-menu {
            position: absolute;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 10000;
            min-width: 150px;
            display: none;
        }
        
        .context-menu-item {
            padding: 8px 12px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background-color 0.2s;
        }
        
        .context-menu-item:hover {
            background-color: #f5f5f5;
        }
        
        .highlighted-text {
            background-color: rgba(255, 255, 0, 0.3) !important;
            padding: 0 2px;
            border-radius: 2px;
        }
        
        html {
            overflow-x: hidden;
        }
        
        body {
            overflow-y: scroll;
            padding-right: 0 !important;
        }
        
        @media (max-width: 768px) {
            .check-all-btn {
                right: 15px;
                bottom: 20px;
                padding: 12px 20px;
                font-size: 0.9em;
            }
            
            body {
                padding: 15px 15px 120px 15px;
            }
        }
    </style>
</head>
<body>

<div class="container">
    <h1 style="text-align: center; color: var(--primary-dark); margin-bottom: 30px;">Access 4 - Review Module 3</h1>
    
    <div class="exercise-card">
        <div class="exercise-title">Vocabulary</div>
        
        <div class="instructions">1. Circle the item that is out of place. Then explain why it is out of place and add another item to each category.</div>
        
        <table class="odd-one-table" id="table-t1">
            <thead>
                <tr>
                    <th>List</th>
                    <th>Reason (Odd One Out)</th>
                    <th>New Word</th>
                </tr>
            </thead>
            <tbody id="questions-t1"></tbody>
        </table>
        <div class="controls-row">
            <button class="btn btn-show-all" onclick="showAnswers('t1')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('t1')">Reset</button>
        </div>
        
        <div class="instructions">2. Complete the web diagrams using the words below.</div>
        
        <div class="sticky-bank" id="bank-t2"></div>
        
        <div class="web-diagram-container" id="web-t2"></div>
        <div class="controls-row">
            <button class="btn btn-show-all" onclick="showAnswers('t2')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('t2')">Reset</button>
        </div>
        
        <div class="instructions">3. Circle the correct word.</div>
        <div id="questions-t3"></div>
        <div class="controls-row">
            <button class="btn btn-show-all" onclick="showAnswers('t3')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('t3')">Reset</button>
        </div>
        
        <div class="instructions">4. Using the words below, complete the phrases.</div>
        
        <div class="sticky-bank" id="bank-t4"></div>
        
        <div id="questions-t4"></div>
        <div class="controls-row">
            <button class="btn btn-show-all" onclick="showAnswers('t4')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('t4')">Reset</button>
        </div>
        
        <div class="instructions">5. Read the definitions below. Then write the correct word in the blanks that follow.</div>
        <div id="questions-t5"></div>
        <div class="controls-row">
            <button class="btn btn-show-all" onclick="showAnswers('t5')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('t5')">Reset</button>
        </div>
    </div>
    
    <div class="exercise-card">
        <div class="exercise-title">Grammar</div>
        
        <div class="instructions">6. Underline the correct form of the verb.</div>
        <div id="questions-t6"></div>
        <div class="controls-row">
            <button class="btn btn-show-all" onclick="showAnswers('t6')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('t6')">Reset</button>
        </div>
        
        <div class="instructions">7. Complete the email by putting the correct verb in the present perfect or the present perfect progressive.</div>
        
        <div class="sticky-bank" id="bank-t7"></div>
        
        <div id="questions-t7"></div>
        <div class="controls-row">
            <button class="btn btn-show-all" onclick="showAnswers('t7')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('t7')">Reset</button>
        </div>
        
        <div class="instructions">8. Fill in the blanks using the correct form of: go through, go after, go up, go on, go for, go about.</div>
        <div id="questions-t8"></div>
        <div class="controls-row">
            <button class="btn btn-show-all" onclick="showAnswers('t8')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('t8')">Reset</button>
        </div>
        
        <div class="instructions">9. Circle the correct preposition.</div>
        <div id="questions-t9"></div>
        <div class="controls-row">
            <button class="btn btn-show-all" onclick="showAnswers('t9')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('t9')">Reset</button>
        </div>
        
        <div class="instructions">10. Fill in the blanks with a verb in the correct form derived from the words in capitals.</div>
        <div id="questions-t10"></div>
        <div class="controls-row">
            <button class="btn btn-show-all" onclick="showAnswers('t10')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('t10')">Reset</button>
        </div>
    </div>
    
    <div class="exercise-card">
        <div class="exercise-title">Grammar Review</div>
        
        <div class="instructions">11. Circle the correct item.</div>
        <div id="questions-t11"></div>
        <div class="controls-row">
            <button class="btn btn-show-all" onclick="showAnswers('t11')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('t11')">Reset</button>
        </div>
    </div>
    
    <div class="exercise-card">
        <div class="exercise-title">Restaurant Matching - Dual Screen Reading</div>
        
        <div class="instructions">12. The people below are all looking for a restaurant to go to. There are eight restaurant reviews. Decide which restaurant would be the most suitable for the following people.</div>
        
        <div class="dual-screen-container" id="dual-screen-t12">
            <div class="people-panel" id="people-panel-t12">
                <h3>People Looking for Restaurants</h3>
                <div id="people-t12"></div>
            </div>
            
            <div class="resizer" id="resizer-t12"></div>
            
            <div class="restaurants-panel" id="restaurants-panel-t12">
                <h3>Restaurant Reviews</h3>
                <div id="restaurants-t12"></div>
            </div>
        </div>
        
        <div class="controls-row" style="margin-top: 40px !important; display: block !important; clear: both !important; position: relative !important; z-index: 1000; background: #f8f9fa; padding: 20px; border-radius: 8px; border: 1px solid #e9ecef;">
            <button class="btn btn-show-all" onclick="showAnswers('t12')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('t12')">Reset</button>
        </div>
    </div>
</div>

<button class="check-all-btn" onclick="checkAll()">CHECK ALL ANSWERS (ENTER)</button>

<div class="context-menu" id="context-menu">
    <div class="context-menu-item" id="highlight-text">Highlight Text</div>
    <div class="context-menu-item" id="remove-highlight">Remove Highlight</div>
    <div class="context-menu-item" id="clear-highlights">Clear All Highlights</div>
</div>

<script>
// Tất cả dữ liệu và hàm JavaScript ở đây
const t1_data = [
    { 
        list: "fork – flour – knife – spoon", 
        reason: "the other 3 are kitchen utensils", 
        newWord: "spatula",
        hint: "Flour is a food ingredient, while fork, knife, and spoon are kitchen utensils used for eating or cooking."
    },
    { 
        list: "carrots – broccoli – eggs – onions", 
        reason: "the other 3 are vegetables", 
        newWord: "lettuce",
        hint: "Eggs come from animals (poultry), while carrots, broccoli, and onions are vegetables that grow in the ground."
    },
    { 
        list: "meat – cheese – chicken – fish", 
        reason: "it is a dairy product", 
        newWord: "lobster",
        hint: "Cheese is a dairy product made from milk, while meat, chicken, and fish are animal proteins."
    },
    { 
        list: "frying pan – saucepan – dish – stove", 
        reason: "the other 3 are kitchen utensils", 
        newWord: "glass",
        hint: "A stove is an appliance for cooking, while frying pan, saucepan, and dish are types of cookware or servingware."
    }
];

const t2_categories = [
    { title: "kitchen utensils", correct: ["fork", "knife", "spoon", "saucepan"], hint: "Kitchen utensils are tools used for cooking, serving, or eating food." },
    { title: "food", correct: ["meat", "chicken", "eggs", "fish"], hint: "These are all sources of protein that can be cooked and eaten." },
    { title: "vegetables", correct: ["broccoli", "onions", "cauliflower", "celery"], hint: "These are all edible plants that are typically eaten as part of a meal." }
];

const t2_wordBank = [
    "meat", "broccoli", "fork", "onions", "chicken", 
    "knife", "cauliflower", "eggs", "spoon", "celery", 
    "fish", "saucepan"
];

const t3_data = [
    { 
        q: "Ted likes <span class='bold-option'>steamed</span> / <span class='bold-option'>poached</span> eggs while I prefer <span class='bold-option'>baked</span> / <span class='bold-option'>scrambled</span> eggs.", 
        ans: "poached, scrambled", 
        hint: "Poached eggs are cooked in simmering water without shells. Scrambled eggs are beaten and cooked in a pan.",
        options: ["steamed, baked", "poached, scrambled", "steamed, scrambled", "poached, baked"]
    },
    { 
        q: "Mom made a great <span class='bold-option'>scrambled</span> / <span class='bold-option'>steamed</span> vegetable and rice dish the other day.", 
        ans: "steamed", 
        hint: "Steamed vegetables are cooked with steam, which preserves nutrients and texture.",
        options: ["scrambled", "steamed"]
    },
    { 
        q: "We're having <span class='bold-option'>roast</span> / <span class='bold-option'>poached</span> chicken and potatoes for supper tonight.", 
        ans: "roast", 
        hint: "Roast chicken is cooked in an oven, typically with potatoes as a side dish.",
        options: ["roast", "poached"]
    },
    { 
        q: "<span class='bold-option'>Boiled</span> / <span class='bold-option'>Sliced</span> food isn't as tasty as fried food, but it's much healthier.", 
        ans: "Boiled", 
        hint: "Boiled food is cooked in boiling water, which is a healthier cooking method than frying.",
        options: ["Boiled", "Sliced"]
    },
    { 
        q: "My brother loves to eat <span class='bold-option'>scrambled</span> / <span class='bold-option'>grilled</span> fish in the summer.", 
        ans: "grilled", 
        hint: "Grilled fish is cooked on a grill, often outdoors, which is popular in summer.",
        options: ["scrambled", "grilled"]
    },
    { 
        q: "Freshly <span class='bold-option'>baked</span> / <span class='bold-option'>grilled</span> bread is always delicious.", 
        ans: "baked", 
        hint: "Bread is typically baked in an oven, not grilled.",
        options: ["baked", "grilled"]
    }
];

const t4_data = [
    { q: "______ the cheese.", ans: "grate", hint: "Grating cheese means shredding it into small pieces using a grater." },
    { q: "______ the butter.", ans: "melt", hint: "Melting butter means heating it until it becomes liquid." },
    { q: "______ the eggs.", ans: "beat", hint: "Beating eggs means mixing them vigorously with a fork or whisk." },
    { q: "______ the onions.", ans: "chop", hint: "Chopping onions means cutting them into small pieces with a knife." },
    { q: "______ the potatoes.", ans: "peel", hint: "Peeling potatoes means removing the skin with a peeler or knife." },
    { q: "______ the bread.", ans: "slice", hint: "Slicing bread means cutting it into thin pieces with a knife." }
];

const t4_wordBank = ["chop", "beat", "slice", "peel", "grate", "melt"];

const t5_data = [
    { 
        q: "a place where you can send letters and buy stamps", 
        ans: "post office", 
        hint: "A post office handles mail services including sending letters and selling stamps."
    },
    { 
        q: "a place where you can buy plants and flowers", 
        ans: "flower shop", 
        hint: "A flower shop (or florist) sells plants, flowers, and sometimes arrangements."
    },
    { 
        q: "a place where you can buy medicine", 
        ans: "pharmacy", 
        hint: "A pharmacy (or drugstore) sells prescription and over-the-counter medications."
    },
    { 
        q: "a place where you can buy newspapers and magazines", 
        ans: "newsstand", 
        hint: "A newsstand sells newspapers, magazines, and sometimes snacks or drinks."
    },
    { 
        q: "a place where you can have your eyes checked", 
        ans: "eyewear store", 
        hint: "An eyewear store (or optician) sells glasses and can perform eye exams."
    },
    { 
        q: "a place where you can buy seafood", 
        ans: "fish market", 
        hint: "A fish market specializes in selling fresh fish and other seafood."
    },
    { 
        q: "a place where you can have your hair cut and blow-dried", 
        ans: "hairdresser's", 
        hint: "A hairdresser's (or hair salon) provides hair cutting, styling, and other beauty services."
    },
    { 
        q: "a place where you can buy a loaf of bread", 
        ans: "bakery", 
        hint: "A bakery sells bread, pastries, cakes, and other baked goods."
    },
    { 
        q: "a place where you can buy rings, necklaces, and bracelets", 
        ans: "jewelry store", 
        hint: "A jewelry store sells items like rings, necklaces, bracelets, and other accessories made of precious metals and gems."
    }
];

const t6_data = [
    { 
        q: "We <span class='bold-option'>ate</span> / <span class='bold-option'>have eaten</span> supper two hours ago.", 
        ans: "ate", 
        hint: "Use simple past with specific time expressions like 'two hours ago'.",
        options: ["ate", "have eaten"]
    },
    { 
        q: "I <span class='bold-option'>haven't seen</span> / <span class='bold-option'>didn't see</span> that movie yet.", 
        ans: "haven't seen", 
        hint: "Use present perfect with 'yet' for unfinished time.",
        options: ["haven't seen", "didn't see"]
    },
    { 
        q: "Ben <span class='bold-option'>didn't study</span> / <span class='bold-option'>hasn't studied</span> yet.", 
        ans: "hasn't studied", 
        hint: "Use present perfect with 'yet' for actions not completed.",
        options: ["didn't study", "hasn't studied"]
    },
    { 
        q: "Maria <span class='bold-option'>has gone</span> / <span class='bold-option'>went</span> shopping last week.", 
        ans: "went", 
        hint: "Use simple past with specific time expressions like 'last week'.",
        options: ["has gone", "went"]
    },
    { 
        q: "He <span class='bold-option'>screamed</span> / <span class='bold-option'>has screamed</span> when he saw a snake in his room.", 
        ans: "screamed", 
        hint: "Use simple past for completed actions in sequence.",
        options: ["screamed", "has screamed"]
    },
    { 
        q: "Beth <span class='bold-option'>didn't talk</span> / <span class='bold-option'>hasn't talked</span> to Luke since last month.", 
        ans: "hasn't talked", 
        hint: "Use present perfect with 'since' for actions continuing from past to present.",
        options: ["didn't talk", "hasn't talked"]
    },
    { 
        q: "Tom <span class='bold-option'>visited</span> / <span class='bold-option'>has visited</span> his aunt last night.", 
        ans: "visited", 
        hint: "Use simple past with specific time expressions like 'last night'.",
        options: ["visited", "has visited"]
    },
    { 
        q: "I <span class='bold-option'>have bought</span> / <span class='bold-option'>bought</span> a beautiful blouse when I went shopping three days ago.", 
        ans: "bought", 
        hint: "Use simple past with specific time expressions like 'three days ago'.",
        options: ["have bought", "bought"]
    },
    { 
        q: "Joe <span class='bold-option'>hasn't had</span> / <span class='bold-option'>didn't have</span> lunch yet.", 
        ans: "hasn't had", 
        hint: "Use present perfect with 'yet' for actions not completed.",
        options: ["hasn't had", "didn't have"]
    }
];

const t7_data = [
    { 
        q: "Hey Ashley, How are you? I'm sorry it 1) ______ me so long to respond to your letter, but I 2) ______ very busy the past week.", 
        ans: ["has taken", "have been"],
        hint: "'Has taken' is present perfect for completed action. 'Have been' is present perfect for state continuing to present."
    },
    { 
        q: "I 3) ______ every day because I have three exams next week.", 
        ans: "have been studying",
        hint: "Use present perfect progressive for ongoing action (studying) with recent time reference."
    },
    { 
        q: "I 4) ______ also ______ for my tennis competition which is in two weeks.", 
        ans: ["have", "been training"],
        hint: "Use present perfect progressive for ongoing training leading up to future event."
    },
    { 
        q: "5) ______ you ______ anything fun or exciting lately?", 
        ans: ["Have", "been doing"],
        hint: "Use present perfect progressive with 'lately' for recent ongoing activities."
    },
    { 
        q: "P.S. 6) ______ you ______ to Joanne lately? I 7) ______ her since last month.", 
        ans: ["Have", "spoken", "haven't seen"],
        hint: "'Have spoken' is present perfect for recent communication. 'Haven't seen' is present perfect with 'since'."
    }
];

const t7_wordBank = ["train", "do", "be", "speak", "not see", "take", "study"];

const t8_data = [
    { q: "Dad always told me that I should ______ my dreams.", ans: "go after", hint: "'Go after' means to pursue or try to achieve something." },
    { q: "Rick has been ______ a very difficult time which is why he's been so quiet lately.", ans: "going through", hint: "'Go through' means to experience something difficult." },
    { q: "Mom wants to sell our car, but it won't ______ much because it's very old.", ans: "go for", hint: "'Go for' in this context means to be sold for a certain price." },
    { q: "The price of food ______ last week. Now, it's more expensive than ever.", ans: "went up", hint: "'Go up' means to increase or rise." },
    { q: "I don't know how to ______ telling Sam that I don't like him.", ans: "go about", hint: "'Go about' means to approach or deal with something." },
    { q: "'Hi Sue. I haven't seen you in a long time. What's ______?'", ans: "going on", hint: "'Go on' means to happen or occur." }
];

const t9_data = [
    { 
        q: "Many people are allergic <span class='bold-option'>to</span> / <span class='bold-option'>with</span> different types of food, so they suffer <span class='bold-option'>for</span> / <span class='bold-option'>from</span> various symptoms.", 
        ans: "to, from", 
        hint: "'Allergic to' is correct preposition. 'Suffer from' means to experience something unpleasant.",
        options: ["to, for", "with, from", "to, from", "with, for"]
    },
    { 
        q: "She always goes out <span class='bold-option'>for</span> / <span class='bold-option'>with</span> her friends <span class='bold-option'>at</span> / <span class='bold-option'>on</span> the weekends.", 
        ans: "with, on", 
        hint: "'Go out with' means to socialize with someone. 'On the weekends' is correct time expression.",
        options: ["for, at", "with, on", "for, on", "with, at"]
    },
    { 
        q: "Isabelle lived <span class='bold-option'>at</span> / <span class='bold-option'>in</span> Spain for nine years.", 
        ans: "in", 
        hint: "'In' is used for countries, cities, and large areas.",
        options: ["at", "in"]
    },
    { 
        q: "I'm going <span class='bold-option'>for</span> / <span class='bold-option'>on</span> a diet to lose some weight.", 
        ans: "on", 
        hint: "'On a diet' means following a specific eating plan.",
        options: ["for", "on"]
    }
];

const t10_data = [
    { q: "Elizabeth ______ her name to Lisa. SHORT", ans: "shortened", hint: "From 'short' to 'shorten' - to make something shorter." },
    { q: "Don't forget to ______ your seatbelts. FAST", ans: "fasten", hint: "From 'fast' to 'fasten' - to secure or attach firmly." },
    { q: "Can you ______ that picture on the wall for me, please? STRAIGHT", ans: "straighten", hint: "From 'straight' to 'straighten' - to make something straight." },
    { q: "______ the cloth before you use it. DAMP", ans: "Dampen", hint: "From 'damp' to 'dampen' - to make slightly wet." }
];

const t11_data = [
    { 
        q: "Sara always <span class='bold-option'>playing</span> / <span class='bold-option'>plays</span> / <span class='bold-option'>play</span> with her dog Rex after school.", 
        ans: "plays", 
        hint: "Third person singular (Sara) requires 'plays' with adverb 'always'.",
        options: ["playing", "plays", "play"]
    },
    { 
        q: "<span class='bold-option'>Who</span> / <span class='bold-option'>How often</span> / <span class='bold-option'>How</span> old is Adam?", 
        ans: "How", 
        hint: "'How old' is the correct question phrase for asking about age.",
        options: ["Who", "How often", "How"]
    },
    { 
        q: "Grandma usually visits us <span class='bold-option'>in</span> / <span class='bold-option'>on</span> / <span class='bold-option'>at</span> July.", 
        ans: "in", 
        hint: "'In' is used for months, seasons, and years.",
        options: ["in", "on", "at"]
    },
    { 
        q: "<span class='bold-option'>Me</span> / <span class='bold-option'>Mine</span> / <span class='bold-option'>My</span> brother's name is Ted.", 
        ans: "My", 
        hint: "'My' is a possessive adjective used before a noun.",
        options: ["Me", "Mine", "My"]
    },
    { 
        q: "I cooked <span class='bold-option'>an</span> / <span class='bold-option'>a</span> / <span class='bold-option'>the</span> delicious meal last night.", 
        ans: "a", 
        hint: "'A' is used before consonant sounds (delicious).",
        options: ["an", "a", "the"]
    },
    { 
        q: "<span class='bold-option'>An</span> / <span class='bold-option'>The</span> / <span class='bold-option'>The</span> little girl was eating <span class='bold-option'>the</span> / <span class='bold-option'>an</span> / <span class='bold-option'>a</span> big piece of chocolate cake.", 
        ans: "The - a", 
        hint: "'The' for specific girl, 'a' for non-specific piece of cake.",
        options: ["An - the", "The - an", "The - a"]
    },
    { 
        q: "They never <span class='bold-option'>watch</span> / <span class='bold-option'>watching</span> / <span class='bold-option'>watches</span> television.", 
        ans: "watch", 
        hint: "Plural subject 'they' requires base verb form 'watch'.",
        options: ["watch", "watching", "watches"]
    },
    { 
        q: "We <span class='bold-option'>going</span> / <span class='bold-option'>are go</span> / <span class='bold-option'>are going</span> to the movies this Friday night.", 
        ans: "are going", 
        hint: "Present continuous for future plans: 'are going'.",
        options: ["going", "are go", "are going"]
    },
    { 
        q: "My parents <span class='bold-option'>are sleeping</span> / <span class='bold-option'>sleep</span> / <span class='bold-option'>slept</span> right now.", 
        ans: "are sleeping", 
        hint: "Present continuous for actions happening now: 'are sleeping'.",
        options: ["are sleeping", "sleep", "slept"]
    },
    { 
        q: "Greg is going out <span class='bold-option'>play</span> / <span class='bold-option'>to playing</span> / <span class='bold-option'>to play</span> football with his friends.", 
        ans: "to play", 
        hint: "'To + base verb' after 'going out' to express purpose.",
        options: ["play", "to playing", "to play"]
    },
    { 
        q: "I can't <span class='bold-option'>come down</span> / <span class='bold-option'>come up</span> / <span class='bold-option'>come out</span> with the answers to my math homework. I'm never going to finish!", 
        ans: "come up", 
        hint: "'Come up with' means to think of or produce an idea.",
        options: ["come down", "come up", "come out"]
    },
    { 
        q: "He <span class='bold-option'>wash</span> / <span class='bold-option'>washed</span> / <span class='bold-option'>washed</span> the dishes after dinner and then <span class='bold-option'>goes</span> / <span class='bold-option'>gone</span> / <span class='bold-option'>went</span> to sleep.", 
        ans: "washed - went", 
        hint: "Simple past sequence: 'washed' then 'went'.",
        options: ["wash - goes", "washed - gone", "washed - went"]
    },
    { 
        q: "I <span class='bold-option'>was reading</span> / <span class='bold-option'>read</span> / <span class='bold-option'>was reading</span> my favorite book while my sister <span class='bold-option'>watching</span> / <span class='bold-option'>was watching</span> / <span class='bold-option'>was watching</span> TV.", 
        ans: "was reading - was watching", 
        hint: "Past continuous for two simultaneous actions: 'was reading' and 'was watching'.",
        options: ["was reading - watching", "read - was watching", "was reading - was watching"]
    },
    { 
        q: "I saw <span class='bold-option'>her</span> / <span class='bold-option'>she</span> / <span class='bold-option'>hers</span> at the library last night.", 
        ans: "her", 
        hint: "'Her' is the object pronoun after the verb 'saw'.",
        options: ["her", "she", "hers"]
    },
    { 
        q: "<span class='bold-option'>Him</span> / <span class='bold-option'>He</span> / <span class='bold-option'>His</span> let me use his phone to call my parents.", 
        ans: "He", 
        hint: "'He' is the subject pronoun at the beginning of the sentence.",
        options: ["Him", "He", "His"]
    },
    { 
        q: "She <span class='bold-option'>use to</span> / <span class='bold-option'>use</span> / <span class='bold-option'>used to</span> visit her grandparents every weekend when she was younger.", 
        ans: "used to", 
        hint: "'Used to' expresses past habits or routines.",
        options: ["use to", "use", "used to"]
    },
    { 
        q: "Everyone must <span class='bold-option'>turn on</span> / <span class='bold-option'>turn down</span> / <span class='bold-option'>turn off</span> their cell phones during the test.", 
        ans: "turn off", 
        hint: "'Turn off' means to switch something off.",
        options: ["turn on", "turn down", "turn off"]
    },
    { 
        q: "I received a great job offer, but I <span class='bold-option'>turned it off</span> / <span class='bold-option'>turned it down</span> / <span class='bold-option'>turned it up</span>.", 
        ans: "turned it down", 
        hint: "'Turn down' means to refuse or reject something.",
        options: ["turned it off", "turned it down", "turned it up"]
    },
    { 
        q: "<span class='bold-option'>Have you chopped</span> / <span class='bold-option'>Are you chopping</span> / <span class='bold-option'>Did you chop</span> the onions yet?", 
        ans: "Have you chopped", 
        hint: "Present perfect with 'yet' for unfinished actions.",
        options: ["Have you chopped", "Are you chopping", "Did you chop"]
    },
    { 
        q: "Jill <span class='bold-option'>have been doing</span> / <span class='bold-option'>has been doing</span> / <span class='bold-option'>is doing</span> judo for many years.", 
        ans: "has been doing", 
        hint: "Present perfect continuous for actions starting in past and continuing to present.",
        options: ["have been doing", "has been doing", "is doing"]
    },
    { 
        q: "They <span class='bold-option'>has never eaten</span> / <span class='bold-option'>have never eaten</span> / <span class='bold-option'>have never eaten</span> lasagna.", 
        ans: "have never eaten", 
        hint: "Present perfect with 'never' for experiences.",
        options: ["has never eaten", "have never eat", "have never eaten"]
    },
    { 
        q: "Craig and Diane <span class='bold-option'>go out</span> / <span class='bold-option'>went out</span> / <span class='bold-option'>have gone out</span> last night.", 
        ans: "went out", 
        hint: "Simple past with specific time 'last night'.",
        options: ["go out", "went out", "have gone out"]
    },
    { 
        q: "She <span class='bold-option'>has been living</span> / <span class='bold-option'>have been living</span> / <span class='bold-option'>has lived</span> in Paris since 2001.", 
        ans: "has been living", 
        hint: "Present perfect continuous with 'since' for ongoing situation.",
        options: ["has been living", "have been living", "has lived"]
    },
    { 
        q: "How should I <span class='bold-option'>go on</span> / <span class='bold-option'>go out</span> / <span class='bold-option'>go about</span> telling him the bad news?", 
        ans: "go about", 
        hint: "'Go about' means to approach or deal with something.",
        options: ["go on", "go out", "go about"]
    },
    { 
        q: "Mom <span class='bold-option'>has been cleaning</span> / <span class='bold-option'>cleaned</span> / <span class='bold-option'>has cleaned</span> the house all day.", 
        ans: "has been cleaning", 
        hint: "Present perfect continuous with 'all day' for ongoing action.",
        options: ["has been cleaning", "cleaned", "has cleaned"]
    }
];

const t12_people = [
    { 
        description: "Pauline and her friend Janet like to go out on Friday evening in town to relax after work and enjoy a meal together. Last week, they had Chinese food. They are both vegetarians, and they love trying new restaurants and different kinds of food.",
        answer: "G",
        hint: "They need a vegetarian-friendly restaurant in town with different cuisine than Chinese."
    },
    { 
        description: "Mr. and Mrs. Green are celebrating their 30th wedding anniversary, and they are looking for somewhere special for a romantic dinner for two. They like eating fresh fish and would like to listen to some music.",
        answer: "C",
        hint: "They need a romantic restaurant with fresh fish and music for a special anniversary."
    },
    { 
        description: "Jason will be 18 at the end of the month. His parents have said he can have a party. He wants to invite 10 friends and go somewhere where they can have something to eat and dance.",
        answer: "B",
        hint: "He needs a place for a group of teenagers with food and dancing facilities."
    },
    { 
        description: "Andrew would like to take his family out this weekend. He and his wife have two children aged 7 and 9 and his elderly mother also lives with them. He would like to go somewhere with a parking lot, where the food is English and reasonably priced.",
        answer: "E",
        hint: "He needs a family-friendly restaurant with English food, parking, and reasonable prices."
    },
    { 
        description: "Michelle and Lauren are students and have just moved into a new apartment. After a tiring day, they are hungry. Because everything is still in boxes, they want to eat out or order takeout, but they do not want to spend a lot of money.",
        answer: "A",
        hint: "They need affordable takeout or casual dining options suitable for students."
    }
];

const t12_restaurants = [
    { 
        letter: "A", 
        name: "The Place",
        review: "I think this is a great name for a burger restaurant! They offer the best burgers in town. This restaurant is a good deal. My children love it and we usually stop in on the way home and bring something back with us, especially if I have had a hard day at work. Sometimes, we eat there."
    },
    { 
        letter: "B", 
        name: "Riverside Restaurant",
        review: "The best thing about this out-of-town restaurant is its romantic setting overlooking the river. There is a large dining area upstairs and a small disco downstairs. The food is OK and reasonably priced, and although they were extremely busy, everyone working there was very friendly and helpful."
    },
    { 
        letter: "C", 
        name: "The Riverboat",
        review: "If you are looking for something different, this old ferry boat on the river is a good choice. It is 2 miles from the downtown area with a parking lot on the riverside and a very good piano player. The food is pricey but excellent, especially the fish which was delicious. The waiter said it was 'today's catch' and I believe him."
    },
    { 
        letter: "D", 
        name: "A Taste of Thailand",
        review: "The surroundings here are so beautiful and I love the way that Thai people prepare their food with flower shaped carrots and tomatoes decorating the plates. The waitress was charming and very helpful. Some dishes are spicy and they prepare an excellent meal for four so you can try different dishes (not suitable for vegetarians)."
    },
    { 
        letter: "E", 
        name: "Cliff's Carvery",
        review: "This new restaurant opened last month on North Street and has a small parking lot in the back. This is a restaurant for meat lovers. It's buffet style so you can fill your plate with as much as you like. There is a choice of roast meat, a selection of hot, fresh vegetables, a salad bar for the main course, and a delicious variety of desserts."
    },
    { 
        letter: "F", 
        name: "China Doll",
        review: "This is my favorite Chinese restaurant with lovely fish and meat dishes, and lots of vegetable dishes to choose from. They do offer a takeout service, but it is a little bit expensive. It is a short walk from the station so you can leave the car behind. Take the family and practice eating with chopsticks (but they do give you a knife and fork too!)"
    },
    { 
        letter: "G", 
        name: "Mario's Restaurant",
        review: "Last week, we went to this little family run restaurant to celebrate our son's graduation. He is a vegetarian, but my husband likes to eat meat and the menu was suitable for both of them. They had some live music which was entertaining, but it was a pity that the service was so slow."
    },
    { 
        letter: "H", 
        name: "The Daisy Chain",
        review: "This restaurant is part of a chain of restaurants offering good traditional English food at a good price. There is a children's play area which was popular with the kids, but we found it difficult to find a place to park the car."
    }
];

let answerStates = new Map();
let wordUsageCount = {};
let optionSelections = new Map();
let hintVisible = {};
let selectedTextRange = null;
let contextMenu = null;

function renderTask1() {
    const container = document.getElementById('questions-t1');
    container.innerHTML = '';
    
    t1_data.forEach((item, i) => {
        const qid = `t1-q${i}`;
        container.innerHTML += `
            <tr>
                <td><strong>${i+1}.</strong> ${item.list}</td>
                <td>
                    <input type="text" class="word-input" id="${qid}-reason" data-type="input" data-ans="${item.reason}" oninput="adjustWidth(this)">
                    <div class="row-btns">
                        <button class="btn-small" id="${qid}-reason-eye" onclick="toggleSingleAns('${qid}-reason')">👁️</button>
                        <button class="info-btn" id="${qid}-reason-info" onclick="toggleHint('${qid}-reason')">i</button>
                    </div>
                    <div class="hint-box" id="${qid}-reason-hint">💡 ${item.hint}</div>
                </td>
                <td>
                    <input type="text" class="word-input" id="${qid}-newword" data-type="input" data-ans="${item.newWord}" oninput="adjustWidth(this)">
                    <div class="row-btns">
                        <button class="btn-small" id="${qid}-newword-eye" onclick="toggleSingleAns('${qid}-newword')">👁️</button>
                    </div>
                </td>
            </tr>`;
    });
}

function renderTask2() {
    const bankContainer = document.getElementById('bank-t2');
    const webContainer = document.getElementById('web-t2');
    
    bankContainer.innerHTML = '';
    wordUsageCount['t2'] = {};
    
    t2_wordBank.forEach((word, i) => {
        const wordId = `t2-word-${i}`;
        bankContainer.innerHTML += `
            <div class="word-item" id="${wordId}" data-word="${word.toLowerCase()}" draggable="true" ondragstart="dragWord(event)" onclick="selectWordFromBank('${wordId}')">
                ${word.toLowerCase()}
            </div>`;
        wordUsageCount['t2'][word.toLowerCase()] = 0;
    });
    
    webContainer.innerHTML = '';
    
    t2_categories.forEach((category, catIndex) => {
        let categoryHtml = `
            <div class="web-category">
                <h3><strong>${catIndex+1}.</strong> ${category.title}</h3>
                <div class="web-words">`;
        
        category.correct.forEach((word, wordIndex) => {
            const qid = `t2-c${catIndex}-w${wordIndex}`;
            categoryHtml += `
                <div>
                    <input type="text" class="web-word-input word-input" id="${qid}" data-type="input" data-ans="${word}" oninput="adjustWidth(this); updateWordBank('t2')" ondrop="dropWord(event, '${qid}')" ondragover="allowDrop(event)" onclick="this.select()">
                    <div class="row-btns" style="display: inline-block; margin-left: 5px;">
                        <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')">👁️</button>
                        ${wordIndex === 0 ? `<button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')">i</button>` : ''}
                    </div>
                    ${wordIndex === 0 ? `<div class="hint-box" id="${qid}-hint">💡 ${category.hint}</div>` : ''}
                </div>`;
        });
        
        categoryHtml += `</div></div>`;
        webContainer.innerHTML += categoryHtml;
    });
    
    addWordBankEventListeners('t2');
}

function renderTask3() {
    const container = document.getElementById('questions-t3');
    container.innerHTML = '';
    
    t3_data.forEach((item, i) => {
        const qid = `t3-q${i}`;
        
        let optionsHtml = '';
        item.options.forEach((option, optIndex) => {
            optionsHtml += `<button class="option-btn" onclick="selectOption('${qid}', '${option}')" id="${qid}-opt${optIndex}">${option}</button>`;
        });
        
        container.innerHTML += `
            <div class="question-row">
                <strong>${i+1}.</strong> <span class="sentence-text">
                    ${item.q}
                    <div class="option-container">
                        ${optionsHtml}
                    </div>
                </span>
                <div class="row-btns">
                    <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')">👁️</button>
                    <button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')">i</button>
                </div>
                <div class="hint-box" id="${qid}-hint">💡 ${item.hint}</div>
            </div>`;
    });
}

function renderTask4() {
    const bankContainer = document.getElementById('bank-t4');
    const questionContainer = document.getElementById('questions-t4');
    
    bankContainer.innerHTML = '';
    wordUsageCount['t4'] = {};
    
    t4_wordBank.forEach((word, i) => {
        const wordId = `t4-word-${i}`;
        bankContainer.innerHTML += `
            <div class="word-item" id="${wordId}" data-word="${word.toLowerCase()}" draggable="true" ondragstart="dragWord(event)" onclick="selectWordFromBank('${wordId}')">
                ${word.toLowerCase()}
            </div>`;
        wordUsageCount['t4'][word.toLowerCase()] = 0;
    });
    
    questionContainer.innerHTML = '';
    
    t4_data.forEach((item, i) => {
        const qid = `t4-q${i}`;
        questionContainer.innerHTML += `
            <div class="question-row">
                <strong>${i+1}.</strong> 
                <input type="text" class="word-input" id="${qid}" data-type="input" data-ans="${item.ans}" oninput="adjustWidth(this); updateWordBank('t4')" ondrop="dropWord(event, '${qid}')" ondragover="allowDrop(event)" onclick="this.select()">
                ${item.q.split('______')[1]}
                <div class="row-btns">
                    <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')">👁️</button>
                    <button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')">i</button>
                </div>
                <div class="hint-box" id="${qid}-hint">💡 ${item.hint}</div>
            </div>`;
    });
    
    addWordBankEventListeners('t4');
}

function renderTask5() {
    const container = document.getElementById('questions-t5');
    container.innerHTML = '';
    
    t5_data.forEach((item, i) => {
        const qid = `t5-q${i}`;
        container.innerHTML += `
            <div class="question-row">
                <strong>${i+1}.</strong> ${item.q}
                <input type="text" class="word-input" id="${qid}" data-type="input" data-ans="${item.ans}" oninput="adjustWidth(this)">
                <div class="row-btns">
                    <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')">👁️</button>
                    <button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')">i</button>
                </div>
                <div class="hint-box" id="${qid}-hint">💡 ${item.hint}</div>
            </div>`;
    });
}

function renderTask6() {
    const container = document.getElementById('questions-t6');
    container.innerHTML = '';
    
    t6_data.forEach((item, i) => {
        const qid = `t6-q${i}`;
        
        let optionsHtml = '';
        item.options.forEach((option, optIndex) => {
            optionsHtml += `<button class="option-btn" onclick="selectOption('${qid}', '${option}')" id="${qid}-opt${optIndex}">${option}</button>`;
        });
        
        container.innerHTML += `
            <div class="question-row">
                <strong>${i+1}.</strong> <span class="sentence-text">
                    ${item.q}
                    <div class="option-container">
                        ${optionsHtml}
                    </div>
                </span>
                <div class="row-btns">
                    <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')">👁️</button>
                    <button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')">i</button>
                </div>
                <div class="hint-box" id="${qid}-hint">💡 ${item.hint}</div>
            </div>`;
    });
}

function renderTask7() {
    const bankContainer = document.getElementById('bank-t7');
    const questionContainer = document.getElementById('questions-t7');
    
    bankContainer.innerHTML = '';
    wordUsageCount['t7'] = {};
    
    t7_wordBank.forEach((word, i) => {
        const wordId = `t7-word-${i}`;
        bankContainer.innerHTML += `
            <div class="word-item" id="${wordId}" data-word="${word.toLowerCase()}" draggable="true" ondragstart="dragWord(event)" onclick="selectWordFromBank('${wordId}')">
                ${word.toLowerCase()}
            </div>`;
        wordUsageCount['t7'][word.toLowerCase()] = 0;
    });
    
    questionContainer.innerHTML = '';
    
    t7_data.forEach((item, i) => {
        const qid = `t7-q${i}`;
        let sentence = item.q;
        
        if (Array.isArray(item.ans)) {
            const gaps = item.ans.length;
            for (let j = 0; j < gaps; j++) {
                const gapId = `${qid}-gap${j}`;
                sentence = sentence.replace('______', `<input type="text" class="word-input" id="${gapId}" data-type="input" data-ans="${item.ans[j]}" oninput="adjustWidth(this); updateWordBank('t7')" ondrop="dropWord(event, '${gapId}')" ondragover="allowDrop(event)" onclick="this.select()">`);
            }
        } else {
            sentence = sentence.replace('______', `<input type="text" class="word-input" id="${qid}" data-type="input" data-ans="${item.ans}" oninput="adjustWidth(this); updateWordBank('t7')" ondrop="dropWord(event, '${qid}')" ondragover="allowDrop(event)" onclick="this.select()">`);
        }
        
        questionContainer.innerHTML += `
            <div class="question-row">
                <strong>${i+1}.</strong> ${sentence}
                <div class="row-btns">
                    <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')">👁️</button>
                    <button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')">i</button>
                </div>
                <div class="hint-box" id="${qid}-hint">💡 ${item.hint}</div>
            </div>`;
    });
    
    addWordBankEventListeners('t7');
}

function renderTask8() {
    const container = document.getElementById('questions-t8');
    container.innerHTML = '';
    
    t8_data.forEach((item, i) => {
        const qid = `t8-q${i}`;
        container.innerHTML += `
            <div class="question-row">
                <strong>${i+1}.</strong> ${item.q.split('______')[0]}
                <input type="text" class="word-input" id="${qid}" data-type="input" data-ans="${item.ans}" oninput="adjustWidth(this)">
                ${item.q.split('______')[1]}
                <div class="row-btns">
                    <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')">👁️</button>
                    <button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')">i</button>
                </div>
                <div class="hint-box" id="${qid}-hint">💡 ${item.hint}</div>
            </div>`;
    });
}

function renderTask9() {
    const container = document.getElementById('questions-t9');
    container.innerHTML = '';
    
    t9_data.forEach((item, i) => {
        const qid = `t9-q${i}`;
        
        let optionsHtml = '';
        item.options.forEach((option, optIndex) => {
            optionsHtml += `<button class="option-btn" onclick="selectOption('${qid}', '${option}')" id="${qid}-opt${optIndex}">${option}</button>`;
        });
        
        container.innerHTML += `
            <div class="question-row">
                <strong>${i+1}.</strong> <span class="sentence-text">
                    ${item.q}
                    <div class="option-container">
                        ${optionsHtml}
                    </div>
                </span>
                <div class="row-btns">
                    <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')">👁️</button>
                    <button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')">i</button>
                </div>
                <div class="hint-box" id="${qid}-hint">💡 ${item.hint}</div>
            </div>`;
    });
}

function renderTask10() {
    const container = document.getElementById('questions-t10');
    container.innerHTML = '';
    
    t10_data.forEach((item, i) => {
        const qid = `t10-q${i}`;
        container.innerHTML += `
            <div class="question-row">
                <strong>${i+1}.</strong> ${item.q.split('______')[0]}
                <input type="text" class="word-input" id="${qid}" data-type="input" data-ans="${item.ans}" oninput="adjustWidth(this)">
                ${item.q.split('______')[1]}
                <div class="row-btns">
                    <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')">👁️</button>
                    <button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')">i</button>
                </div>
                <div class="hint-box" id="${qid}-hint">💡 ${item.hint}</div>
            </div>`;
    });
}

function renderTask11() {
    const container = document.getElementById('questions-t11');
    container.innerHTML = '';
    
    t11_data.forEach((item, i) => {
        const qid = `t11-q${i}`;
        
        let optionsHtml = '';
        item.options.forEach((option, optIndex) => {
            optionsHtml += `<button class="option-btn" onclick="selectOption('${qid}', '${option}')" id="${qid}-opt${optIndex}">${option}</button>`;
        });
        
        container.innerHTML += `
            <div class="question-row">
                <strong>${i+1}.</strong> <span class="sentence-text">
                    ${item.q}
                    <div class="option-container">
                        ${optionsHtml}
                    </div>
                </span>
                <div class="row-btns">
                    <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')">👁️</button>
                    <button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')">i</button>
                </div>
                <div class="hint-box" id="${qid}-hint">💡 ${item.hint}</div>
            </div>`;
    });
}

function renderTask12() {
    const peopleContainer = document.getElementById('people-t12');
    const restaurantsContainer = document.getElementById('restaurants-t12');
    
    peopleContainer.innerHTML = '';
    t12_people.forEach((person, i) => {
        const qid = `t12-q${i}`;
        peopleContainer.innerHTML += `
            <div class="person-item">
                <span class="person-number">${i+1}</span>
                <span class="person-desc">${person.description}</span>
                <br>
                <strong>Restaurant:</strong> 
                <input type="text" class="matching-input letter-input" id="${qid}" data-type="input" data-ans="${person.answer}" maxlength="1" oninput="adjustWidth(this)" style="text-transform: uppercase;">
                <div class="row-btns">
                    <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')">👁️</button>
                    <button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')">i</button>
                </div>
                <div class="hint-box" id="${qid}-hint">💡 ${person.hint}</div>
            </div>`;
    });
    
    restaurantsContainer.innerHTML = '';
    t12_restaurants.forEach((restaurant, i) => {
        restaurantsContainer.innerHTML += `
            <div class="restaurant-item">
                <span class="restaurant-letter">${restaurant.letter}</span>
                <strong>${restaurant.name}</strong><br>
                <span class="restaurant-review">${restaurant.review}</span>
            </div>`;
    });
}

function adjustWidth(el) { 
    let baseWidth;
    if (el.classList.contains('letter-input')) {
        baseWidth = 45;
    } else if (el.classList.contains('word-input')) {
        baseWidth = 120;
    } else {
        baseWidth = 60;
    }
    
    const charWidth = el.classList.contains('word-input') ? 9 : 10;
    const newWidth = Math.max(el.value.length * charWidth + 20, baseWidth);
    
    let maxWidth;
    if (el.classList.contains('letter-input')) {
        maxWidth = 80;
    } else if (el.classList.contains('word-input')) {
        maxWidth = 400;
    } else {
        maxWidth = 300;
    }
    
    el.style.width = Math.min(newWidth, maxWidth) + "px";
}

function toggleHint(id) { 
    const h = document.getElementById(id + '-hint'); 
    const infoBtn = document.getElementById(id + '-info');
    
    if (h) {
        if (h.style.display === 'block') {
            h.style.display = 'none';
            if (infoBtn) infoBtn.classList.remove('active');
        } else {
            h.style.display = 'block';
            if (infoBtn) infoBtn.classList.add('active');
        }
    }
}

function toggleSingleAns(id) { 
    const qid = id.replace('-eye', '');
    const questionIndex = parseInt(qid.split('-q')[1]);
    const exerciseId = qid.split('-q')[0];
    let data;
    
    if (exerciseId === 't3') data = t3_data;
    else if (exerciseId === 't6') data = t6_data;
    else if (exerciseId === 't9') data = t9_data;
    else if (exerciseId === 't11') data = t11_data;
    else {
        const el = document.getElementById(qid);
        if (!el) return;
        
        const ans = el.dataset.ans;
        const eyeBtn = document.getElementById(id);
        const stateKey = `${qid}-state`;
        const isCurrentlyShown = answerStates.get(stateKey) || false;
        
        if (isCurrentlyShown) {
            el.value = "";
            el.classList.remove('correct', 'incorrect-marked');
            adjustWidth(el);
            if (eyeBtn) eyeBtn.classList.remove('active');
            answerStates.set(stateKey, false);
        } else {
            if (ans) {
                el.value = ans;
                el.classList.add('correct');
                el.classList.remove('incorrect-marked');
                adjustWidth(el);
                if (eyeBtn) eyeBtn.classList.add('active');
                answerStates.set(stateKey, true);
            }
        }
        return;
    }
    
    const questionData = data[questionIndex];
    const correctAnswer = questionData.ans;
    
    const optionButtons = [];
    for (let i = 0; i < questionData.options.length; i++) {
        const btn = document.getElementById(`${qid}-opt${i}`);
        if (btn) optionButtons.push(btn);
    }
    
    const stateKey = `${qid}-state`;
    const isCurrentlyShown = answerStates.get(stateKey) || false;
    
    if (isCurrentlyShown) {
        optionButtons.forEach(btn => {
            btn.classList.remove('correct-option', 'incorrect-option');
            const userSelection = optionSelections.get(qid);
            if (userSelection && btn.textContent === userSelection) {
                btn.classList.add('selected');
            }
        });
        
        const eyeBtn = document.getElementById(id);
        if (eyeBtn) eyeBtn.classList.remove('active');
        answerStates.set(stateKey, false);
    } else {
        optionButtons.forEach(btn => {
            btn.classList.remove('selected', 'correct-option', 'incorrect-option');
            if (correctAnswer.includes(',')) {
                const correctAnswers = correctAnswer.split(',').map(a => a.trim());
                if (correctAnswers.some(ans => btn.textContent.includes(ans))) {
                    btn.classList.add('correct-option');
                }
            } else if (btn.textContent === correctAnswer) {
                btn.classList.add('correct-option');
            }
        });
        
        const eyeBtn = document.getElementById(id);
        if (eyeBtn) eyeBtn.classList.add('active');
        answerStates.set(stateKey, true);
    }
}

function selectOption(qid, option) {
    const questionIndex = parseInt(qid.split('-q')[1]);
    const exerciseId = qid.split('-q')[0];
    let data;
    
    if (exerciseId === 't3') data = t3_data;
    else if (exerciseId === 't6') data = t6_data;
    else if (exerciseId === 't9') data = t9_data;
    else data = t11_data;
    
    const questionData = data[questionIndex];
    
    const optionButtons = [];
    for (let i = 0; i < questionData.options.length; i++) {
        const btn = document.getElementById(`${qid}-opt${i}`);
        if (btn) optionButtons.push(btn);
    }
    
    optionButtons.forEach(btn => {
        btn.classList.remove('selected');
    });
    
    const selectedBtn = optionButtons.find(btn => btn.textContent === option);
    if (selectedBtn) {
        selectedBtn.classList.add('selected');
    }
    
    optionSelections.set(qid, option);
}

function showAnswers(prefix) { 
    if (prefix === 't3' || prefix === 't6' || prefix === 't9' || prefix === 't11') {
        let data;
        if (prefix === 't3') data = t3_data;
        else if (prefix === 't6') data = t6_data;
        else if (prefix === 't9') data = t9_data;
        else data = t11_data;
        
        data.forEach((item, i) => {
            const qid = `${prefix}-q${i}`;
            const correctAnswer = item.ans;
            
            const optionButtons = [];
            for (let j = 0; j < item.options.length; j++) {
                const btn = document.getElementById(`${qid}-opt${j}`);
                if (btn) optionButtons.push(btn);
            }
            
            optionButtons.forEach(btn => {
                btn.classList.remove('selected', 'correct-option', 'incorrect-option');
                if (correctAnswer.includes(',')) {
                    const correctAnswers = correctAnswer.split(',').map(a => a.trim());
                    if (correctAnswers.some(ans => btn.textContent.includes(ans))) {
                        btn.classList.add('correct-option');
                    }
                } else if (btn.textContent === correctAnswer) {
                    btn.classList.add('correct-option');
                }
            });
            
            const eyeBtn = document.getElementById(`${qid}-eye`);
            if (eyeBtn) eyeBtn.classList.add('active');
            answerStates.set(`${qid}-state`, true);
        });
        return;
    }
    
    document.querySelectorAll(`[id^="${prefix}-"]`).forEach(el => {
        if (el.dataset && el.dataset.type === 'input') {
            const ans = el.dataset.ans;
            const eyeBtn = document.getElementById(el.id + '-eye');
            
            if (ans) {
                el.value = ans;
                el.classList.add('correct');
                el.classList.remove('incorrect-marked');
                adjustWidth(el);
                if (eyeBtn) eyeBtn.classList.add('active');
                
                answerStates.set(`${el.id}-state`, true);
            }
        }
    });
}

function resetSection(prefix) { 
    document.querySelectorAll(`[id^="${prefix}"]`).forEach(i => { 
        if(i.tagName === 'INPUT') { 
            i.value = ""; 
            i.classList.remove('correct', 'incorrect-marked'); 
            adjustWidth(i); 
            
            answerStates.delete(`${i.id}-state`);
        } 
        
        const hBox = document.getElementById(i.id + '-hint'); 
        if(hBox) hBox.style.display = 'none'; 
    });
    
    document.querySelectorAll(`[id$="-eye"], [id$="-info"]`).forEach(btn => {
        if (btn.id.includes(prefix)) {
            btn.classList.remove('active');
        }
    });
    
    if (prefix === 't3' || prefix === 't6' || prefix === 't9' || prefix === 't11') {
        const allOptionBtns = document.querySelectorAll(`#questions-${prefix} .option-btn`);
        
        allOptionBtns.forEach(btn => {
            btn.classList.remove('selected', 'correct-option', 'incorrect-option');
            btn.style.cssText = '';
            btn.style.background = '';
            btn.style.backgroundColor = '';
            btn.style.color = '';
            btn.style.borderColor = '';
            btn.style.border = '';
        });
        
        for (const [key, value] of optionSelections.entries()) {
            if (key.startsWith(`${prefix}-`)) {
                optionSelections.delete(key);
            }
        }
        
        document.querySelectorAll(`#questions-${prefix} .btn-small[id$="-eye"]`).forEach(eyeBtn => {
            eyeBtn.classList.remove('active');
        });
        
        for (const [key, value] of answerStates.entries()) {
            if (key.includes(`${prefix}-q`)) {
                answerStates.delete(key);
            }
        }
    }
    
    if (prefix === 't2' || prefix === 't4' || prefix === 't7') {
        const wordItems = document.querySelectorAll(`#bank-${prefix} .word-item`);
        wordItems.forEach(item => {
            item.classList.remove('used');
        });
        
        if (wordUsageCount[prefix]) {
            Object.keys(wordUsageCount[prefix]).forEach(word => {
                wordUsageCount[prefix][word] = 0;
            });
        }
    }
    
    Object.keys(hintVisible).forEach(key => {
        if (key.startsWith(prefix)) {
            hintVisible[key] = false;
            const hint = document.getElementById(`hint-${key}`);
            if (hint) hint.style.display = 'none';
        }
    });
}

function normalizeAnswer(answer) {
    return answer.toLowerCase()
        .trim()
        .replace(/\s+/g, ' ')
        .replace(/[.,;:!?]$/, '');
}

function validateMultipleAnswers(userAnswer, correctAnswers) {
    const answers = correctAnswers.split('|').map(ans => normalizeAnswer(ans));
    const normalizedUser = normalizeAnswer(userAnswer);
    
    return answers.some(ans => ans === normalizedUser);
}

function checkAll() { 
    document.querySelectorAll('[data-type="input"]').forEach(el => { 
        const correctAnswers = el.dataset.ans;
        const userAnswer = el.value;
        
        el.classList.remove('correct', 'incorrect-marked'); 
        
        if(!userAnswer.trim()) {
            return;
        }
        
        if(validateMultipleAnswers(userAnswer, correctAnswers)) {
            el.classList.add('correct');
        } else {
            el.classList.add('incorrect-marked');
        }
    });
    
    ['t3', 't6', 't9', 't11'].forEach(taskId => {
        let data;
        if (taskId === 't3') data = t3_data;
        else if (taskId === 't6') data = t6_data;
        else if (taskId === 't9') data = t9_data;
        else data = t11_data;
        
        data.forEach((item, i) => {
            const qid = `${taskId}-q${i}`;
            const selectedOption = optionSelections.get(qid);
            const correctAnswer = item.ans;
            
            if (!selectedOption) {
                return;
            }
            
            const optionButtons = [];
            for (let j = 0; j < item.options.length; j++) {
                const btn = document.getElementById(`${qid}-opt${j}`);
                if (btn) optionButtons.push(btn);
            }
            
            optionButtons.forEach(btn => {
                btn.classList.remove('correct-option', 'incorrect-option');
            });
            
            const userSelectedBtn = optionButtons.find(btn => btn.textContent === selectedOption);
            if (userSelectedBtn) {
                if (correctAnswer.includes(',')) {
                    const correctAnswers = correctAnswer.split(',').map(a => a.trim());
                    if (correctAnswers.some(ans => selectedOption.includes(ans))) {
                        userSelectedBtn.classList.add('correct-option');
                    } else {
                        userSelectedBtn.classList.add('incorrect-option');
                    }
                } else if (selectedOption === correctAnswer) {
                    userSelectedBtn.classList.add('correct-option');
                } else {
                    userSelectedBtn.classList.add('incorrect-option');
                }
            }
        });
    });
}

function addWordBankEventListeners(id) {
    const wordItems = document.querySelectorAll(`#bank-${id} .word-item`);
    const inputs = document.querySelectorAll(`#questions-${id} input.word-input`);
    
    wordItems.forEach(item => {
        item.addEventListener('click', function() {
            selectWordFromBank(this.id);
        });
        
        item.addEventListener('dragstart', function(e) {
            dragWord(e);
        });
    });
    
    inputs.forEach(input => {
        input.addEventListener('dragover', function(e) {
            allowDrop(e);
        });
        
        input.addEventListener('drop', function(e) {
            dropWord(e, this.id);
        });
    });
}

function dragWord(event) {
    event.dataTransfer.setData("text/plain", event.target.dataset.word);
    event.dataTransfer.setData("wordId", event.target.id);
}

function allowDrop(event) {
    event.preventDefault();
}

function dropWord(event, inputId) {
    event.preventDefault();
    const word = event.dataTransfer.getData("text/plain");
    const wordId = event.dataTransfer.getData("wordId");
    
    const input = document.getElementById(inputId);
    if (input) {
        input.value = word;
        adjustWidth(input);
        
        const taskId = wordId.split('-')[1];
        updateWordBankUsage(word, `t${taskId}`);
    }
}

function selectWordFromBank(wordId) {
    const wordItem = document.getElementById(wordId);
    if (!wordItem || wordItem.classList.contains('used')) return;
    
    const word = wordItem.dataset.word;
    const taskId = wordId.split('-')[1];
    
    const inputs = document.querySelectorAll(`#questions-t${taskId} input.word-input`);
    let emptyInput = null;
    
    for (const input of inputs) {
        if (!input.value.trim()) {
            emptyInput = input;
            break;
        }
    }
    
    if (emptyInput) {
        emptyInput.value = word;
        adjustWidth(emptyInput);
        
        updateWordBankUsage(word, `t${taskId}`);
    } else {
        alert('All gaps are filled. You can click on a gap to replace its content.');
    }
}

function updateWordBankUsage(word, taskId) {
    if (!wordUsageCount[taskId]) {
        wordUsageCount[taskId] = {};
    }
    
    if (!wordUsageCount[taskId][word]) {
        wordUsageCount[taskId][word] = 0;
    }
    
    const inputs = document.querySelectorAll(`#questions-${taskId} input.word-input`);
    let count = 0;
    
    inputs.forEach(input => {
        if (normalizeAnswer(input.value) === normalizeAnswer(word)) {
            count++;
        }
    });
    
    wordUsageCount[taskId][word] = count;
    
    updateWordBankDisplay(taskId);
}

function updateWordBankDisplay(taskId) {
    const wordItems = document.querySelectorAll(`#bank-${taskId} .word-item`);
    
    wordItems.forEach(item => {
        const word = item.dataset.word;
        const count = wordUsageCount[taskId][word] || 0;
        
        if (count > 0) {
            item.classList.add('used');
        } else {
            item.classList.remove('used');
        }
    });
}

function updateWordBank(taskId) {
    const inputs = document.querySelectorAll(`#questions-${taskId} input.word-input`);
    
    if (wordUsageCount[taskId]) {
        Object.keys(wordUsageCount[taskId]).forEach(word => {
            wordUsageCount[taskId][word] = 0;
        });
    }
    
    inputs.forEach(input => {
        const word = input.value.trim().toLowerCase();
        if (word) {
            if (wordUsageCount[taskId][word] !== undefined) {
                wordUsageCount[taskId][word]++;
            }
        }
    });
    
    updateWordBankDisplay(taskId);
}

function initializeResizer() {
    const resizer = document.getElementById('resizer-t12');
    const leftPanel = document.getElementById('people-panel-t12');
    const rightPanel = document.getElementById('restaurants-panel-t12');
    
    if (!resizer || !leftPanel || !rightPanel) return;
    
    const savedLeftWidth = localStorage.getItem('dualScreenLeftWidth');
    if (savedLeftWidth) {
        leftPanel.style.width = savedLeftWidth + 'px';
        rightPanel.style.flex = '1';
    }
    
    let isResizing = false;
    let startX = 0;
    let startLeftWidth = 0;
    
    resizer.addEventListener('mousedown', function(e) {
        isResizing = true;
        startX = e.clientX;
        startLeftWidth = leftPanel.offsetWidth;
        
        document.body.style.cursor = 'col-resize';
        document.body.style.userSelect = 'none';
        
        document.addEventListener('mousemove', handleMouseMove);
        document.addEventListener('mouseup', handleMouseUp);
    });
    
    function handleMouseMove(e) {
        if (!isResizing) return;
        
        const dx = e.clientX - startX;
        const newLeftWidth = startLeftWidth + dx;
        
        const minWidth = 200;
        const containerWidth = leftPanel.parentElement.offsetWidth;
        const maxWidth = containerWidth - minWidth - resizer.offsetWidth;
        
        if (newLeftWidth >= minWidth && newLeftWidth <= maxWidth) {
            leftPanel.style.width = newLeftWidth + 'px';
            rightPanel.style.flex = '1';
        }
    }
    
    function handleMouseUp() {
        isResizing = false;
        document.body.style.cursor = '';
        document.body.style.userSelect = '';
        
        const finalWidth = leftPanel.offsetWidth;
        localStorage.setItem('dualScreenLeftWidth', finalWidth);
        
        document.removeEventListener('mousemove', handleMouseMove);
        document.removeEventListener('mouseup', handleMouseUp);
    }
}

function initializeTextHighlighting() {
    contextMenu = document.getElementById('context-menu');
    const highlightBtn = document.getElementById('highlight-text');
    const removeHighlightBtn = document.getElementById('remove-highlight');
    const clearHighlightsBtn = document.getElementById('clear-highlights');
    
    document.addEventListener('contextmenu', function(e) {
        const selection = window.getSelection();
        if (selection.toString().trim()) {
            selectedTextRange = saveSelection();
            
            contextMenu.style.display = 'block';
            contextMenu.style.left = e.pageX + 'px';
            contextMenu.style.top = e.pageY + 'px';
            
            e.preventDefault();
        } else {
            contextMenu.style.display = 'none';
        }
    });
    
    document.addEventListener('click', function(e) {
        if (contextMenu && !contextMenu.contains(e.target)) {
            contextMenu.style.display = 'none';
        }
    });
    
    if (highlightBtn) {
        highlightBtn.addEventListener('click', function() {
            if (selectedTextRange) {
                highlightSelection(selectedTextRange);
                contextMenu.style.display = 'none';
            }
        });
    }
    
    if (removeHighlightBtn) {
        removeHighlightBtn.addEventListener('click', function() {
            if (selectedTextRange) {
                removeHighlightFromSelection(selectedTextRange);
                contextMenu.style.display = 'none';
            }
        });
    }
    
    if (clearHighlightsBtn) {
        clearHighlightsBtn.addEventListener('click', function() {
            clearAllHighlights();
            contextMenu.style.display = 'none';
        });
    }
}

function saveSelection() {
    const selection = window.getSelection();
    if (selection.rangeCount === 0) return null;
    
    return selection.getRangeAt(0).cloneRange();
}

function highlightSelection(range) {
    if (!range) return;
    
    const span = document.createElement('span');
    span.className = 'highlighted-text';
    
    try {
        range.surroundContents(span);
    } catch(e) {
        const div = document.createElement('div');
        div.innerHTML = range.toString();
        span.innerHTML = div.innerHTML;
        range.deleteContents();
        range.insertNode(span);
    }
    
    const selection = window.getSelection();
    selection.removeAllRanges();
}

function removeHighlightFromSelection(range) {
    if (!range) return;
    
    const parent = range.commonAncestorContainer;
    const highlightSpans = parent.parentElement.querySelectorAll('.highlighted-text');
    
    highlightSpans.forEach(span => {
        if (range.intersectsNode(span)) {
            const parent = span.parentNode;
            while (span.firstChild) {
                parent.insertBefore(span.firstChild, span);
            }
            parent.removeChild(span);
        }
    });
    
    const selection = window.getSelection();
    selection.removeAllRanges();
}

function clearAllHighlights() {
    const highlights = document.querySelectorAll('.highlighted-text');
    highlights.forEach(highlight => {
        const parent = highlight.parentNode;
        while (highlight.firstChild) {
            parent.insertBefore(highlight.firstChild, highlight);
        }
        parent.removeChild(highlight);
    });
}

window.onload = () => {
    renderTask1();
    renderTask2();
    renderTask3();
    renderTask4();
    renderTask5();
    renderTask6();
    renderTask7();
    renderTask8();
    renderTask9();
    renderTask10();
    renderTask11();
    renderTask12();
    initializeResizer();
    initializeTextHighlighting();
};

document.addEventListener('keydown', e => { 
    if(e.key === 'Enter') {
        checkAll(); 
    }
});
</script>
</body>

</html>

