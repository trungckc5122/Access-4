<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Access 4 - Review Module 5</title>
    <style>
        :root {
            --primary: #2980b9; 
            --primary-dark: #1c5982; 
            --success: #27ae60;
            --error: #e74c3c; 
            --warning: #f1c40f; 
            --bg: #f4f7f9;
            --text: #2c3e50; 
            --card: #ffffff;
            --selection: #3498db;
            --selection-bg: #ebf5fb;
        }
        
        body { 
            font-family: 'Times New Roman', serif; 
            font-size: 13pt; 
            background-color: var(--bg); 
            color: var(--text); 
            margin: 0; 
            padding: 20px 20px 150px 20px;
            line-height: 1.6; 
        }
        
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
        }
        
        .sticky-bank { 
            position: sticky; 
            top: 15px; 
            z-index: 100;
            background-color: #fff; 
            padding: 15px; 
            border-radius: 10px; 
            margin-bottom: 25px; 
            border: 2px solid var(--primary); 
            display: flex; 
            flex-wrap: wrap; 
            gap: 10px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }
        
        .word-item { 
            background: #eef2f7; 
            border: 1px solid var(--primary); 
            color: var(--primary-dark); 
            padding: 6px 12px; 
            border-radius: 5px; 
            cursor: grab; 
            user-select: none; 
            transition: 0.2s; 
            font-size: 0.9em; 
            font-weight: 500;
        }
        
        .word-item.used { 
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        .word-item:hover:not(.used) { 
            background: var(--primary); 
            color: white; 
        }

        .exercise-card { 
            background: var(--card); 
            border-radius: 12px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); 
            padding: 25px; 
            margin-bottom: 30px; 
        }
        
        .exercise-title { 
            font-weight: bold; 
            font-size: 1.25em; 
            margin-bottom: 18px; 
            color: var(--primary-dark); 
            border-bottom: 2px solid #eee; 
            padding-bottom: 8px; 
        }
        
        .question-row { 
            margin-bottom: 18px; 
            line-height: 2.2; 
            border-bottom: 1px solid #f9f9f9; 
            padding-bottom: 10px; 
            position: relative; 
        }
        
        input[type="text"] { 
            border: none; 
            border-bottom: 2px solid #bdc3c7; 
            background: #fafafa; 
            padding: 2px 8px; 
            font-size: 1em; 
            transition: 0.2s; 
            outline: none;
            min-width: 60px; 
            border-radius: 4px 4px 0 0; 
            text-align: center; 
            font-family: 'Times New Roman';
            box-sizing: border-box;
        }
        
        input.letter-input { 
            width: 45px; 
            min-width: 45px; 
            max-width: 80px;
            text-transform: uppercase; 
            font-weight: bold; 
            color: var(--primary-dark); 
        }
        
        input.word-input { 
            min-width: 120px; 
            max-width: 800px;
            text-align: left; 
        }
        
        input.correct { 
            border-bottom-color: var(--success) !important; 
            background-color: #e8f8f5 !important; 
            color: #1e8449 !important; 
        }
        
        input.incorrect-marked { 
            border-bottom-color: var(--error) !important; 
            background-color: #fdedec !important; 
        }

        .row-btns { 
            display: inline-flex; 
            gap: 5px; 
            vertical-align: middle; 
            margin-left: 10px; 
        }
        
        .btn-small { 
            background: #eee; 
            border: 1px solid #ccc; 
            border-radius: 4px; 
            width: 28px; 
            height: 28px; 
            cursor: pointer; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 14px; 
            transition: 0.2s;
        }
        
        .btn-small:hover {
            background: #ddd;
        }
        
        .btn-small.active {
            background: #3498db;
            color: white;
            border-color: #2980b9;
        }
        
        .info-btn { 
            background: #95a5a6; 
            color: white; 
            border: none; 
            border-radius: 50%; 
            width: 20px; 
            height: 20px; 
            font-size: 11px; 
            cursor: pointer; 
            display: inline-flex; 
            align-items: center; 
            justify-content: center; 
            transition: 0.2s;
        }
        
        .info-btn:hover {
            background: #7f8c8d;
        }
        
        .info-btn.active {
            background: #5d6d6e;
        }
        
        .hint-box { 
            display: none; 
            margin-top: 8px; 
            padding: 10px; 
            background-color: #fef9e7; 
            border-left: 4px solid var(--warning); 
            color: #7d6608; 
            border-radius: 4px; 
            font-size: 0.85em; 
        }
        
        .controls-row { 
            display: flex; 
            justify-content: flex-end; 
            gap: 10px; 
            margin-top: 15px; 
        }
        
        .btn { 
            padding: 8px 20px; 
            border-radius: 6px; 
            cursor: pointer; 
            border: none; 
            font-weight: bold; 
            transition: 0.3s; 
        }
        
        .btn-reset { 
            background: #95a5a6; 
            color: white; 
        }
        
        .btn-show-all { 
            background: var(--primary); 
            color: white; 
        }
        
        .check-all-btn { 
            position: fixed; 
            right: 45px;
            bottom: 30px; 
            background-color: var(--success); 
            color: white; 
            padding: 15px 30px; 
            border-radius: 50px; 
            cursor: pointer; 
            z-index: 10000;
            font-weight: bold; 
            border: none; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.2); 
        }
        
        .instructions {
            color: #7f8c8d;
            font-size: 0.95em;
            margin-bottom: 15px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        
        .option-container {
            display: inline-flex;
            gap: 10px;
            margin-left: 10px;
            margin-right: 10px;
            flex-wrap: wrap;
        }
        
        .option-btn {
            background: #eef2f7;
            border: 2px solid #bdc3c7;
            border-radius: 6px;
            padding: 6px 15px;
            cursor: pointer;
            font-weight: 500;
            transition: 0.2s;
            min-width: 80px;
            text-align: center;
            font-size: 0.9em;
        }
        
        .option-btn:hover {
            background: #dfe6f0;
            border-color: #95a5a6;
        }
        
        .option-btn.selected {
            background: #3498db;
            color: white;
            border-color: #2980b9;
        }
        
        .option-btn.correct-option {
            background: #27ae60;
            color: white;
            border-color: #219653;
        }
        
        .option-btn.incorrect-option {
            background: #e74c3c;
            color: white;
            border-color: #c0392b;
        }
        
        .bold-option {
            font-weight: bold;
            color: var(--primary-dark);
        }
        
        .mcq-question {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .mcq-question p {
            margin-bottom: 12px;
            font-weight: 500;
            font-size: 1.05em;
        }
        
        .mcq-options-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .mcq-option {
            margin-bottom: 8px;
            padding: 8px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            background-color: #f9f9f9;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
        }
        
        .mcq-option:hover {
            background-color: #f0f0f0;
            border-color: #bdc3c7;
        }
        
        .mcq-option.selected {
            background-color: #e3f2fd;
            border-color: #3498db;
        }
        
        .mcq-option.correct {
            background-color: #d4edda;
            border-color: #27ae60;
            color: #155724;
        }
        
        .mcq-option.incorrect {
            background-color: #f8d7da;
            border-color: #e74c3c;
            color: #721c24;
        }
        
        .mcq-option input {
            margin-right: 10px;
        }
        
        .option-letter {
            display: inline-block;
            width: 24px;
            height: 24px;
            line-height: 24px;
            text-align: center;
            background-color: #3498db;
            color: white;
            border-radius: 50%;
            margin-right: 10px;
            font-weight: bold;
        }
        
        .paragraph-exercise {
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            margin: 20px 0;
            line-height: 1.8;
        }
        
        .paragraph-exercise p {
            margin: 0 0 15px 0;
        }
        
        .gap-input {
            border: none;
            border-bottom: 2px dashed #3498db;
            background-color: #f0f8ff;
            padding: 2px 6px;
            margin: 0 5px;
            min-width: 80px;
            text-align: center;
            font-family: 'Times New Roman', serif;
            font-size: 1em;
            border-radius: 0;
        }
        
        .gap-input.correct {
            border-bottom-color: #27ae60;
            background-color: #e8f8f5;
            color: #1e8449;
        }
        
        .gap-input.incorrect {
            border-bottom-color: #e74c3c;
            background-color: #fdedec;
            color: #c0392b;
        }
        
        @media (max-width: 768px) {
            .check-all-btn {
                right: 15px;
                bottom: 20px;
                padding: 12px 20px;
                font-size: 0.9em;
            }
            
            body {
                padding: 15px 15px 120px 15px;
            }
            
            .mcq-options-container {
                grid-template-columns: 1fr;
            }
        }
        
        .preposition-exercise {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            margin: 15px 0;
        }
        
        .preposition-row {
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .preposition-label {
            font-weight: bold;
            min-width: 150px;
        }
        
        .word-formation-input {
            border: none;
            border-bottom: 2px solid #3498db;
            background-color: #f0f8ff;
            padding: 2px 6px;
            min-width: 120px;
            text-align: left;
            font-family: 'Times New Roman', serif;
            font-size: 1em;
            border-radius: 4px 4px 0 0;
        }
        
        .word-formation-input.correct {
            border-bottom-color: #27ae60;
            background-color: #e8f8f5;
            color: #1e8449;
        }
        
        .word-formation-input.incorrect {
            border-bottom-color: #e74c3c;
            background-color: #fdedec;
            color: #c0392b;
        }
        
        .phrasal-verb-container {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #e9ecef;
            margin: 20px 0;
        }
        
        .phrasal-verb-bank {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
            padding: 15px;
            background-color: #eef2f7;
            border-radius: 8px;
            border: 1px solid #bdc3c7;
        }
        
        .phrasal-verb-item {
            background: #dfe6f0;
            border: 1px solid #95a5a6;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: 0.2s;
        }
        
        .phrasal-verb-item:hover {
            background: #3498db;
            color: white;
            border-color: #2980b9;
        }
        
        .phrasal-verb-item.used {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        /* Reading section with split screen */
        .reading-container {
            display: flex;
            margin: 20px 0;
            position: relative;
            min-height: 500px;
            height: 600px;
        }
        
        .text-panel, .questions-panel {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            border: 1px solid #e9ecef;
            overflow-y: auto;
            position: relative;
            height: 100%;
            flex: 1;
        }
        
        .text-panel {
            margin-right: 0;
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
        }
        
        .questions-panel {
            margin-left: 0;
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
        }
        
        .text-panel h3, .questions-panel h3 {
            margin-top: 0;
            color: var(--primary-dark);
            text-align: center;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        
        .reading-text {
            line-height: 1.8;
            text-align: justify;
            user-select: text;
        }
        
        .reading-gap {
            display: inline-block;
            width: 25px;
            text-align: center;
            font-weight: bold;
            color: var(--primary);
            border-bottom: 2px solid var(--primary);
            margin: 0 2px;
        }
        
        .resizer {
            position: relative;
            width: 10px;
            background-color: #ddd;
            cursor: col-resize;
            z-index: 10;
            flex-shrink: 0;
            margin: 0;
        }
        
        .resizer:hover {
            background-color: #3498db;
        }
        
        .resizer::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 2px;
            height: 40px;
            background-color: #95a5a6;
            border-radius: 1px;
        }
        
        .context-menu {
            position: absolute;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 10000;
            min-width: 150px;
            display: none;
        }
        
        .context-menu-item {
            padding: 8px 12px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background-color 0.2s;
        }
        
        .context-menu-item:hover {
            background-color: #f5f5f5;
        }
        
        .highlighted-text {
            background-color: rgba(255, 235, 59, 0.4) !important;
            padding: 0 2px;
            border-radius: 2px;
            color: inherit !important;
            display: inline;
        }
        
        html {
            overflow-x: hidden;
        }
        
        body {
            overflow-y: scroll;
            padding-right: 0 !important;
        }
        
        @media (max-width: 768px) {
            .reading-container {
                flex-direction: column;
                height: 800px;
            }
            
            .text-panel, .questions-panel {
                width: 100% !important;
                height: 50% !important;
                margin: 0;
                border-radius: 10px;
                margin-bottom: 10px;
            }
            
            .resizer {
                display: none;
            }
        }
    </style>
</head>
<body>

<div class="container">
    <h1 style="text-align: center; color: var(--primary-dark); margin-bottom: 30px;">Access 4 - Review Module 5</h1>
    
    <!-- Vocabulary Section -->
    <div class="exercise-card">
        <div class="exercise-title">Vocabulary: Types of animals</div>
        
        <div class="instructions">1. Read the descriptions. Then guess the animal and write the word in the blanks.</div>
        
        <div id="questions-t1"></div>
        <div class="controls-row">
            <button class="btn btn-show-all" onclick="showAnswers('t1')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('t1')">Reset</button>
        </div>
        
        <div class="instructions">2. Complete the sentences using the verbs below. Pay attention to the tenses.</div>
        
        <div class="sticky-bank" id="bank-t2"></div>
        
        <div id="questions-t2"></div>
        <div class="controls-row">
            <button class="btn btn-show-all" onclick="showAnswers('t2')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('t2')">Reset</button>
        </div>
        
        <div class="instructions">3. Complete the sentences using the verbs below. Pay attention to the tenses.</div>
        
        <div class="sticky-bank" id="bank-t3"></div>
        
        <div id="questions-t3"></div>
        <div class="controls-row">
            <button class="btn btn-show-all" onclick="showAnswers('t3')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('t3')">Reset</button>
        </div>
        
        <div class="instructions">4. Complete the sentences using the words below. Pay attention to the tenses.</div>
        
        <div class="sticky-bank" id="bank-t4"></div>
        
        <div id="questions-t4"></div>
        <div class="controls-row">
            <button class="btn btn-show-all" onclick="showAnswers('t4')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('t4')">Reset</button>
        </div>
    </div>
    
    <!-- Grammar Section -->
    <div class="exercise-card">
        <div class="exercise-title">Grammar: Past Perfect</div>
        
        <div class="instructions">5. Complete the sentences by putting the verbs in parentheses in the past perfect form.</div>
        <div id="questions-t5"></div>
        <div class="controls-row">
            <button class="btn btn-show-all" onclick="showAnswers('t5')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('t5')">Reset</button>
        </div>
        
        <div class="instructions">6. Join the sentences using the words in parentheses and the past perfect form.</div>
        <div id="questions-t6"></div>
        <div class="controls-row">
            <button class="btn btn-show-all" onclick="showAnswers('t6')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('t6')">Reset</button>
        </div>
        
        <div class="instructions">7. Complete the sentences using the correct verb and the past perfect progressive form.</div>
        
        <div class="sticky-bank" id="bank-t7"></div>
        
        <div id="questions-t7"></div>
        <div class="controls-row">
            <button class="btn btn-show-all" onclick="showAnswers('t7')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('t7')">Reset</button>
        </div>
        
        <div class="instructions">8. Underline the correct item to complete the sentences.</div>
        <div id="questions-t8"></div>
        <div class="controls-row">
            <button class="btn btn-show-all" onclick="showAnswers('t8')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('t8')">Reset</button>
        </div>
        
        <div class="instructions">9. Circle the correct item.</div>
        <div id="questions-t9"></div>
        <div class="controls-row">
            <button class="btn btn-show-all" onclick="showAnswers('t9')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('t9')">Reset</button>
        </div>
    </div>
    
    <!-- Reading Section -->
    <div class="exercise-card">
        <div class="exercise-title">Reading: World Animal Day</div>
        
        <div class="instructions">10. Read the text. For each question choose the correct answer (A, B, C, or D).</div>
        
        <div class="reading-container" id="reading-t10">
            <div class="text-panel" id="text-panel-t10">
                <h3>Reading Text</h3>
                <div class="reading-text" id="reading-text-t10">
                    <strong>World Animal Day</strong><br><br>
                    On October 4th, <span class="reading-gap">1</span> people all over the world show their love for animals by celebrating World Animal Day. The first World Animal Day was in 1931 and <span class="reading-gap">2</span> year since then, many organizations, animal groups, animal shelters, schools, and individuals celebrate the important role that animals <span class="reading-gap">3</span> in our lives.<br><br>
                    <span class="reading-gap">4</span> this day, animal groups, animal shelters, and other organizations plan special events to raise money for different animal-related issues, such as protecting endangered species. Wildlife organizations often set up displays to give people useful information about animals. Students may participate in projects or write stories related to animals, and many schools organize day trips to local zoos and animal shelters. If you don't belong to an animal organization or if your school doesn't do <span class="reading-gap">5</span> to celebrate World Animal Day, don't worry because there are many different things you can do alone to show your <span class="reading-gap">6</span> of animals.<br><br>
                    You can take a <span class="reading-gap">7</span> to your local zoo, park, or wildlife center and learn about your favorite animals, or you can donate some money to an animal shelter. <span class="reading-gap">8</span> a wildlife organization, or conservation group and find out how you can volunteer and offer your help. If you have a pet, you can celebrate World Animal Day by doing something special for your little companion. Buying new toys or other treats for your pet and spending some extra time playing with your animal friend are great ways to make your pet happy. Finally, if you can't go anywhere on World Animal Day, read a book or newspaper <span class="reading-gap">9</span> about animals, or do some research on an animal issue that concerns you.<br><br>
                    Animals need our love and attention and they depend on us to help them and protect them, so make World Animal Day a part of your life. It's never <span class="reading-gap">10</span> late to join in the celebration!
                </div>
            </div>
            
            <div class="resizer" id="resizer-t10"></div>
            
            <div class="questions-panel" id="questions-panel-t10">
                <h3>Questions</h3>
                <div id="questions-t10"></div>
            </div>
        </div>
        
        <div class="controls-row" style="margin-top: 40px !important; display: block !important; clear: both !important; position: relative !important; z-index: 1000; background: #f8f9fa; padding: 20px; border-radius: 8px; border: 1px solid #e9ecef;">
            <button class="btn btn-show-all" onclick="showAnswers('t10')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('t10')">Reset</button>
        </div>
    </div>
    
    <!-- Phrasal Verbs Section -->
    <div class="exercise-card">
        <div class="exercise-title">Phrasal verbs: take</div>
        
        <div class="instructions">12. Complete the sentences with the correct phrasal verb. Pay attention to the tenses.</div>
        
        <div class="phrasal-verb-container">
            <div class="phrasal-verb-bank" id="bank-t12"></div>
            <div id="questions-t12"></div>
        </div>
        
        <div class="controls-row">
            <button class="btn btn-show-all" onclick="showAnswers('t12')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('t12')">Reset</button>
        </div>
        
        <div class="instructions">13. Circle the correct preposition.</div>
        
        <div id="questions-t13"></div>
        <div class="controls-row">
            <button class="btn btn-show-all" onclick="showAnswers('t13')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('t13')">Reset</button>
        </div>
        
        <div class="instructions">14. Fill in the blanks with a noun derived from the words in capitals.</div>
        
        <div id="questions-t14"></div>
        <div class="controls-row">
            <button class="btn btn-show-all" onclick="showAnswers('t14')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('t14')">Reset</button>
        </div>
    </div>
</div>

<button class="check-all-btn" onclick="checkAll()">CHECK ALL ANSWERS (ENTER)</button>

<div class="context-menu" id="context-menu">
    <div class="context-menu-item" id="highlight-text">Highlight Text</div>
    <div class="context-menu-item" id="remove-highlight">Remove Highlight</div>
    <div class="context-menu-item" id="clear-highlights">Clear All Highlights</div>
</div>

<script>
// Data for Task 1: Types of animals
const t1_data = [
    { 
        q: "It has wings, a beak, and black and white feathers. Most species live in cold climates.", 
        ans: "penguin",
        hint: "This flightless bird lives in cold climates like Antarctica."
    },
    { 
        q: "It has four legs, black and white stripes, and a tail.", 
        ans: "zebra",
        hint: "This African animal looks like a horse with black and white stripes."
    },
    { 
        q: "It has black spots all over its body, a tail, big paws, whiskers, and it runs very fast.", 
        ans: "cheetah",
        hint: "This is the fastest land animal and has distinctive spots."
    },
    { 
        q: "It has wings and antennae. There are many different species of this insect.", 
        ans: "butterfly",
        hint: "This insect goes through metamorphosis and has colorful wings."
    },
    { 
        q: "It has a very large head and body, and it is usually gray or brown. It has a big horn on its head.", 
        ans: "rhino",
        hint: "This large mammal has a distinctive horn on its nose."
    },
    { 
        q: "It doesn't have any legs. It has a long body and scales. It slithers on the ground.", 
        ans: "snake",
        hint: "This reptile moves by slithering and some species are venomous."
    },
    { 
        q: "It has white feathers, wings, and a beak. It can float on water and live on land.", 
        ans: "swan",
        hint: "This elegant bird is often white and can swim in water."
    }
];

// Data for Task 2: Complete with verbs
const t2_data = [
    { q: "My friend, Danny, ...... a lot of fish on our fishing trip last week.", ans: "caught", hint: "Past tense of 'catch' is 'caught'." },
    { q: "I ...... a love for animals at a very young age.", ans: "developed", hint: "Develop means to grow or create over time." },
    { q: "A jellyfish ...... my leg last summer when I was swimming at the beach.", ans: "stung", hint: "Past tense of 'sting' is 'stung'." },
    { q: "Lions must ...... for their food in order to eat and survive.", ans: "hunt", hint: "Hunt means to chase and kill animals for food." },
    { q: "You shouldn't ...... a fear of animals and insects in children.", ans: "instil", hint: "Instil means to gradually implant an idea or feeling." }
];

const t2_wordBank = ["instil", "develop", "hunt", "catch", "sting"];

// Data for Task 3: Senses
const t3_data = [
    { q: "This chocolate cake ...... great! It's very delicious.", ans: "tastes", hint: "We use 'taste' for food to describe flavor." },
    { q: "Samantha has a problem with her vision, so she can't ...... things that are far away.", ans: "see", hint: "Vision problems affect the ability to see." },
    { q: "Did you ...... the strange sound that the animal made?", ans: "hear", hint: "Hear refers to perceiving sounds." },
    { q: "You're not allowed to ...... some of the animals at the zoo.", ans: "touch", hint: "Zoos often have rules about touching animals." },
    { q: "My new perfume ...... wonderful!", ans: "smells", hint: "Perfume is experienced through the sense of smell." }
];

const t3_wordBank = ["smell", "hear", "touch", "taste", "see"];

// Data for Task 4: Animal sounds
const t4_data = [
    { q: "My dog always ______ when he feels nervous or scared.", ans: "barks", hint: "Dogs typically bark when anxious." },
    { q: "The sound of bees ______ irritates me.", ans: "buzzing", hint: "Bees make a buzzing sound." },
    { q: "I was very frightened when I went camping last year. I heard owls ______ and wolves ______ every night!", ans: "hooting, howling", hint: "Owls hoot and wolves howl." },
    { q: "Gary bought three small mice last week. They ______ all day long, but Gary doesn't mind the noise.", ans: "squeak", hint: "Mice make squeaking sounds." },
    { q: "The beautiful horse ______ when it sensed danger approaching.", ans: "neighed", hint: "Horses neigh when excited or alarmed." },
    { q: "The little boy screamed when he heard the snake ______.", ans: "hiss", hint: "Snakes make a hissing sound." }
];

const t4_wordBank = ["hiss", "hoot", "squeak", "neigh", "bark", "howl", "buzz"];

// Data for Task 5: Past Perfect
const t5_data = [
    { q: "Jane was upset because she ...... (lose) her gold bracelet.", ans: "had lost", hint: "Past perfect shows an action completed before another past action." },
    { q: "Diane ...... (already/have) lunch, so she wasn't hungry.", ans: "had already had", hint: "Use 'had + past participle' for past perfect." },
    { q: "Mom ...... (cook) dinner before I returned from school.", ans: "had cooked", hint: "The cooking was completed before the return." },
    { q: "Amanda was angry because her best friend ...... (not/call) her on her birthday.", ans: "hadn't called", hint: "Negative past perfect uses 'had not + past participle'." },
    { q: "By the time I arrived, Jason ...... (leave).", ans: "had left", hint: "Jason left before I arrived." },
    { q: "Joanne was crying all day because she ...... (not/pass) the exam.", ans: "hadn't passed", hint: "She didn't pass the exam before she started crying." }
];

// Data for Task 6: Join sentences with Past Perfect
const t6_data = [
    { 
        q: "Jacob lived in New York. He moved to Spain. (before)", 
        ans: "Jacob had lived in New York before he moved to Spain.",
        example: "Jacob had lived in New York before he moved to Spain."
    },
    { 
        q: "They went to sleep. They ate dinner. (after)", 
        ans: "They went to sleep after they had eaten dinner.",
        hint: "First they ate dinner, then they went to sleep."
    },
    { 
        q: "I cleaned the house. My parents came home. (by the time)", 
        ans: "I had cleaned the house by the time my parents came home.",
        hint: "The cleaning was completed before the parents arrived."
    },
    { 
        q: "She went out with her friends. She finished her homework. (as soon as)", 
        ans: "She went out with her friends as soon as she had finished her homework.",
        hint: "First she finished homework, then immediately went out."
    },
    { 
        q: "Harry was sad. He failed his math exam. (because)", 
        ans: "Harry was sad because he had failed his math exam.",
        hint: "The failing happened before the sadness."
    },
    { 
        q: "Mom prepared dinner. Dad came home from work. (before)", 
        ans: "Mom had prepared dinner before Dad came home from work.",
        hint: "Mom finished cooking before Dad arrived."
    }
];

// Data for Task 7: Past Perfect Progressive
const t7_data = [
    { q: "Jake ………………… for two hours before his friends finally arrived.", ans: "had been waiting", hint: "He was waiting continuously before they arrived." },
    { q: "They ………………… for the exam all night, so they needed some rest.", ans: "had been studying", hint: "They were studying continuously before needing rest." },
    { q: "Martha looked exhausted because she ………………… for hours.", ans: "had been traveling", hint: "She was traveling continuously before looking exhausted." },
    { q: "My dad ………………… there for forty years before he retired.", ans: "had been working", hint: "He was working continuously for forty years before retiring." },
    { q: "Ralph and I ………………… in London before we moved to New York.", ans: "had been living", hint: "We were living continuously in London before moving." },
    { q: "She ………………… the house all day, so she was very tired in the evening.", ans: "had been cleaning", hint: "She was cleaning continuously all day before getting tired." }
];

const t7_wordBank = ["live", "travel", "wait", "clean", "work", "study"];

// Data for Task 8: Some — Any — Every — No
const t8_data = [
    { 
        q: "I can't find my wallet. I've looked anywhere/ everywhere.", 
        ans: "everywhere", 
        hint: "Use 'everywhere' to mean 'in all places'.",
        options: ["anywhere", "everywhere"]
    },
    { 
        q: "New York has lots of/much great museums and restaurants.", 
        ans: "lots of", 
        hint: "'Lots of' is used with countable plural nouns like museums and restaurants.",
        options: ["lots of", "much"]
    },
    { 
        q: "Are there every/any eggs left?", 
        ans: "any", 
        hint: "Use 'any' in questions with plural countable nouns.",
        options: ["every", "any"]
    },
    { 
        q: "Adam learned many/much new things in class today.", 
        ans: "many", 
        hint: "'Many' is used with countable plural nouns like 'things'.",
        options: ["many", "much"]
    },
    { 
        q: "No one/Anyone knows what really happened.", 
        ans: "No one", 
        hint: "'No one' means 'not a single person'.",
        options: ["No one", "Anyone"]
    },
    { 
        q: "We must get to the airport immediately. Our plane leaves in a little/a few minutes!", 
        ans: "a few", 
        hint: "'A few' is used with countable plural nouns like 'minutes'.",
        options: ["a little", "a few"]
    },
    { 
        q: "Can I borrow some/any money, please?", 
        ans: "some", 
        hint: "Use 'some' in polite requests expecting a positive answer.",
        options: ["some", "any"]
    },
    { 
        q: "How many/much flour do we need to add to the mixture?", 
        ans: "much", 
        hint: "'Much' is used with uncountable nouns like 'flour'.",
        options: ["many", "much"]
    },
    { 
        q: "Let's go somewhere/anywhere quiet so we can talk.", 
        ans: "somewhere", 
        hint: "Use 'somewhere' for a specific but unknown place.",
        options: ["somewhere", "anywhere"]
    }
];

// Data for Task 9: Circle the correct item
const t9_data = [
    { 
        q: "<strong>1</strong>. Philip is the ...... boy in my class.", 
        ans: "most handsome", 
        hint: "Superlative form of 'handsome' is 'most handsome'.",
        options: ["more handsome", "most handsome", "handsome"]
    },
    { 
        q: "<strong>2</strong>. I can't afford to buy these shoes. They're ...... expensive.", 
        ans: "too", 
        hint: "'Too' means more than necessary or wanted.",
        options: ["such", "too", "enough"]
    },
    { 
        q: "<strong>3</strong>. Harry ...... studying for his exam and now he feels stressed.", 
        ans: "put off", 
        hint: "'Put off' means to postpone or delay.",
        options: ["put on", "put down", "put off"]
    },
    { 
        q: "<strong>4</strong>. My friends ...... by the time I arrived.", 
        ans: "had left", 
        hint: "Past perfect shows action completed before another past action.",
        options: ["were leaving", "had left", "have left"]
    },
    { 
        q: "<strong>5</strong>. After a very long delay, the plane finally ...... .", 
        ans: "took off", 
        hint: "'Take off' means to leave the ground (for planes).",
        options: ["took off", "took down", "took on"]
    },
    { 
        q: "<strong>6</strong>. Do you need ...... from the supermarket?", 
        ans: "anything", 
        hint: "Use 'anything' in questions.",
        options: ["something", "nothing", "anything"]
    },
    { 
        q: "<strong>7</strong>. My parents ...... at the moment.", 
        ans: "are sleeping", 
        hint: "Present continuous for actions happening now.",
        options: ["sleep", "are sleeping", "slept"]
    },
    { 
        q: "<strong>8</strong>. We're going to the movies in a few minutes. Would you like ...... us?", 
        ans: "to join", 
        hint: "'Would like to + verb' is the correct structure.",
        options: ["join", "joining", "to join"]
    },
    { 
        q: "<strong>9</strong>. Derek ...... rock climbing because he is afraid of heights.", 
        ans: "hasn't tried", 
        hint: "Present perfect for experiences in life up to now.",
        options: ["has tried", "hasn't tried", "haven't tried"]
    },
    { 
        q: "<strong>10</strong>. She ...... the violin since she was seven.", 
        ans: "has been playing", 
        hint: "Present perfect continuous for actions started in past and continuing.",
        options: ["has been playing", "have been playing", "was playing"]
    },
    { 
        q: "<strong>11</strong>. Greg asked me to ...... with him on Friday night.", 
        ans: "go out", 
        hint: "'Go out' means to go on a date or socialize.",
        options: ["go about", "go out", "go on"]
    },
    { 
        q: "<strong>12</strong>. Samantha ...... when she saw an insect in her bedroom.", 
        ans: "screamed", 
        hint: "Simple past for completed action in the past.",
        options: ["screamed", "screaming", "have screamed"]
    },
    { 
        q: "<strong>13</strong>. I ...... with my cat, Felix, when the phone suddenly ......", 
        ans: "was playing, rang", 
        hint: "Past continuous for background action, simple past for interrupting action.",
        options: ["was playing, was ringing", "played, rang", "was playing, rang"]
    },
    { 
        q: "<strong>14</strong>. I haven't seen ...... in years!", 
        ans: "him", 
        hint: "Use object pronoun after verbs.",
        options: ["his", "he", "him"]
    },
    { 
        q: "<strong>15</strong>. Unfortunately, the bad news ...... to be true.", 
        ans: "turned out", 
        hint: "'Turn out' means to prove to be the case.",
        options: ["turned off", "turned out", "turned around"]
    },
    { 
        q: "<strong>16</strong>. I ...... go out every weekend when I was younger.", 
        ans: "used to", 
        hint: "'Used to' describes past habits.",
        options: ["using to", "used to", "use to"]
    },
    { 
        q: "<strong>17</strong>. They ...... video games every afternoon.", 
        ans: "play", 
        hint: "Present simple for routines and habits.",
        options: ["play", "playing", "are playing"]
    },
    { 
        q: "<strong>18</strong>. ...... are you going?", 
        ans: "Where", 
        hint: "'Where' asks about location or destination.",
        options: ["Who", "Where", "What"]
    },
    { 
        q: "<strong>19</strong>. My Spanish pen pal is coming to visit me ...... August.", 
        ans: "in", 
        hint: "Use 'in' for months.",
        options: ["at", "on", "in"]
    },
    { 
        q: "<strong>20</strong>. ...... hair is so long!", 
        ans: "Her", 
        hint: "Possessive adjective before noun.",
        options: ["She", "Her", "Hers"]
    },
    { 
        q: "<strong>21</strong>. Mom ...... the dishes as soon as we ...... eating.", 
        ans: "washed, had finished", 
        hint: "Simple past and past perfect for sequence of actions.",
        options: ["had washed, had finished", "washed, had finished", "had washed, finished"]
    },
    { 
        q: "<strong>22</strong>. I think that ...... is following us!", 
        ans: "someone", 
        hint: "'Someone' means an unknown or unspecified person.",
        options: ["anyone", "someone", "no one"]
    },
    { 
        q: "<strong>23</strong>. Carrie ...... late for work because she ...... the bus.", 
        ans: "was, had missed", 
        hint: "Simple past and past perfect for cause and effect.",
        options: ["was, had missed", "was, have missed", "was, has missed"]
    }
];

// Data for Task 10: Reading comprehension
const t10_data = [
    { 
        question: "1", 
        options: ["people", "everyone", "person", "individuals"], 
        correct: 1, // everyone
        hint: "'Everyone' means all people."
    },
    { 
        question: "2", 
        options: ["most", "some", "all", "every"], 
        correct: 3, // every
        hint: "'Every year' means each year without exception."
    },
    { 
        question: "3", 
        options: ["do", "take", "play", "show"], 
        correct: 2, // play
        hint: "'Play a role' is a common expression."
    },
    { 
        question: "4", 
        options: ["At", "In", "During", "On"], 
        correct: 3, // On
        hint: "Use 'on' for specific days."
    },
    { 
        question: "5", 
        options: ["anything", "something", "everything", "things"], 
        correct: 0, // anything
        hint: "Use 'anything' in negative contexts with 'doesn't'."
    },
    { 
        question: "6", 
        options: ["respect", "trust", "appreciation", "belief"], 
        correct: 2, // appreciation
        hint: "'Show appreciation' means to express gratitude or recognition."
    },
    { 
        question: "7", 
        options: ["visit", "trip", "journey", "tour"], 
        correct: 1, // trip
        hint: "'Take a trip' is a common expression."
    },
    { 
        question: "8", 
        options: ["Communicate", "Contact", "See", "Write"], 
        correct: 1, // Contact
        hint: "'Contact an organization' means to get in touch with them."
    },
    { 
        question: "9", 
        options: ["text", "story", "article", "letter"], 
        correct: 2, // article
        hint: "Newspapers contain articles."
    },
    { 
        question: "10", 
        options: ["very", "so", "too", "enough"], 
        correct: 2, // too
        hint: "'Never too late' is a common expression."
    }
];

// Data for Task 12: Phrasal verbs: take
const t12_data = [
    { q: "Frank is so kind and sweet. He ______ his mom.", ans: "takes after", hint: "'Take after' means to resemble a family member." },
    { q: "After years of hard work, the man ______ the company that he used to work for.", ans: "took over", hint: "'Take over' means to gain control of something." },
    { q: "We're too late! Our plane has already ______.", ans: "taken off", hint: "'Take off' means to leave the ground (for planes)." },
    { q: "Ben ______ me ______ to dinner last night. We had a wonderful time.", ans: "took, out", hint: "'Take someone out' means to invite them somewhere." },
    { q: "Danny ...... karate and judo last month.", ans: "took up", hint: "'Take up' means to start a new hobby or activity." },
    { q: "I ...... all the decorations after the party had ended.", ans: "took down", hint: "'Take down' means to remove something." }
];

const t12_wordBank = ["take over", "take up", "take off", "take after", "take down", "take out"];

// Data for Task 13: Prepositions
const t13_data = [
    { 
        q: "<strong>1</strong> Keith loves reading books <span class='bold-option'>for</span> / <span class='bold-option'>about</span> animals and nature.", 
        ans: "about", 
        hint: "Read about a topic.",
        options: ["for", "about"]
    },
    { 
        q: "<strong>2</strong> She's been working <span class='bold-option'>on</span> / <span class='bold-option'>in</span> this project for many months.", 
        ans: "on", 
        hint: "Work on a project.",
        options: ["on", "in"]
    },
    { 
        q: "<strong>3</strong> The children love playing <span class='bold-option'>at</span> / <span class='bold-option'>with</span> their dog, Sparky.", 
        ans: "with", 
        hint: "Play with someone or something.",
        options: ["at", "with"]
    },
    { 
        q: "<strong>4</strong> The aquarium opens <span class='bold-option'>on</span> / <span class='bold-option'>at</span> 10 o'clock every morning.", 
        ans: "at", 
        hint: "Use 'at' for specific times.",
        options: ["on", "at"]
    },
    { 
        q: "<strong>5</strong> Some animals can see better <span class='bold-option'>on</span> / <span class='bold-option'>in</span> the dark.", 
        ans: "in", 
        hint: "'In the dark' is the correct expression.",
        options: ["on", "in"]
    },
    { 
        q: "<strong>6</strong> Donna devotes all her free time <span class='bold-option'>to</span> / <span class='bold-option'>for</span> helping endangered animals.", 
        ans: "to", 
        hint: "Devote time to something.",
        options: ["to", "for"]
    },
    { 
        q: "<strong>7</strong> Brad is studying <span class='bold-option'>for</span> / <span class='bold-option'>at</span> his history test at the moment.", 
        ans: "for", 
        hint: "Study for a test or exam.",
        options: ["for", "at"]
    }
];

// Data for Task 14: Word formation
const t14_data = [
    { 
        q: "All people need some ______ in order to feel good about themselves and accomplish their goals. <strong>ENCOURAGE</strong>", 
        ans: "encouragement",
        hint: "Noun form of 'encourage' is 'encouragement'."
    },
    { 
        q: "My sister and I get along very well. We've never really had a serious ______. <strong>ARGUE</strong>", 
        ans: "argument",
        hint: "Noun form of 'argue' is 'argument'."
    },
    { 
        q: "She has excellent ______ skills. She pays very close attention to detail. <strong>OBSERVE</strong>", 
        ans: "observational|observation",
        hint: "Both 'observational' and 'observation' are acceptable here."
    },
    { 
        q: "I have to give a ______ in my science class. I'm going to discuss my favorite animal. <strong>PRESENT</strong>", 
        ans: "presentation",
        hint: "Noun form of 'present' is 'presentation'."
    },
    { 
        q: "Ken never reads the ______ of any book because he finds it quite boring. <strong>INTRODUCE</strong>", 
        ans: "introduction",
        hint: "Noun form of 'introduce' is 'introduction'."
    },
    { 
        q: "After some ______, Helen decided what she wanted to do for her birthday. <strong>CONSIDER</strong>", 
        ans: "consideration",
        hint: "Noun form of 'consider' is 'consideration'."
    }
];

let answerStates = new Map();
let wordUsageCount = {};
let optionSelections = new Map();
let readingSelections = new Map();
let phrasalVerbUsage = {};
let selectedTextRange = null;
let contextMenu = null;

// Render functions for each task
function renderTask1() {
    const container = document.getElementById('questions-t1');
    container.innerHTML = '';
    
    t1_data.forEach((item, i) => {
        const qid = `t1-q${i}`;
        container.innerHTML += `
            <div class="question-row">
                <strong>${i+1}.</strong> ${item.q}
                <input type="text" class="word-input" id="${qid}" data-type="input" data-ans="${item.ans}" oninput="adjustWidth(this)" onclick="this.select()">
                <div class="row-btns">
                    <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')">👁️</button>
                    <button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')">i</button>
                </div>
                <div class="hint-box" id="${qid}-hint">💡 ${item.hint}</div>
            </div>`;
    });
}

function renderTask2() {
    const bankContainer = document.getElementById('bank-t2');
    const questionContainer = document.getElementById('questions-t2');
    
    bankContainer.innerHTML = '';
    wordUsageCount['t2'] = {};
    
    t2_wordBank.forEach((word, i) => {
        const wordId = `t2-word-${i}`;
        bankContainer.innerHTML += `
            <div class="word-item" id="${wordId}" data-word="${word.toLowerCase()}" draggable="true" ondragstart="dragWord(event)" onclick="selectWordFromBank('${wordId}')">
                ${word.toLowerCase()}
            </div>`;
        wordUsageCount['t2'][word.toLowerCase()] = 0;
    });
    
    questionContainer.innerHTML = '';
    
    t2_data.forEach((item, i) => {
        const qid = `t2-q${i}`;
        questionContainer.innerHTML += `
            <div class="question-row">
                <strong>${i+1}.</strong> ${item.q}
                <input type="text" class="word-input" id="${qid}" data-type="input" data-ans="${item.ans}" oninput="adjustWidth(this); updateWordBank('t2')" ondrop="dropWord(event, '${qid}')" ondragover="allowDrop(event)" onclick="this.select()">
                <div class="row-btns">
                    <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')">👁️</button>
                    <button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')">i</button>
                </div>
                <div class="hint-box" id="${qid}-hint">💡 ${item.hint}</div>
            </div>`;
    });
    
    addWordBankEventListeners('t2');
}

function renderTask3() {
    const bankContainer = document.getElementById('bank-t3');
    const questionContainer = document.getElementById('questions-t3');
    
    bankContainer.innerHTML = '';
    wordUsageCount['t3'] = {};
    
    t3_wordBank.forEach((word, i) => {
        const wordId = `t3-word-${i}`;
        bankContainer.innerHTML += `
            <div class="word-item" id="${wordId}" data-word="${word.toLowerCase()}" draggable="true" ondragstart="dragWord(event)" onclick="selectWordFromBank('${wordId}')">
                ${word.toLowerCase()}
            </div>`;
        wordUsageCount['t3'][word.toLowerCase()] = 0;
    });
    
    questionContainer.innerHTML = '';
    
    t3_data.forEach((item, i) => {
        const qid = `t3-q${i}`;
        questionContainer.innerHTML += `
            <div class="question-row">
                <strong>${i+1}.</strong> ${item.q}
                <input type="text" class="word-input" id="${qid}" data-type="input" data-ans="${item.ans}" oninput="adjustWidth(this); updateWordBank('t3')" ondrop="dropWord(event, '${qid}')" ondragover="allowDrop(event)" onclick="this.select()">
                <div class="row-btns">
                    <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')">👁️</button>
                    <button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')">i</button>
                </div>
                <div class="hint-box" id="${qid}-hint">💡 ${item.hint}</div>
            </div>`;
    });
    
    addWordBankEventListeners('t3');
}

function renderTask4() {
    const bankContainer = document.getElementById('bank-t4');
    const questionContainer = document.getElementById('questions-t4');
    
    bankContainer.innerHTML = '';
    wordUsageCount['t4'] = {};
    
    t4_wordBank.forEach((word, i) => {
        const wordId = `t4-word-${i}`;
        bankContainer.innerHTML += `
            <div class="word-item" id="${wordId}" data-word="${word.toLowerCase()}" draggable="true" ondragstart="dragWord(event)" onclick="selectWordFromBank('${wordId}')">
                ${word.toLowerCase()}
            </div>`;
        wordUsageCount['t4'][word.toLowerCase()] = 0;
    });
    
    questionContainer.innerHTML = '';
    
    t4_data.forEach((item, i) => {
        const qid = `t4-q${i}`;
        let questionHtml = `<strong>${i+1}.</strong> ${item.q.split('______')[0]}`;
        
        if (item.ans.includes(',')) {
            const answers = item.ans.split(', ');
            questionHtml += `<input type="text" class="word-input" id="${qid}-1" data-type="input" data-ans="${answers[0]}" oninput="adjustWidth(this); updateWordBank('t4')" ondrop="dropWord(event, '${qid}-1')" ondragover="allowDrop(event)" onclick="this.select()">`;
            questionHtml += ` and <input type="text" class="word-input" id="${qid}-2" data-type="input" data-ans="${answers[1]}" oninput="adjustWidth(this); updateWordBank('t4')" ondrop="dropWord(event, '${qid}-2')" ondragover="allowDrop(event)" onclick="this.select()">`;
            questionHtml += item.q.split('______')[1] || '';
        } else {
            questionHtml += `<input type="text" class="word-input" id="${qid}" data-type="input" data-ans="${item.ans}" oninput="adjustWidth(this); updateWordBank('t4')" ondrop="dropWord(event, '${qid}')" ondragover="allowDrop(event)" onclick="this.select()">`;
            questionHtml += item.q.split('______')[1] || '';
        }
        
        questionContainer.innerHTML += `
            <div class="question-row">
                ${questionHtml}
                <div class="row-btns">
                    <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')">👁️</button>
                    <button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')">i</button>
                </div>
                <div class="hint-box" id="${qid}-hint">💡 ${item.hint}</div>
            </div>`;
    });
    
    addWordBankEventListeners('t4');
}

function renderTask5() {
    const container = document.getElementById('questions-t5');
    container.innerHTML = '';
    
    t5_data.forEach((item, i) => {
        const qid = `t5-q${i}`;
        container.innerHTML += `
            <div class="question-row">
                <strong>${i+1}.</strong> ${item.q}
                <input type="text" class="word-input" id="${qid}" data-type="input" data-ans="${item.ans}" oninput="adjustWidth(this)" onclick="this.select()">
                <div class="row-btns">
                    <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')">👁️</button>
                    <button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')">i</button>
                </div>
                <div class="hint-box" id="${qid}-hint">💡 ${item.hint}</div>
            </div>`;
    });
}

function renderTask6() {
    const container = document.getElementById('questions-t6');
    container.innerHTML = '';
    
    t6_data.forEach((item, i) => {
        const qid = `t6-q${i}`;
        container.innerHTML += `
            <div class="question-row">
                <strong>${i+1}.</strong> ${item.q}
                <input type="text" class="word-input" id="${qid}" data-type="input" data-ans="${item.ans}" oninput="adjustWidth(this)" onclick="this.select()">
                <div class="row-btns">
                    <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')">👁️</button>
                    <button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')">i</button>
                </div>
                <div class="hint-box" id="${qid}-hint">💡 ${item.hint || item.example}</div>
            </div>`;
    });
}

function renderTask7() {
    const bankContainer = document.getElementById('bank-t7');
    const questionContainer = document.getElementById('questions-t7');
    
    bankContainer.innerHTML = '';
    wordUsageCount['t7'] = {};
    
    t7_wordBank.forEach((word, i) => {
        const wordId = `t7-word-${i}`;
        bankContainer.innerHTML += `
            <div class="word-item" id="${wordId}" data-word="${word.toLowerCase()}" draggable="true" ondragstart="dragWord(event)" onclick="selectWordFromBank('${wordId}')">
                ${word.toLowerCase()}
            </div>`;
        wordUsageCount['t7'][word.toLowerCase()] = 0;
    });
    
    questionContainer.innerHTML = '';
    
    t7_data.forEach((item, i) => {
        const qid = `t7-q${i}`;
        questionContainer.innerHTML += `
            <div class="question-row">
                <strong>${i+1}.</strong> ${item.q}
                <input type="text" class="word-input" id="${qid}" data-type="input" data-ans="${item.ans}" oninput="adjustWidth(this); updateWordBank('t7')" ondrop="dropWord(event, '${qid}')" ondragover="allowDrop(event)" onclick="this.select()">
                <div class="row-btns">
                    <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')">👁️</button>
                    <button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')">i</button>
                </div>
                <div class="hint-box" id="${qid}-hint">💡 ${item.hint}</div>
            </div>`;
    });
    
    addWordBankEventListeners('t7');
}

function renderTask8() {
    const container = document.getElementById('questions-t8');
    container.innerHTML = '';
    
    t8_data.forEach((item, i) => {
        const qid = `t8-q${i}`;
        
        let optionsHtml = '';
        item.options.forEach((option, optIndex) => {
            optionsHtml += `<button class="option-btn" onclick="selectOption('${qid}', '${option}')" id="${qid}-opt${optIndex}">${option}</button>`;
        });
        
        container.innerHTML += `
            <div class="question-row">
                <span class="sentence-text">
                    <strong>${i+1}.</strong> ${item.q}
                    <div class="option-container">
                        ${optionsHtml}
                    </div>
                </span>
                <div class="row-btns">
                    <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')">👁️</button>
                    <button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')">i</button>
                </div>
                <div class="hint-box" id="${qid}-hint">💡 ${item.hint}</div>
            </div>`;
    });
}

function renderTask9() {
    const container = document.getElementById('questions-t9');
    container.innerHTML = '';
    
    t9_data.forEach((item, i) => {
        const qid = `t9-q${i}`;
        
        let optionsHtml = '';
        item.options.forEach((option, optIndex) => {
            optionsHtml += `<button class="option-btn" onclick="selectOption('${qid}', '${option}')" id="${qid}-opt${optIndex}">${option}</button>`;
        });
        
        container.innerHTML += `
            <div class="question-row">
                <span class="sentence-text">
                    ${item.q}
                    <div class="option-container">
                        ${optionsHtml}
                    </div>
                </span>
                <div class="row-btns">
                    <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')">👁️</button>
                    <button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')">i</button>
                </div>
                <div class="hint-box" id="${qid}-hint">💡 ${item.hint}</div>
            </div>`;
    });
}

function renderTask10() {
    const questionsContainer = document.getElementById('questions-t10');
    questionsContainer.innerHTML = '';
    
    t10_data.forEach((item, i) => {
        const qid = `t10-q${i}`;
        const optionLetters = ['A', 'B', 'C', 'D'];
        
        let optionsHtml = '<div class="mcq-options-container">';
        item.options.forEach((option, optIndex) => {
            const letter = optionLetters[optIndex];
            optionsHtml += `
                <div class="mcq-option" id="${qid}-option-${optIndex}" onclick="selectReadingOption('${qid}', ${optIndex})">
                    <span class="option-letter">${letter}</span>
                    <span class="option-text">${option}</span>
                </div>`;
        });
        optionsHtml += '</div>';
        
        questionsContainer.innerHTML += `
            <div class="mcq-question" id="${qid}-container">
                <p><strong>${item.question}</strong></p>
                ${optionsHtml}
                <div class="row-btns" style="margin-top: 10px;">
                    <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')">👁️</button>
                    <button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')">i</button>
                </div>
                <div class="hint-box" id="${qid}-hint">💡 ${item.hint}</div>
            </div>`;
    });
}

function renderTask12() {
    const bankContainer = document.getElementById('bank-t12');
    const questionContainer = document.getElementById('questions-t12');
    
    bankContainer.innerHTML = '';
    phrasalVerbUsage['t12'] = {};
    
    t12_wordBank.forEach((phrase, i) => {
        const phraseId = `t12-phrase-${i}`;
        bankContainer.innerHTML += `
            <div class="phrasal-verb-item" id="${phraseId}" data-phrase="${phrase}" onclick="selectPhrasalVerb('${phraseId}')">
                ${phrase}
            </div>`;
        phrasalVerbUsage['t12'][phrase] = false;
    });
    
    questionContainer.innerHTML = '';
    
    t12_data.forEach((item, i) => {
        const qid = `t12-q${i}`;
        let questionText = item.q;
        
        if (item.ans.includes(',')) {
            const answers = item.ans.split(', ');
            questionText = questionText.replace('______', `<input type="text" class="word-input" id="${qid}-1" data-type="input" data-ans="${answers[0]}" oninput="adjustWidth(this)" onclick="this.select()">`);
            questionText = questionText.replace('______', `<input type="text" class="word-input" id="${qid}-2" data-type="input" data-ans="${answers[1]}" oninput="adjustWidth(this)" onclick="this.select()">`);
        } else {
            questionText = questionText.replace('______', `<input type="text" class="word-input" id="${qid}" data-type="input" data-ans="${item.ans}" oninput="adjustWidth(this)" onclick="this.select()">`);
        }
        
        questionContainer.innerHTML += `
            <div class="question-row">
                <strong>${i+1}.</strong> ${questionText}
                <div class="row-btns">
                    <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')">👁️</button>
                    <button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')">i</button>
                </div>
                <div class="hint-box" id="${qid}-hint">💡 ${item.hint}</div>
            </div>`;
    });
}

function renderTask13() {
    const container = document.getElementById('questions-t13');
    container.innerHTML = '';
    
    t13_data.forEach((item, i) => {
        const qid = `t13-q${i}`;
        
        let optionsHtml = '';
        item.options.forEach((option, optIndex) => {
            optionsHtml += `<button class="option-btn" onclick="selectOption('${qid}', '${option}')" id="${qid}-opt${optIndex}">${option}</button>`;
        });
        
        container.innerHTML += `
            <div class="question-row">
                <span class="sentence-text">
                    ${item.q}
                    <div class="option-container">
                        ${optionsHtml}
                    </div>
                </span>
                <div class="row-btns">
                    <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')">👁️</button>
                    <button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')">i</button>
                </div>
                <div class="hint-box" id="${qid}-hint">💡 ${item.hint}</div>
            </div>`;
    });
}

function renderTask14() {
    const container = document.getElementById('questions-t14');
    container.innerHTML = '';
    
    t14_data.forEach((item, i) => {
        const qid = `t14-q${i}`;
        container.innerHTML += `
            <div class="question-row">
                <strong>${i+1}.</strong> ${item.q}
                <input type="text" class="word-formation-input" id="${qid}" data-type="input" data-ans="${item.ans}" oninput="adjustWidth(this)" onclick="this.select()">
                <div class="row-btns">
                    <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')">👁️</button>
                    <button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')">i</button>
                </div>
                <div class="hint-box" id="${qid}-hint">💡 ${item.hint}</div>
            </div>`;
    });
}

// Helper functions
function adjustWidth(el) { 
    let baseWidth;
    if (el.classList.contains('letter-input')) {
        baseWidth = 45;
    } else if (el.classList.contains('word-input') || el.classList.contains('word-formation-input')) {
        baseWidth = 120;
    } else {
        baseWidth = 60;
    }
    
    const charWidth = (el.classList.contains('word-input') || el.classList.contains('word-formation-input')) ? 9 : 10;
    const newWidth = Math.max(el.value.length * charWidth + 40, baseWidth); // Thêm padding để đảm bảo thừa không gian
    
    let maxWidth = 800; // Tăng max-width để chứa nội dung dài
    
    el.style.width = Math.min(newWidth, maxWidth) + "px";
}

function toggleHint(id) { 
    const h = document.getElementById(id + '-hint'); 
    const infoBtn = document.getElementById(id + '-info');
    
    if (h) {
        if (h.style.display === 'block') {
            h.style.display = 'none';
            if (infoBtn) infoBtn.classList.remove('active');
        } else {
            h.style.display = 'block';
            if (infoBtn) infoBtn.classList.add('active');
        }
    }
}

function toggleSingleAns(id) { 
    const qid = id.replace('-eye', '');
    
    // Check if this is a reading question
    if (qid.startsWith('t10-q')) {
        const questionIndex = parseInt(qid.split('-q')[1]);
        const questionData = t10_data[questionIndex];
        const correctAnswerIndex = questionData.correct;
        
        // Highlight the correct option
        const options = document.querySelectorAll(`#${qid}-container .mcq-option`);
        options.forEach((option, index) => {
            option.classList.remove('correct', 'incorrect', 'selected');
            if (index === correctAnswerIndex) {
                option.classList.add('correct');
            }
        });
        
        const eyeBtn = document.getElementById(id);
        if (eyeBtn) eyeBtn.classList.add('active');
        answerStates.set(`${qid}-state`, true);
        return;
    }
    
    // Check if this is an option-based question
    if (qid.startsWith('t8-q') || qid.startsWith('t9-q') || qid.startsWith('t13-q')) {
        const questionIndex = parseInt(qid.split('-q')[1]);
        let data;
        
        if (qid.startsWith('t8-q')) data = t8_data;
        else if (qid.startsWith('t9-q')) data = t9_data;
        else data = t13_data;
        
        const questionData = data[questionIndex];
        const correctAnswer = questionData.ans;
        
        const optionButtons = [];
        for (let i = 0; i < questionData.options.length; i++) {
            const btn = document.getElementById(`${qid}-opt${i}`);
            if (btn) optionButtons.push(btn);
        }
        
        const stateKey = `${qid}-state`;
        const isCurrentlyShown = answerStates.get(stateKey) || false;
        
        if (isCurrentlyShown) {
            optionButtons.forEach(btn => {
                btn.classList.remove('correct-option', 'incorrect-option');
                const userSelection = optionSelections.get(qid);
                if (userSelection && btn.textContent === userSelection) {
                    btn.classList.add('selected');
                }
            });
            
            const eyeBtn = document.getElementById(id);
            if (eyeBtn) eyeBtn.classList.remove('active');
            answerStates.set(stateKey, false);
        } else {
            optionButtons.forEach(btn => {
                btn.classList.remove('selected', 'correct-option', 'incorrect-option');
                if (btn.textContent === correctAnswer) {
                    btn.classList.add('correct-option');
                }
            });
            
            const eyeBtn = document.getElementById(id);
            if (eyeBtn) eyeBtn.classList.add('active');
            answerStates.set(stateKey, true);
        }
        return;
    }
    
    // Regular input-based questions
    const el = document.getElementById(qid);
    if (!el) return;
    
    // Handle multiple inputs for same question (like t4 questions with two answers)
    if (qid.includes('-1') || qid.includes('-2')) {
        const baseQid = qid.substring(0, qid.lastIndexOf('-'));
        const suffix = qid.substring(qid.lastIndexOf('-'));
        
        let otherQid;
        if (suffix === '-1') {
            otherQid = baseQid + '-2';
        } else {
            otherQid = baseQid + '-1';
        }
        
        const otherEl = document.getElementById(otherQid);
        const ans1 = el.dataset.ans;
        const ans2 = otherEl ? otherEl.dataset.ans : null;
        
        const eyeBtn = document.getElementById(id);
        const stateKey = `${qid}-state`;
        const isCurrentlyShown = answerStates.get(stateKey) || false;
        
        if (isCurrentlyShown) {
            el.value = "";
            el.classList.remove('correct', 'incorrect-marked');
            adjustWidth(el);
            if (eyeBtn) eyeBtn.classList.remove('active');
            answerStates.set(stateKey, false);
            
            // Also reset the other input if showing answer
            if (otherEl) {
                const otherStateKey = `${otherQid}-state`;
                if (answerStates.get(otherStateKey)) {
                    otherEl.value = "";
                    otherEl.classList.remove('correct', 'incorrect-marked');
                    adjustWidth(otherEl);
                    answerStates.set(otherStateKey, false);
                }
            }
        } else {
            if (ans1) {
                el.value = ans1;
                el.classList.add('correct');
                el.classList.remove('incorrect-marked');
                adjustWidth(el);
                if (eyeBtn) eyeBtn.classList.add('active');
                answerStates.set(stateKey, true);
                
                // Also show the other answer if it exists
                if (otherEl && ans2) {
                    otherEl.value = ans2;
                    otherEl.classList.add('correct');
                    otherEl.classList.remove('incorrect-marked');
                    adjustWidth(otherEl);
                    answerStates.set(`${otherQid}-state`, true);
                }
            }
        }
        return;
    }
    
    // Single input questions
    const ans = el.dataset.ans;
    const eyeBtn = document.getElementById(id);
    const stateKey = `${qid}-state`;
    const isCurrentlyShown = answerStates.get(stateKey) || false;
    
    if (isCurrentlyShown) {
        el.value = "";
        el.classList.remove('correct', 'incorrect-marked');
        adjustWidth(el);
        if (eyeBtn) eyeBtn.classList.remove('active');
        answerStates.set(stateKey, false);
    } else {
        if (ans) {
            el.value = ans;
            el.classList.add('correct');
            el.classList.remove('incorrect-marked');
            adjustWidth(el);
            if (eyeBtn) eyeBtn.classList.add('active');
            answerStates.set(stateKey, true);
        }
    }
}

function selectOption(qid, option) {
    const questionIndex = parseInt(qid.split('-q')[1]);
    let data;
    
    if (qid.startsWith('t8-q')) data = t8_data;
    else if (qid.startsWith('t9-q')) data = t9_data;
    else if (qid.startsWith('t13-q')) data = t13_data;
    else return;
    
    const questionData = data[questionIndex];
    
    const optionButtons = [];
    for (let i = 0; i < questionData.options.length; i++) {
        const btn = document.getElementById(`${qid}-opt${i}`);
        if (btn) optionButtons.push(btn);
    }
    
    optionButtons.forEach(btn => {
        btn.classList.remove('selected');
    });
    
    const selectedBtn = optionButtons.find(btn => btn.textContent === option);
    if (selectedBtn) {
        selectedBtn.classList.add('selected');
    }
    
    optionSelections.set(qid, option);
}

function selectReadingOption(qid, optionIndex) {
    const questionIndex = parseInt(qid.split('-q')[1]);
    const questionData = t10_data[questionIndex];
    
    // Remove selected class from all options
    const options = document.querySelectorAll(`#${qid}-container .mcq-option`);
    options.forEach(option => {
        option.classList.remove('selected');
    });
    
    // Add selected class to clicked option
    const selectedOption = document.getElementById(`${qid}-option-${optionIndex}`);
    if (selectedOption) {
        selectedOption.classList.add('selected');
    }
    
    readingSelections.set(qid, optionIndex);
}

function selectPhrasalVerb(phraseId) {
    const phraseItem = document.getElementById(phraseId);
    if (!phraseItem || phraseItem.classList.contains('used')) return;
    
    const phrase = phraseItem.dataset.phrase;
    const taskId = phraseId.split('-')[1];
    
    const inputs = document.querySelectorAll(`#questions-t${taskId} input.word-input`);
    let emptyInput = null;
    
    for (const input of inputs) {
        if (!input.value.trim()) {
            emptyInput = input;
            break;
        }
    }
    
    if (emptyInput) {
        emptyInput.value = phrase;
        adjustWidth(emptyInput);
        
        // Mark the phrase as used
        phraseItem.classList.add('used');
        phrasalVerbUsage['t12'][phrase] = true;
    } else {
        alert('All gaps are filled. You can click on a gap to replace its content.');
    }
}

function showAnswers(prefix) { 
    if (prefix === 't10') {
        // Handle reading questions
        t10_data.forEach((item, i) => {
            const qid = `${prefix}-q${i}`;
            const correctIndex = item.correct;
            
            // Highlight correct answer
            const options = document.querySelectorAll(`#${qid}-container .mcq-option`);
            options.forEach((option, index) => {
                option.classList.remove('correct', 'incorrect', 'selected');
                if (index === correctIndex) {
                    option.classList.add('correct');
                }
            });
            
            const eyeBtn = document.getElementById(`${qid}-eye`);
            if (eyeBtn) eyeBtn.classList.add('active');
            answerStates.set(`${qid}-state`, true);
        });
        return;
    }
    
    if (prefix === 't8' || prefix === 't9' || prefix === 't13') {
        let data;
        if (prefix === 't8') data = t8_data;
        else if (prefix === 't9') data = t9_data;
        else data = t13_data;
        
        data.forEach((item, i) => {
            const qid = `${prefix}-q${i}`;
            const correctAnswer = item.ans;
            
            const optionButtons = [];
            for (let j = 0; j < item.options.length; j++) {
                const btn = document.getElementById(`${qid}-opt${j}`);
                if (btn) optionButtons.push(btn);
            }
            
            optionButtons.forEach(btn => {
                btn.classList.remove('selected', 'correct-option', 'incorrect-option');
                if (btn.textContent === correctAnswer) {
                    btn.classList.add('correct-option');
                }
            });
            
            const eyeBtn = document.getElementById(`${qid}-eye`);
            if (eyeBtn) eyeBtn.classList.add('active');
            answerStates.set(`${qid}-state`, true);
        });
        return;
    }
    
    // Handle special case for task 4 with two answers
    if (prefix === 't4') {
        t4_data.forEach((item, i) => {
            const qid = `${prefix}-q${i}`;
            const correctAnswer = item.ans;
            
            if (correctAnswer.includes(',')) {
                const answers = correctAnswer.split(', ');
                const input1 = document.getElementById(`${qid}-1`);
                const input2 = document.getElementById(`${qid}-2`);
                
                if (input1 && answers[0]) {
                    input1.value = answers[0];
                    input1.classList.add('correct');
                    adjustWidth(input1);
                    answerStates.set(`${qid}-1-state`, true);
                }
                
                if (input2 && answers[1]) {
                    input2.value = answers[1];
                    input2.classList.add('correct');
                    adjustWidth(input2);
                    answerStates.set(`${qid}-2-state`, true);
                }
                
                const eyeBtn = document.getElementById(`${qid}-eye`);
                if (eyeBtn) eyeBtn.classList.add('active');
            } else {
                const input = document.getElementById(qid);
                if (input) {
                    input.value = correctAnswer;
                    input.classList.add('correct');
                    adjustWidth(input);
                    
                    const eyeBtn = document.getElementById(`${qid}-eye`);
                    if (eyeBtn) eyeBtn.classList.add('active');
                    answerStates.set(`${qid}-state`, true);
                }
            }
        });
        return;
    }
    
    // Handle special case for task 12 with two answers
    if (prefix === 't12') {
        t12_data.forEach((item, i) => {
            const qid = `${prefix}-q${i}`;
            const correctAnswer = item.ans;
            
            if (correctAnswer.includes(',')) {
                const answers = correctAnswer.split(', ');
                const input1 = document.getElementById(`${qid}-1`);
                const input2 = document.getElementById(`${qid}-2`);
                
                if (input1 && answers[0]) {
                    input1.value = answers[0];
                    input1.classList.add('correct');
                    adjustWidth(input1);
                    answerStates.set(`${qid}-1-state`, true);
                }
                
                if (input2 && answers[1]) {
                    input2.value = answers[1];
                    input2.classList.add('correct');
                    adjustWidth(input2);
                    answerStates.set(`${qid}-2-state`, true);
                }
            } else {
                const input = document.getElementById(qid);
                if (input) {
                    input.value = correctAnswer;
                    input.classList.add('correct');
                    adjustWidth(input);
                    answerStates.set(`${qid}-state`, true);
                }
            }
            
            const eyeBtn = document.getElementById(`${qid}-eye`);
            if (eyeBtn) eyeBtn.classList.add('active');
        });
        
        // Mark all phrasal verbs as used
        const phraseItems = document.querySelectorAll(`#bank-${prefix} .phrasal-verb-item`);
        phraseItems.forEach(item => {
            item.classList.add('used');
        });
        
        return;
    }
    
    // Handle all other tasks
    document.querySelectorAll(`[id^="${prefix}-"]`).forEach(el => {
        if (el.dataset && el.dataset.type === 'input') {
            const ans = el.dataset.ans;
            const eyeBtn = document.getElementById(el.id + '-eye');
            
            if (ans) {
                el.value = ans;
                el.classList.add('correct');
                el.classList.remove('incorrect-marked');
                adjustWidth(el);
                if (eyeBtn) eyeBtn.classList.add('active');
                
                answerStates.set(`${el.id}-state`, true);
            }
        }
    });
    
    // Update word bank display for tasks with word banks
    if (prefix === 't2' || prefix === 't3' || prefix === 't4' || prefix === 't7') {
        updateWordBankDisplay(prefix);
    }
}

function resetSection(prefix) { 
    document.querySelectorAll(`[id^="${prefix}"]`).forEach(i => { 
        if(i.tagName === 'INPUT') { 
            i.value = ""; 
            i.classList.remove('correct', 'incorrect-marked'); 
            adjustWidth(i); 
            
            answerStates.delete(`${i.id}-state`);
        } 
        
        const hBox = document.getElementById(i.id + '-hint'); 
        if(hBox) hBox.style.display = 'none'; 
    });
    
    document.querySelectorAll(`[id$="-eye"], [id$="-info"]`).forEach(btn => {
        if (btn.id.includes(prefix)) {
            btn.classList.remove('active');
        }
    });
    
    if (prefix === 't8' || prefix === 't9' || prefix === 't13') {
        const allOptionBtns = document.querySelectorAll(`#questions-${prefix} .option-btn`);
        
        allOptionBtns.forEach(btn => {
            btn.classList.remove('selected', 'correct-option', 'incorrect-option');
        });
        
        for (const [key, value] of optionSelections.entries()) {
            if (key.startsWith(`${prefix}-`)) {
                optionSelections.delete(key);
            }
        }
        
        document.querySelectorAll(`#questions-${prefix} .btn-small[id$="-eye"]`).forEach(eyeBtn => {
            eyeBtn.classList.remove('active');
        });
        
        for (const [key, value] of answerStates.entries()) {
            if (key.includes(`${prefix}-q`)) {
                answerStates.delete(key);
            }
        }
    }
    
    if (prefix === 't10') {
        // Reset reading questions
        const options = document.querySelectorAll(`#questions-${prefix} .mcq-option`);
        options.forEach(option => {
            option.classList.remove('selected', 'correct', 'incorrect');
        });
        
        readingSelections.clear();
        
        document.querySelectorAll(`#questions-${prefix} .btn-small[id$="-eye"]`).forEach(eyeBtn => {
            eyeBtn.classList.remove('active');
        });
        
        for (const [key, value] of answerStates.entries()) {
            if (key.includes(`${prefix}-q`)) {
                answerStates.delete(key);
            }
        }
    }
    
    if (prefix === 't2' || prefix === 't3' || prefix === 't4' || prefix === 't7') {
        const wordItems = document.querySelectorAll(`#bank-${prefix} .word-item`);
        wordItems.forEach(item => {
            item.classList.remove('used');
        });
        
        if (wordUsageCount[prefix]) {
            Object.keys(wordUsageCount[prefix]).forEach(word => {
                wordUsageCount[prefix][word] = 0;
            });
        }
    }
    
    if (prefix === 't12') {
        const phraseItems = document.querySelectorAll(`#bank-${prefix} .phrasal-verb-item`);
        phraseItems.forEach(item => {
            item.classList.remove('used');
        });
        
        if (phrasalVerbUsage[prefix]) {
            Object.keys(phrasalVerbUsage[prefix]).forEach(phrase => {
                phrasalVerbUsage[prefix][phrase] = false;
            });
        }
    }
}

function normalizeAnswer(answer) {
    if (!answer) return '';
    return answer.toLowerCase()
        .trim()
        .replace(/\s+/g, ' ')
        .replace(/[.,;:!?]$/, '');
}

function validateMultipleAnswers(userAnswer, correctAnswers) {
    const answers = correctAnswers.split('|').map(ans => normalizeAnswer(ans));
    const normalizedUser = normalizeAnswer(userAnswer);
    
    // Special case for task 14 question 3 which accepts both "observational" and "observation"
    if (correctAnswers.includes('observational|observation')) {
        return normalizedUser === 'observational' || normalizedUser === 'observation';
    }
    
    return answers.some(ans => ans === normalizedUser);
}

function checkAll() { 
    // Check all input-based questions
    document.querySelectorAll('[data-type="input"]').forEach(el => { 
        const correctAnswers = el.dataset.ans;
        const userAnswer = el.value;
        
        el.classList.remove('correct', 'incorrect-marked'); 
        
        if(!userAnswer.trim()) {
            return;
        }
        
        if(validateMultipleAnswers(userAnswer, correctAnswers)) {
            el.classList.add('correct');
        } else {
            el.classList.add('incorrect-marked');
        }
    });
    
    // Check option-based questions
    ['t8', 't9', 't13'].forEach(taskId => {
        let data;
        if (taskId === 't8') data = t8_data;
        else if (taskId === 't9') data = t9_data;
        else data = t13_data;
        
        data.forEach((item, i) => {
            const qid = `${taskId}-q${i}`;
            const selectedOption = optionSelections.get(qid);
            const correctAnswer = item.ans;
            
            if (!selectedOption) {
                return;
            }
            
            const optionButtons = [];
            for (let j = 0; j < item.options.length; j++) {
                const btn = document.getElementById(`${qid}-opt${j}`);
                if (btn) optionButtons.push(btn);
            }
            
            optionButtons.forEach(btn => {
                btn.classList.remove('correct-option', 'incorrect-option');
            });
            
            const userSelectedBtn = optionButtons.find(btn => btn.textContent === selectedOption);
            if (userSelectedBtn) {
                if (selectedOption === correctAnswer) {
                    userSelectedBtn.classList.add('correct-option');
                } else {
                    userSelectedBtn.classList.add('incorrect-option');
                }
            }
        });
    });
    
    // Check reading questions
    t10_data.forEach((item, i) => {
        const qid = `t10-q${i}`;
        const userSelection = readingSelections.get(qid);
        const correctIndex = item.correct;
        
        const options = document.querySelectorAll(`#${qid}-container .mcq-option`);
        options.forEach((option, index) => {
            option.classList.remove('correct', 'incorrect', 'selected');
            
            if (userSelection !== undefined) {
                if (index === userSelection) {
                    if (userSelection === correctIndex) {
                        option.classList.add('correct');
                    } else {
                        option.classList.add('incorrect');
                    }
                }
            }
        });
    });
}

// Word bank functionality
function addWordBankEventListeners(id) {
    const wordItems = document.querySelectorAll(`#bank-${id} .word-item`);
    const inputs = document.querySelectorAll(`#questions-${id} input.word-input`);
    
    wordItems.forEach(item => {
        item.addEventListener('click', function() {
            selectWordFromBank(this.id);
        });
        
        item.addEventListener('dragstart', function(e) {
            dragWord(e);
        });
    });
    
    inputs.forEach(input => {
        input.addEventListener('dragover', function(e) {
            allowDrop(e);
        });
        
        input.addEventListener('drop', function(e) {
            dropWord(e, this.id);
        });
    });
}

function dragWord(event) {
    event.dataTransfer.setData("text/plain", event.target.dataset.word);
    event.dataTransfer.setData("wordId", event.target.id);
}

function allowDrop(event) {
    event.preventDefault();
}

function dropWord(event, inputId) {
    event.preventDefault();
    const word = event.dataTransfer.getData("text/plain");
    const wordId = event.dataTransfer.getData("wordId");
    
    const input = document.getElementById(inputId);
    if (input) {
        input.value = word;
        adjustWidth(input);
        
        const taskId = wordId.split('-')[1];
        updateWordBankUsage(word, `t${taskId}`);
    }
}

function selectWordFromBank(wordId) {
    const wordItem = document.getElementById(wordId);
    if (!wordItem || wordItem.classList.contains('used')) return;
    
    const word = wordItem.dataset.word;
    const taskId = wordId.split('-')[1];
    
    const inputs = document.querySelectorAll(`#questions-t${taskId} input.word-input`);
    let emptyInput = null;
    
    for (const input of inputs) {
        if (!input.value.trim()) {
            emptyInput = input;
            break;
        }
    }
    
    if (emptyInput) {
        emptyInput.value = word;
        adjustWidth(emptyInput);
        
        updateWordBankUsage(word, `t${taskId}`);
    } else {
        alert('All gaps are filled. You can click on a gap to replace its content.');
    }
}

function updateWordBankUsage(word, taskId) {
    if (!wordUsageCount[taskId]) {
        wordUsageCount[taskId] = {};
    }
    
    if (!wordUsageCount[taskId][word]) {
        wordUsageCount[taskId][word] = 0;
    }
    
    const inputs = document.querySelectorAll(`#questions-${taskId} input.word-input`);
    let count = 0;
    
    inputs.forEach(input => {
        if (normalizeAnswer(input.value) === normalizeAnswer(word)) {
            count++;
        }
    });
    
    wordUsageCount[taskId][word] = count;
    
    updateWordBankDisplay(taskId);
}

function updateWordBankDisplay(taskId) {
    const wordItems = document.querySelectorAll(`#bank-${taskId} .word-item`);
    
    wordItems.forEach(item => {
        const word = item.dataset.word;
        const count = wordUsageCount[taskId][word] || 0;
        
        if (count > 0) {
            item.classList.add('used');
        } else {
            item.classList.remove('used');
        }
    });
}

function updateWordBank(taskId) {
    const inputs = document.querySelectorAll(`#questions-${taskId} input.word-input`);
    
    if (wordUsageCount[taskId]) {
        Object.keys(wordUsageCount[taskId]).forEach(word => {
            wordUsageCount[taskId][word] = 0;
        });
    }
    
    inputs.forEach(input => {
        const word = input.value.trim().toLowerCase();
        if (word) {
            if (wordUsageCount[taskId][word] !== undefined) {
                wordUsageCount[taskId][word]++;
            }
        }
    });
    
    updateWordBankDisplay(taskId);
}

// Reading panel resizer
function initializeResizer() {
    const resizer = document.getElementById('resizer-t10');
    const leftPanel = document.getElementById('text-panel-t10');
    const rightPanel = document.getElementById('questions-panel-t10');
    
    if (!resizer || !leftPanel || !rightPanel) return;
    
    // Set initial widths (50% each)
    leftPanel.style.width = '50%';
    rightPanel.style.flex = '1';
    
    let isResizing = false;
    let startX = 0;
    let startLeftWidth = 0;
    let startRightWidth = 0;
    
    resizer.addEventListener('mousedown', function(e) {
        isResizing = true;
        startX = e.clientX;
        startLeftWidth = leftPanel.offsetWidth;
        startRightWidth = rightPanel.offsetWidth;
        
        document.body.style.cursor = 'col-resize';
        document.body.style.userSelect = 'none';
        
        document.addEventListener('mousemove', handleMouseMove);
        document.addEventListener('mouseup', handleMouseUp);
    });
    
    function handleMouseMove(e) {
        if (!isResizing) return;
        
        const dx = e.clientX - startX;
        const newLeftWidth = startLeftWidth + dx;
        
        const containerWidth = leftPanel.parentElement.offsetWidth;
        const minWidth = 200;
        const maxWidth = containerWidth - minWidth - resizer.offsetWidth;
        
        if (newLeftWidth >= minWidth && newLeftWidth <= maxWidth) {
            leftPanel.style.width = newLeftWidth + 'px';
            rightPanel.style.flex = '1';
        }
    }
    
    function handleMouseUp() {
        isResizing = false;
        document.body.style.cursor = '';
        document.body.style.userSelect = '';
        
        document.removeEventListener('mousemove', handleMouseMove);
        document.removeEventListener('mouseup', handleMouseUp);
    }
}

// Text highlighting functionality
function initializeTextHighlighting() {
    contextMenu = document.getElementById('context-menu');
    const highlightBtn = document.getElementById('highlight-text');
    const removeHighlightBtn = document.getElementById('remove-highlight');
    const clearHighlightsBtn = document.getElementById('clear-highlights');
    
    // Context menu for text highlighting
    document.addEventListener('contextmenu', function(e) {
        const selection = window.getSelection();
        if (selection.toString().trim() && 
            (e.target.closest('.reading-text') || e.target.closest('.text-panel'))) {
            selectedTextRange = saveSelection();
            
            contextMenu.style.display = 'block';
            contextMenu.style.left = e.pageX + 'px';
            contextMenu.style.top = e.pageY + 'px';
            
            e.preventDefault();
        } else {
            contextMenu.style.display = 'none';
        }
    });
    
    // Hide context menu when clicking elsewhere
    document.addEventListener('click', function(e) {
        if (contextMenu && !contextMenu.contains(e.target)) {
            contextMenu.style.display = 'none';
        }
    });
    
    // Highlight selected text
    if (highlightBtn) {
        highlightBtn.addEventListener('click', function() {
            if (selectedTextRange) {
                highlightSelection(selectedTextRange);
                contextMenu.style.display = 'none';
            }
        });
    }
    
    // Remove highlight from selected text
    if (removeHighlightBtn) {
        removeHighlightBtn.addEventListener('click', function() {
            if (selectedTextRange) {
                removeHighlightFromSelection(selectedTextRange);
                contextMenu.style.display = 'none';
            }
        });
    }
    
    // Clear all highlights
    if (clearHighlightsBtn) {
        clearHighlightsBtn.addEventListener('click', function() {
            clearAllHighlights();
            contextMenu.style.display = 'none';
        });
    }
}

function saveSelection() {
    const selection = window.getSelection();
    if (selection.rangeCount === 0) return null;
    
    return selection.getRangeAt(0).cloneRange();
}

function highlightSelection(range) {
    if (!range) return;
    
    const span = document.createElement('span');
    span.className = 'highlighted-text';
    
    try {
        range.surroundContents(span);
    } catch(e) {
        // If the range selects partially across nodes, we need a different approach
        const div = document.createElement('div');
        div.innerHTML = range.toString();
        span.innerHTML = div.innerHTML;
        range.deleteContents();
        range.insertNode(span);
    }
    
    const selection = window.getSelection();
    selection.removeAllRanges();
}

function removeHighlightFromSelection(range) {
    if (!range) return;
    
    const parent = range.commonAncestorContainer;
    const highlightSpans = parent.parentElement.querySelectorAll('.highlighted-text');
    
    highlightSpans.forEach(span => {
        if (range.intersectsNode(span)) {
            const parent = span.parentNode;
            while (span.firstChild) {
                parent.insertBefore(span.firstChild, span);
            }
            parent.removeChild(span);
        }
    });
    
    const selection = window.getSelection();
    selection.removeAllRanges();
}

function clearAllHighlights() {
    const highlights = document.querySelectorAll('.highlighted-text');
    highlights.forEach(highlight => {
        const parent = highlight.parentNode;
        while (highlight.firstChild) {
            parent.insertBefore(highlight.firstChild, highlight);
        }
        parent.removeChild(highlight);
    });
}

// Initialize everything when page loads
window.onload = () => {
    renderTask1();
    renderTask2();
    renderTask3();
    renderTask4();
    renderTask5();
    renderTask6();
    renderTask7();
    renderTask8();
    renderTask9();
    renderTask10();
    renderTask12();
    renderTask13();
    renderTask14();
    initializeResizer();
    initializeTextHighlighting();
};

// Check all answers with Enter key
document.addEventListener('keydown', e => { 
    if(e.key === 'Enter') {
        checkAll(); 
    }
});
</script>
</body>
</html>