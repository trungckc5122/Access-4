<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Access 4 - Review Final (Unit 3-5)</title>
    <style>
        :root {
            --primary: #2980b9; 
            --primary-dark: #1c5982; 
            --success: #27ae60;
            --error: #e74c3c; 
            --warning: #f1c40f; 
            --bg: #f4f7f9;
            --text: #2c3e50; 
            --card: #ffffff;
            --selection: #3498db;
            --selection-bg: #ebf5fb;
            --grammar-bg: #f0f7ff;
            --vocab-bg: #f9f7ff;
        }
        
        body { 
            font-family: 'Times New Roman', serif; 
            font-size: 13pt; 
            background-color: var(--bg); 
            color: var(--text); 
            margin: 0; 
            padding: 20px 20px 150px 20px;
            line-height: 1.6; 
        }
        
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
        }
        
        .main-title {
            text-align: center;
            color: var(--primary-dark);
            margin-bottom: 30px;
            font-size: 2em;
            padding-bottom: 15px;
            border-bottom: 3px solid var(--primary);
        }
        
        .reference-section {
            background-color: var(--grammar-bg);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            border-left: 6px solid var(--primary);
        }
        
        .reference-title {
            font-weight: bold;
            font-size: 1.4em;
            margin-bottom: 20px;
            color: var(--primary-dark);
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
        }
        
        /* ƒê√É X√ìA: .reference-title::before { content: "üìö"; } */
        
        .expand-toggle {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 4px 12px;
            cursor: pointer;
            font-size: 0.8em;
        }
        
        .grammar-group {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid #e1e8ed;
            transition: all 0.3s ease;
            overflow: hidden;
        }
        
        .grammar-group.collapsed {
            max-height: 60px;
            overflow: hidden;
        }
        
        .grammar-group.expanded {
            max-height: 1000px;
        }
        
        .grammar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            cursor: pointer;
        }
        
        .grammar-subtitle {
            font-weight: bold;
            font-size: 1.2em;
            color: var(--primary);
            margin: 0;
        }
        
        .group-toggle {
            background: none;
            border: none;
            font-size: 1.2em;
            cursor: pointer;
            color: var(--primary);
        }
        
        .grammar-list {
            margin-left: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }
        
        .grammar-list li {
            margin-bottom: 8px;
            line-height: 1.5;
        }
        
        .grammar-details {
            padding-left: 20px;
            border-left: 2px solid #e1e8ed;
            margin: 10px 0;
            transition: all 0.3s ease;
        }
        
        .grammar-group.collapsed .grammar-details {
            opacity: 0;
            height: 0;
            overflow: hidden;
            margin: 0;
            padding: 0;
        }
        
        .grammar-group.expanded .grammar-details {
            opacity: 1;
            height: auto;
        }
        
        .detail-item {
            margin-bottom: 8px;
            padding: 5px 0;
        }
        
        .detail-title {
            font-weight: bold;
            color: var(--primary-dark);
        }
        
        .vocab-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            background-color: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .vocab-table th {
            background-color: var(--primary);
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: bold;
        }
        
        .vocab-table td {
            padding: 10px 12px;
            border-bottom: 1px solid #eee;
        }
        
        .vocab-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        .phonetic {
            font-family: 'Arial', sans-serif;
            color: #666;
            font-size: 0.9em;
        }
        
        .meaning {
            color: #2c3e50;
        }
        
        .topic-title {
            background-color: var(--vocab-bg);
            padding: 12px 15px;
            border-radius: 8px;
            margin: 20px 0 15px 0;
            font-weight: bold;
            color: var(--primary-dark);
            border-left: 4px solid #9b59b6;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }
        
        .topic-content {
            transition: all 0.3s ease;
            overflow: hidden;
        }
        
        .topic-content.collapsed {
            max-height: 0;
            opacity: 0;
            overflow: hidden;
        }
        
        .topic-content.expanded {
            max-height: 1000px;
            opacity: 1;
        }
        
        .sticky-bank { 
            position: sticky; 
            top: 15px; 
            z-index: 100;
            background-color: #fff; 
            padding: 15px; 
            border-radius: 10px; 
            margin-bottom: 25px; 
            border: 2px solid var(--primary); 
            display: flex; 
            flex-wrap: wrap; 
            gap: 10px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }
        
        .word-item { 
            background: #eef2f7; 
            border: 1px solid var(--primary); 
            color: var(--primary-dark); 
            padding: 6px 12px; 
            border-radius: 5px; 
            cursor: grab; 
            user-select: none; 
            transition: 0.2s; 
            font-size: 0.9em; 
            font-weight: 500;
        }
        
        .word-item.used { 
            display: none !important; /* Thay ƒë·ªïi: ·∫©n ho√†n to√†n t·ª´ ƒë√£ d√πng */
        }
        
        .word-item:hover:not(.used) { 
            background: var(--primary); 
            color: white; 
        }

        .exercise-card { 
            background: var(--card); 
            border-radius: 12px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); 
            padding: 25px; 
            margin-bottom: 30px; 
        }
        
        .exercise-title { 
            font-weight: bold; 
            font-size: 1.25em; 
            margin-bottom: 18px; 
            color: var(--primary-dark); 
            border-bottom: 2px solid #eee; 
            padding-bottom: 8px; 
        }
        
        .matching-grid { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 30px; 
            margin-top: 10px; 
        }
        
        .vocab-item { 
            margin-bottom: 12px; 
            display: flex; 
            align-items: center; 
            gap: 10px; 
        }
        
        .vocab-text { 
            min-width: 150px; 
            font-weight: 500; 
        }
        
        .question-row { 
            margin-bottom: 18px; 
            line-height: 2.2; 
            border-bottom: 1px solid #f9f9f9; 
            padding-bottom: 10px; 
            position: relative; 
        }
        
        input[type="text"] { 
            border: none; 
            border-bottom: 2px solid #bdc3c7; 
            background: #fafafa; 
            padding: 2px 8px; 
            font-size: 1em; 
            transition: 0.2s; 
            outline: none;
            min-width: 60px; 
            border-radius: 4px 4px 0 0; 
            text-align: center; 
            font-family: 'Times New Roman';
            box-sizing: border-box;
        }
        
        input.letter-input { 
            width: 45px; 
            min-width: 45px; 
            max-width: 80px;
            text-transform: uppercase; 
            font-weight: bold; 
            color: var(--primary-dark); 
        }
        
        input.word-input { 
            min-width: 120px; 
            max-width: 400px;
            text-align: left; 
        }
        
        input.correct { 
            border-bottom-color: var(--success) !important; 
            background-color: #e8f8f5 !important; 
            color: #1e8449 !important; 
        }
        
        input.incorrect-marked { 
            border-bottom-color: var(--error) !important; 
            background-color: #fdedec !important; 
        }

        .row-btns { 
            display: inline-flex; 
            gap: 5px; 
            vertical-align: middle; 
            margin-left: 10px; 
        }
        
        .btn-small { 
            background: #eee; 
            border: 1px solid #ccc; 
            border-radius: 4px; 
            width: 28px; 
            height: 28px; 
            cursor: pointer; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 14px; 
            transition: 0.2s;
        }
        
        .btn-small:hover {
            background: #ddd;
        }
        
        .btn-small.active {
            background: #3498db;
            color: white;
            border-color: #2980b9;
        }
        
        .info-btn { 
            background: #95a5a6; 
            color: white; 
            border: none; 
            border-radius: 50%; 
            width: 20px; 
            height: 20px; 
            font-size: 11px; 
            cursor: pointer; 
            display: inline-flex; 
            align-items: center; 
            justify-content: center; 
            transition: 0.2s;
        }
        
        .info-btn:hover {
            background: #7f8c8d;
        }
        
        .info-btn.active {
            background: #5d6d6e;
        }
        
        .hint-box { 
            display: none; 
            margin-top: 8px; 
            padding: 10px; 
            background-color: #fef9e7; 
            border-left: 4px solid var(--warning); 
            color: #7d6608; 
            border-radius: 4px; 
            font-size: 0.85em; 
        }
        
        .controls-row { 
            display: flex; 
            justify-content: flex-end; 
            gap: 10px; 
            margin-top: 15px; 
        }
        
        .btn { 
            padding: 8px 20px; 
            border-radius: 6px; 
            cursor: pointer; 
            border: none; 
            font-weight: bold; 
            transition: 0.3s; 
        }
        
        .btn-reset { 
            background: #95a5a6; 
            color: white; 
        }
        
        .btn-show-all { 
            background: var(--primary); 
            color: white; 
        }
        
        .check-all-btn { 
            position: fixed; 
            right: 45px;
            bottom: 30px; 
            background-color: var(--success); 
            color: white; 
            padding: 15px 30px; 
            border-radius: 50px; 
            cursor: pointer; 
            z-index: 10000;
            font-weight: bold; 
            border: none; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.2); 
        }
        
        .instructions {
            color: #7f8c8d;
            font-size: 0.95em;
            margin-bottom: 15px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        
        .option-container {
            display: inline-flex;
            gap: 10px;
            margin-left: 10px;
            margin-right: 10px;
            flex-wrap: wrap;
        }
        
        .option-btn {
            background: #eef2f7;
            border: 2px solid #bdc3c7;
            border-radius: 6px;
            padding: 6px 15px;
            cursor: pointer;
            font-weight: 500;
            transition: 0.2s;
            min-width: 80px;
            text-align: center;
            font-size: 0.9em;
        }
        
        .option-btn:hover {
            background: #dfe6f0;
            border-color: #95a5a6;
        }
        
        .option-btn.selected {
            background: #3498db;
            color: white;
            border-color: #2980b9;
        }
        
        .option-btn.correct-option {
            background: #27ae60;
            color: white;
            border-color: #219653;
        }
        
        .option-btn.incorrect-option {
            background: #e74c3c;
            color: white;
            border-color: #c0392b;
        }
        
        .bold-option {
            font-weight: bold;
            color: var(--primary-dark);
        }
        
        .reading-container {
            display: flex;
            margin: 20px 0;
            position: relative;
            min-height: 500px;
            height: 600px;
        }
        
        .text-panel, .questions-panel {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            border: 1px solid #e9ecef;
            overflow-y: auto;
            position: relative;
            height: 100%;
            flex: 1;
        }
        
        .text-panel {
            margin-right: 0;
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
        }
        
        .questions-panel {
            margin-left: 0;
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
        }
        
        .text-panel h3, .questions-panel h3 {
            margin-top: 0;
            color: var(--primary-dark);
            text-align: center;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        
        .reading-text {
            line-height: 1.8;
            text-align: justify;
            user-select: text;
        }
        
        .mcq-question {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .mcq-question p {
            margin-bottom: 12px;
            font-weight: 500;
            font-size: 1.05em;
        }
        
        .mcq-options-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .mcq-option {
            margin-bottom: 8px;
            padding: 8px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            background-color: #f9f9f9;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
        }
        
        .mcq-option:hover {
            background-color: #f0f0f0;
            border-color: #bdc3c7;
        }
        
        .mcq-option.selected {
            background-color: #e3f2fd;
            border-color: #3498db;
        }
        
        .mcq-option.correct {
            background-color: #d4edda;
            border-color: #27ae60;
            color: #155724;
        }
        
        .mcq-option.incorrect {
            background-color: #f8d7da;
            border-color: #e74c3c;
            color: #721c24;
        }
        
        .mcq-option input {
            margin-right: 10px;
        }
        
        .option-letter {
            display: inline-block;
            width: 24px;
            height: 24px;
            line-height: 24px;
            text-align: center;
            background-color: #3498db;
            color: white;
            border-radius: 50%;
            margin-right: 10px;
            font-weight: bold;
        }
        
        .resizer {
            position: relative;
            width: 10px;
            background-color: #ddd;
            cursor: col-resize;
            z-index: 10;
            flex-shrink: 0;
            margin: 0;
        }
        
        .resizer:hover {
            background-color: #3498db;
        }
        
        .resizer::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 2px;
            height: 40px;
            background-color: #95a5a6;
            border-radius: 1px;
        }
        
        .definitions-column {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            height: 500px;
            overflow-y: auto;
        }
        
        .definition-item {
            margin-bottom: 12px;
            padding: 8px;
            border-bottom: 1px solid #eee;
            background-color: white;
            border-radius: 4px;
            min-height: 40px;
        }
        
        .definition-letter {
            font-weight: bold;
            color: var(--primary);
            margin-right: 10px;
            min-width: 20px;
            display: inline-block;
        }
        
        .definition-text {
            display: inline;
        }
        
        @media (max-width: 768px) {
            .check-all-btn {
                right: 15px;
                bottom: 20px;
                padding: 12px 20px;
                font-size: 0.9em;
            }
            
            body {
                padding: 15px 15px 120px 15px;
            }
            
            .mcq-options-container {
                grid-template-columns: 1fr;
            }
            
            .reading-container {
                flex-direction: column;
                height: 800px;
            }
            
            .text-panel, .questions-panel {
                width: 100% !important;
                height: 50% !important;
                margin: 0;
                border-radius: 10px;
                margin-bottom: 10px;
            }
            
            .resizer {
                display: none;
            }
            
            .vocab-table {
                display: block;
                overflow-x: auto;
            }
            
            .matching-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }
    </style>
</head>
<body>

<div class="container">
    <h1 class="main-title">Access 4 - Review Final (Unit 3-5)</h1>
    
    <!-- Reference Section -->
    <div class="reference-section">
        <div class="reference-title" onclick="toggleReferenceSection()">
            Grammar & Vocabulary Reference
            <button class="expand-toggle" id="reference-toggle">+</button>
        </div>
        
        <div id="reference-content">
            <div class="grammar-group collapsed" id="grammar-present-perfect">
                <div class="grammar-header" onclick="toggleGrammar('present-perfect')">
                    <h3 class="grammar-subtitle">Present Perfect vs. Past Simple</h3>
                    <button class="group-toggle">+</button>
                </div>
                <div class="grammar-details">
                    <div class="detail-item">
                        <div class="detail-title">Present Perfect</div>
                        <div>Used to talk about completed actions at an unspecified time or with relevance to the present.</div>
                        <div><strong>Form:</strong> have/has + past participle</div>
                        <div><strong>Examples:</strong> I have visited Paris. She has finished her homework.</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-title">Past Simple</div>
                        <div>Used to talk about completed actions at a specific time in the past.</div>
                        <div><strong>Form:</strong> verb + ed (regular) or irregular form</div>
                        <div><strong>Examples:</strong> I visited Paris last year. She finished her homework yesterday.</div>
                    </div>
                </div>
                <div class="reference-note">Source: British Council LearnEnglish</div>
            </div>
            
            <div class="grammar-group collapsed" id="grammar-past-perfect">
                <div class="grammar-header" onclick="toggleGrammar('past-perfect')">
                    <h3 class="grammar-subtitle">Past Perfect & Past Perfect Continuous</h3>
                    <button class="group-toggle">+</button>
                </div>
                <div class="grammar-details">
                    <div class="detail-item">
                        <div class="detail-title">Past Perfect</div>
                        <div>Used to show an action happened before another past action.</div>
                        <div><strong>Form:</strong> had + past participle</div>
                        <div><strong>Example:</strong> She had finished her work before I arrived.</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-title">Past Perfect Continuous</div>
                        <div>Used to show an action was ongoing before another past action.</div>
                        <div><strong>Form:</strong> had been + verb-ing</div>
                        <div><strong>Example:</strong> She had been working for hours when I called.</div>
                    </div>
                </div>
                <div class="reference-note">Source: Oxford Learner's Dictionary</div>
            </div>
            
            <div class="grammar-group collapsed" id="grammar-quantifiers">
                <div class="grammar-header" onclick="toggleGrammar('quantifiers')">
                    <h3 class="grammar-subtitle">Quantifiers (much/many/a lot of/any/some)</h3>
                    <button class="group-toggle">+</button>
                </div>
                <div class="grammar-details">
                    <div class="detail-item">
                        <div class="detail-title">Countable nouns</div>
                        <div>Use <strong>many</strong> (questions/negatives), <strong>a lot of</strong> (affirmatives)</div>
                        <div><strong>Examples:</strong> many books, a lot of students</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-title">Uncountable nouns</div>
                        <div>Use <strong>much</strong> (questions/negatives), <strong>a lot of</strong> (affirmatives)</div>
                        <div><strong>Examples:</strong> much water, a lot of information</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-title">Some & Any</div>
                        <div><strong>Some:</strong> affirmative sentences, offers, requests</div>
                        <div><strong>Any:</strong> questions and negative sentences</div>
                    </div>
                </div>
                <div class="reference-note">Source: British Council</div>
            </div>
            
            <div class="grammar-group collapsed" id="grammar-phrasal">
                <div class="grammar-header" onclick="toggleGrammar('phrasal')">
                    <h3 class="grammar-subtitle">Phrasal Verbs</h3>
                    <button class="group-toggle">+</button>
                </div>
                <div class="grammar-details">
                    <div class="detail-item">
                        <div class="detail-title">put on</div>
                        <div>To wear clothing</div>
                        <div><strong>Example:</strong> Put on your coat.</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-title">put off</div>
                        <div>To postpone or delay</div>
                        <div><strong>Example:</strong> Don't put off your homework.</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-title">put up with</div>
                        <div>To tolerate</div>
                        <div><strong>Example:</strong> I can't put up with this noise.</div>
                    </div>
                </div>
                <div class="reference-note">Source: Oxford Learner's Dictionary</div>
            </div>
            
            <div class="grammar-group collapsed" id="grammar-been-gone">
                <div class="grammar-header" onclick="toggleGrammar('been-gone')">
                    <h3 class="grammar-subtitle">Been vs. Gone</h3>
                    <button class="group-toggle">+</button>
                </div>
                <div class="grammar-details">
                    <div class="detail-item">
                        <div class="detail-title">Been</div>
                        <div>Visited and returned</div>
                        <div><strong>Example:</strong> She has been to Paris. (She went and came back)</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-title">Gone</div>
                        <div>Went and is still there</div>
                        <div><strong>Example:</strong> She has gone to Paris. (She is still in Paris)</div>
                    </div>
                </div>
                <div class="reference-note">Source: British Council</div>
            </div>
            
            <div class="topic-title" onclick="toggleTopic('health')">
                Vocabulary: Health & Allergies
                <span class="group-toggle">+</span>
            </div>
            <div class="topic-content collapsed" id="topic-health">
                <table class="vocab-table">
                    <thead>
                        <tr>
                            <th>Vocabulary</th>
                            <th>Phonetic (IDP)</th>
                            <th>Vietnamese Meaning</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>a runny nose</td>
                            <td class="phonetic">/…ô Ààr åni n…ô äz/</td>
                            <td class="meaning">ch·∫£y n∆∞·ªõc m≈©i</td>
                        </tr>
                        <tr>
                            <td>swollen lips</td>
                            <td class="phonetic">/Ààsw…ô äl…ôn l…™ps/</td>
                            <td class="meaning">m√¥i s∆∞ng</td>
                        </tr>
                        <tr>
                            <td>itchy skin</td>
                            <td class="phonetic">/Àà…™t Éi sk…™n/</td>
                            <td class="meaning">da ng·ª©a</td>
                        </tr>
                        <tr>
                            <td>a rash</td>
                            <td class="phonetic">/…ô r√¶ É/</td>
                            <td class="meaning">ph√°t ban</td>
                        </tr>
                        <tr>
                            <td>allergic to</td>
                            <td class="phonetic">/…ôÀàl…úÀêd í…™k t…ô/</td>
                            <td class="meaning">d·ªã ·ª©ng v·ªõi</td>
                        </tr>
                        <tr>
                            <td>immune system</td>
                            <td class="phonetic">/…™ÀàmjuÀên Ààs…™st…ôm/</td>
                            <td class="meaning">h·ªá mi·ªÖn d·ªãch</td>
                        </tr>
                        <tr>
                            <td>medicine</td>
                            <td class="phonetic">/Ààmed…ôs…ôn/</td>
                            <td class="meaning">thu·ªëc</td>
                        </tr>
                        <tr>
                            <td>check the labels</td>
                            <td class="phonetic">/t Éek √∞…ô Ààle…™b…ôlz/</td>
                            <td class="meaning">ki·ªÉm tra nh√£n m√°c</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div class="topic-title" onclick="toggleTopic('animals')">
                Vocabulary: Animals & Nature
                <span class="group-toggle">+</span>
            </div>
            <div class="topic-content collapsed" id="topic-animals">
                <table class="vocab-table">
                    <thead>
                        <tr>
                            <th>Vocabulary</th>
                            <th>Phonetic (IDP)</th>
                            <th>Vietnamese Meaning</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>mammals</td>
                            <td class="phonetic">/Ààm√¶m…ôlz/</td>
                            <td class="meaning">ƒë·ªông v·∫≠t c√≥ v√∫</td>
                        </tr>
                        <tr>
                            <td>reptiles</td>
                            <td class="phonetic">/Ààrepta…™lz/</td>
                            <td class="meaning">b√≤ s√°t</td>
                        </tr>
                        <tr>
                            <td>fur</td>
                            <td class="phonetic">/f…úÀê(r)/</td>
                            <td class="meaning">l√¥ng (th√∫)</td>
                        </tr>
                        <tr>
                            <td>tail</td>
                            <td class="phonetic">/te…™l/</td>
                            <td class="meaning">ƒëu√¥i</td>
                        </tr>
                        <tr>
                            <td>sting</td>
                            <td class="phonetic">/st…™≈ã/</td>
                            <td class="meaning">v·∫øt ƒë·ªët/ch√≠ch</td>
                        </tr>
                        <tr>
                            <td>blend in with</td>
                            <td class="phonetic">/blend …™n w…™√∞/</td>
                            <td class="meaning">h√≤a l·∫´n v·ªõi</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div class="topic-title" onclick="toggleTopic('daily')">
                Vocabulary: Daily Life & Habits
                <span class="group-toggle">+</span>
            </div>
            <div class="topic-content collapsed" id="topic-daily">
                <table class="vocab-table">
                    <thead>
                        <tr>
                            <th>Vocabulary</th>
                            <th>Phonetic (IDP)</th>
                            <th>Vietnamese Meaning</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>picky eater</td>
                            <td class="phonetic">/Ààp…™ki ÀàiÀêt…ô(r)/</td>
                            <td class="meaning">ng∆∞·ªùi k√©n ƒÉn</td>
                        </tr>
                        <tr>
                            <td>spending habits</td>
                            <td class="phonetic">/Ààspend…™≈ã Ààh√¶b…™ts/</td>
                            <td class="meaning">th√≥i quen chi ti√™u</td>
                        </tr>
                        <tr>
                            <td>packed lunch</td>
                            <td class="phonetic">/p√¶kt l ånt É/</td>
                            <td class="meaning">c∆°m h·ªôp mang ƒëi</td>
                        </tr>
                        <tr>
                            <td>nursery school</td>
                            <td class="phonetic">/Ààn…úÀês…ôri skuÀêl/</td>
                            <td class="meaning">tr∆∞·ªùng m·∫´u gi√°o</td>
                        </tr>
                        <tr>
                            <td>reasonable prices</td>
                            <td class="phonetic">/ÀàriÀêzn…ôbl Ààpra…™s…™z/</td>
                            <td class="meaning">gi√° c·∫£ h·ª£p l√Ω</td>
                        </tr>
                        <tr>
                            <td>established regulations</td>
                            <td class="phonetic">/…™Ààst√¶bl…™ Ét Àåre…°juÀàle…™ É…ônz/</td>
                            <td class="meaning">quy ƒë·ªãnh ƒë√£ ƒë∆∞·ª£c thi·∫øt l·∫≠p</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <!-- Task 1: Vocabulary Matching -->
    <div class="exercise-card">
        <div class="exercise-title">Task 1: Vocabulary Matching ‚Äì Match the word to its definition</div>
        
        <div class="instructions">Match each word from the vocabulary list with its correct definition.</div>
        
        <div class="matching-grid">
            <div id="vocab-t1"></div>
            <div class="definitions-column">
                <div id="def-t1"></div>
            </div>
        </div>
        <div class="controls-row">
            <button class="btn btn-show-all" onclick="showAnswers('t1')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('t1')">Reset</button>
        </div>
    </div>
    
    <!-- Task 2: Filling in the gaps -->
    <div class="exercise-card">
        <div class="exercise-title">Task 2: Filling in the gaps</div>
        
        <div class="instructions">Complete the sentences using words from the word bank.</div>
        
        <div class="sticky-bank" id="bank-t2"></div>
        
        <div id="questions-t2"></div>
        <div class="controls-row">
            <button class="btn btn-show-all" onclick="showAnswers('t2')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('t2')">Reset</button>
        </div>
    </div>
    
    <!-- Task 3: Underline the correct word/phrase -->
    <div class="exercise-card">
        <div class="exercise-title">Task 3: Underline the correct word/phrase</div>
        
        <div class="instructions">Choose the correct word or phrase to complete each sentence.</div>
        
        <div id="questions-t3"></div>
        <div class="controls-row">
            <button class="btn btn-show-all" onclick="showAnswers('t3')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('t3')">Reset</button>
        </div>
    </div>
    
    <!-- Task 4: Fill in the blanks -->
    <div class="exercise-card">
        <div class="exercise-title">Task 4: Fill in the blanks with the correct word/phrase</div>
        
        <div class="instructions">Complete the sentences using words from the word bank. There are three extra words you do not need to use.</div>
        
        <div class="sticky-bank" id="bank-t4"></div>
        
        <div id="questions-t4"></div>
        <div class="controls-row">
            <button class="btn btn-show-all" onclick="showAnswers('t4')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('t4')">Reset</button>
        </div>
    </div>
    
    <!-- Task 5: Fill in the missing phrase -->
    <div class="exercise-card">
        <div class="exercise-title">Task 5: Fill in the missing phrase</div>
        
        <div class="instructions">Complete the sentences using phrases from the word bank. There is one answer you do not need to use.</div>
        
        <div class="sticky-bank" id="bank-t5"></div>
        
        <div id="questions-t5"></div>
        <div class="controls-row">
            <button class="btn btn-show-all" onclick="showAnswers('t5')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('t5')">Reset</button>
        </div>
    </div>
    
    <!-- Task 6: Choose the correct word (been / gone) -->
    <div class="exercise-card">
        <div class="exercise-title">Task 6: Choose the correct word (been / gone)</div>
        
        <div class="instructions">Choose between "been" and "gone" to complete each conversation.</div>
        
        <div id="questions-t6"></div>
        <div class="controls-row">
            <button class="btn btn-show-all" onclick="showAnswers('t6')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('t6')">Reset</button>
        </div>
    </div>
    
    <!-- Task 7: Past Perfect or Past Perfect Progressive -->
    <div class="exercise-card">
        <div class="exercise-title">Task 7: Put the verbs in brackets into the correct form. Past Perfect or Past Perfect Progressive</div>
        
        <div class="instructions">Complete the sentences using the correct form of the verb in brackets.</div>
        
        <div id="questions-t7"></div>
        <div class="controls-row">
            <button class="btn btn-show-all" onclick="showAnswers('t7')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('t7')">Reset</button>
        </div>
    </div>
    
    <!-- Task 8: Underline the correct item -->
    <div class="exercise-card">
        <div class="exercise-title">Task 8: Underline the correct item</div>
        
        <div class="instructions">Choose the correct word or phrase to complete each sentence.</div>
        
        <div id="questions-t8"></div>
        <div class="controls-row">
            <button class="btn btn-show-all" onclick="showAnswers('t8')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('t8')">Reset</button>
        </div>
    </div>
    
    <!-- Task 9: Reading Comprehension -->
    <div class="exercise-card">
        <div class="exercise-title">Task 9: Reading Comprehension - Cyclist Vicky Harmiston</div>
        
        <div class="instructions">Read the text and answer the questions below.</div>
        
        <div class="reading-container" id="reading-t9">
            <div class="text-panel" id="text-panel-t9">
                <h3>Cyclist Vicky Harmiston</h3>
                <div class="reading-text" id="reading-text-t9">
                    <p><em>Reporter Mark Lewis writes about Vicky Harmiston, who has had a successful career as a track cyclist ‚Äì a cyclist who races on special race tracks.</em></p>
                    
                    <p>When Vicky Harmiston was a child, her parents gave her and her brother Jamie the freedom to decide what they did in their spare time. Vicky chose to do lots of different sports. She was a good swimmer, and the coach at the swimming club she went to thought she might be good enough to become a champion. But the club was a long way from her home so it was difficult for her to fit in the training around her schoolwork. When they were teenagers, Jamie, who loved cycling, bought himself a special track-racing bike and started taking part in competitions. Vicky thought it looked very exciting and decided to try it for herself. She says that was the best decision she ever made. Soon she was cycling every day and doing really well. The track was near her school, which meant it was no problem for her to attend training sessions after school every day.</p>
                    
                    <p>Vicky went on to have a successful career in track cycling and won several competitions. Then, when she was 28, she retired from competitive cycling. Vicky told me: 'For years I'd loved winning competitions but I began to get a bit tired of the whole thing ‚Äì and when the excitement stops, there's no point. Luckily, I went on to have a new career.'</p>
                    
                    <p>Vicky got a job with a charity called CycleZone. 'We work with young people who have never enjoyed sport,' she says. 'The first thing we do is teach them to ride a bike. We want them to learn to believe in themselves and their own abilities. CycleZone does a great job, and it gets young people together so they're part of a wider group.'</p>
                    
                    <p>The charity uses celebrities to advertise the work they do. Vicky says, 'I know some people aren't sure whether the support of a celebrity is always positive for a charity. They say the celebrities are only doing it to push themselves forward, which prevents the public from seeing the real work of the charity. But if famous singers and actors, for example, can help, I think they should.'</p>
                </div>
            </div>
            
            <div class="resizer" id="resizer-t9"></div>
            
            <div class="questions-panel" id="questions-panel-t9">
                <h3>Questions</h3>
                <div id="reading-questions-t9"></div>
            </div>
        </div>
        
        <div class="controls-row" style="margin-top: 40px !important; display: block !important; clear: both !important; position: relative !important; z-index: 1000; background: #f8f9fa; padding: 20px; border-radius: 8px; border: 1px solid #e9ecef;">
            <button class="btn btn-show-all" onclick="showAnswers('t9')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('t9')">Reset</button>
        </div>
    </div>
</div>

<button class="check-all-btn" onclick="checkAll()">CHECK ALL ANSWERS (ENTER)</button>

<script>
// Data for Task 1: Vocabulary Matching (d·∫°ng 2 c·ªôt nh∆∞ trong code m·∫´u)
const t1_data = [
    { v: "1. a runny nose", letter: "B", def: "liquid coming out of the nose, often when you are ill or have an allergy", hint: "This is a common symptom of colds and allergies." },
    { v: "2. swollen lips", letter: "E", def: "lips that become bigger than normal because of an allergic reaction", hint: "This can happen when someone has an allergic reaction to food or other substances." },
    { v: "3. itchy skin", letter: "H", def: "feeling uncomfortable because your skin makes you want to scratch", hint: "This is a common symptom of allergies, eczema, or insect bites." },
    { v: "4. a rash", letter: "G", def: "a red area on the skin, often caused by an allergy or illness", hint: "Rashes can appear as red spots, bumps, or patches on the skin." },
    { v: "5. allergic to", letter: "C", def: "having a bad reaction when you eat, touch, or breathe something", hint: "Common allergens include nuts, pollen, dust, and certain medications." },
    { v: "6. immune system", letter: "D", def: "the body's natural system that protects you from diseases", hint: "This system helps fight off infections and keep you healthy." },
    { v: "7. medicine", letter: "A", def: "drugs or treatment used to cure or prevent illness", hint: "Medicines can be in the form of pills, liquids, creams, or injections." },
    { v: "8. check the labels", letter: "F", def: "look at the information printed on food or products before using them", hint: "Important for people with allergies to avoid harmful ingredients." }
];

// Data for Task 2: Filling in the gaps
const t2_data = [
    { 
        q: "He is ______ nuts, so he never eats cakes with almonds.", 
        ans: "allergic to", 
        hint: "This describes having a bad reaction to something."
    },
    { 
        q: "When I have a cold, I often get ______ and keep sneezing.", 
        ans: "a runny nose", 
        hint: "This is a common symptom of a cold."
    },
    { 
        q: "You should always ______ before buying food if you have allergies.", 
        ans: "check the labels", 
        hint: "This means looking at product information."
    },
    { 
        q: "After touching the plant, she developed ______ on her arm.", 
        ans: "a rash", 
        hint: "This is a red area on skin from an allergy."
    },
    { 
        q: "The doctor gave him some ______ to help reduce the symptoms.", 
        ans: "medicine", 
        hint: "This is what doctors prescribe for illness."
    },
    { 
        q: "People with a strong ______ are less likely to get sick.", 
        ans: "immune system", 
        hint: "This is the body's defense system."
    },
    { 
        q: "Eating that food caused her ______, making it hard to talk.", 
        ans: "swollen lips", 
        hint: "This is a common allergic reaction."
    },
    { 
        q: "Some allergies can cause ______, which makes people want to scratch.", 
        ans: "itchy skin", 
        hint: "This causes discomfort and scratching."
    }
];

const t2_wordBank = ["a runny nose", "swollen lips", "itchy skin", "a rash", "allergic to", "immune system", "medicine", "check the labels"];

// Data for Task 3: Underline the correct word/phrase
const t3_data = [
    { 
        q: "He decided to <span class='bold-option'>put off</span> / <span class='bold-option'>put away</span> buying a new phone because he wanted to save money.", 
        ans: "put off", 
        hint: "'Put off' means to postpone or delay something.",
        options: ["put off", "put away"]
    },
    { 
        q: "This blue jacket doesn't really <span class='bold-option'>suit</span> / <span class='bold-option'>match</span> the trousers you're wearing.", 
        ans: "match", 
        hint: "'Match' means to go well with something in appearance.",
        options: ["suit", "match"]
    },
    { 
        q: "Our teacher always tells us to <span class='bold-option'>focus</span> / <span class='bold-option'>affect</span> on what we can improve, not on our mistakes.", 
        ans: "focus", 
        hint: "'Focus on' means to pay attention to something.",
        options: ["focus", "affect"]
    },
    { 
        q: "The company's products are made from natural <span class='bold-option'>fabrics</span> / <span class='bold-option'>chemicals</span>, which are safer for the skin.", 
        ans: "fabrics", 
        hint: "Natural fabrics are safer than chemicals for skin.",
        options: ["fabrics", "chemicals"]
    },
    { 
        q: "She looks very <span class='bold-option'>friendly</span> / <span class='bold-option'>cozy</span> sitting by the fireplace with a blanket and a hot drink.", 
        ans: "cozy", 
        hint: "'Cozy' describes a comfortable, warm feeling.",
        options: ["friendly", "cozy"]
    },
    { 
        q: "I don't know how you can <span class='bold-option'>put up with</span> / <span class='bold-option'>end up with</span> so much noise in this busy caf√© every day.", 
        ans: "put up with", 
        hint: "'Put up with' means to tolerate something unpleasant.",
        options: ["put up with", "end up with"]
    },
    { 
        q: "He chose a <span class='bold-option'>pure</span> / <span class='bold-option'>plain</span> black jacket so it would go with everything.", 
        ans: "plain", 
        hint: "'Plain' means simple, without patterns.",
        options: ["pure", "plain"]
    },
    { 
        q: "His parents often <span class='bold-option'>put</span> / <span class='bold-option'>draw</span> pressure on him to get better exam results.", 
        ans: "put", 
        hint: "'Put pressure on' is the correct phrase.",
        options: ["put", "draw"]
    },
    { 
        q: "Wearing dirty trainers and a torn T-shirt makes him look really <span class='bold-option'>casual</span> / <span class='bold-option'>scruffy</span>.", 
        ans: "scruffy", 
        hint: "'Scruffy' means untidy or messy in appearance.",
        options: ["casual", "scruffy"]
    }
];

// Data for Task 4: Fill in the blanks
const t4_data = [
    { q: "Chameleons can change their colour to ______ their surroundings and avoid danger.", ans: "blend in with", hint: "This means to become similar to the environment." },
    { q: "A lion's thick ______ helps keep it warm in cold weather.", ans: "fur", hint: "This is the hair covering an animal's body." },
    { q: "Bees use their ______ to protect themselves when they feel threatened.", ans: "sting", hint: "This is what bees use to defend themselves." },
    { q: "Dolphins are intelligent ______ that live in the ocean.", ans: "mammals", hint: "Dolphins are warm-blooded animals that give birth to live young." },
    { q: "This new teaching method is very ______ as students understand the lesson faster.", ans: "effective", hint: "This means successful in producing a desired result." },
    { q: "Children often ______ on their parents for food, shelter, and protection.", ans: "depend", hint: "This means to rely on someone for support." },
    { q: "Nurses ______ sick patients in hospitals every day.", ans: "take care of", hint: "This means to look after or care for someone." },
    { q: "Over time, humans have ______ tools to make their lives easier.", ans: "developed", hint: "This means created or improved something over time." },
    { q: "The peacock has an ______ tail that attracts attention.", ans: "impressive", hint: "This means causing admiration or respect." },
    { q: "Snakes and lizards are ______, not warm-blooded animals.", ans: "reptiles", hint: "These are cold-blooded animals with scales." }
];

const t4_wordBank = ["impressive", "sting", "fur", "developed", "confuse", "depend", "blend in with", "take care of", "dedicate", "mammals", "reptiles", "effective", "tail"];

// Data for Task 5: Fill in the missing phrase
const t5_data = [
    { q: "Because she is a ______, she refuses to try new food and only eats a few familiar dishes.", ans: "picky eater", hint: "This describes someone who is very selective about food." },
    { q: "Many parents choose to send their children to ______ before they start primary school.", ans: "nursery school", hint: "This is a school for very young children." },
    { q: "People's ______ often change when they start earning their own money.", ans: "spending habits", hint: "This refers to how people use their money." },
    { q: "This restaurant is popular because it offers good food at ______.", ans: "reasonable prices", hint: "This means prices that are fair and not too high." },
    { q: "A strong ______ helps the body fight off diseases and infections.", ans: "immune system", hint: "This is the body's defense system against illness." },
    { q: "The factory must follow strict ______ to ensure worker safety.", ans: "established regulations", hint: "These are official rules that must be followed." }
];

const t5_wordBank = ["packed lunch", "picky eater", "spending habits", "nursery school", "immune system", "established regulations", "reasonable prices"];

// Data for Task 6: Choose the correct word (been / gone)
const t6_data = [
    { 
        q: "A: Where is Tom? I need to talk to him.<br>B: He has ______ to the library to return some books.", 
        ans: "gone", 
        hint: "He is still at the library (not returned yet).",
        options: ["been", "gone"]
    },
    { 
        q: "A: Have you ever visited Japan?<br>B: Yes, I have ______ there twice with my family.", 
        ans: "been", 
        hint: "I visited and returned (experience).",
        options: ["been", "gone"]
    },
    { 
        q: "A: Why isn't Lucy at her desk right now?<br>B: She has ______ to a meeting and will be back later.", 
        ans: "gone", 
        hint: "She is still at the meeting (not returned yet).",
        options: ["been", "gone"]
    },
    { 
        q: "A: You look tired. What have you done today?<br>B: I've ______ to the supermarket and cooked dinner already.", 
        ans: "been", 
        hint: "I went and returned (completed action).",
        options: ["been", "gone"]
    },
    { 
        q: "A: Is your brother still living in Paris?<br>B: No, he's ______ back to Vietnam permanently.", 
        ans: "gone", 
        hint: "He is in Vietnam now (not returned).",
        options: ["been", "gone"]
    },
    { 
        q: "A: That caf√© looks familiar to you.<br>B: Yes, I've ______ there before with my classmates.", 
        ans: "been", 
        hint: "I visited and returned (experience).",
        options: ["been", "gone"]
    },
    { 
        q: "A: Can I borrow Anna's notes?<br>B: I don't think so. She's ______ home for the day.", 
        ans: "gone", 
        hint: "She is at home now (not returned).",
        options: ["been", "gone"]
    },
    { 
        q: "A: Have the students visited the science museum before?<br>B: Yes, they've ______ there on a school trip.", 
        ans: "been", 
        hint: "They visited and returned (experience).",
        options: ["been", "gone"]
    },
    { 
        q: "A: Why is the office so quiet?<br>B: Everyone has ______ out for lunch.", 
        ans: "gone", 
        hint: "They are out for lunch now (not returned).",
        options: ["been", "gone"]
    },
    { 
        q: "A: Is Mr Brown in his office now?<br>B: No, he's ______ to the airport to pick up a guest.", 
        ans: "gone", 
        hint: "He is at the airport now (not returned).",
        options: ["been", "gone"]
    }
];

// Data for Task 7: Past Perfect or Past Perfect Progressive
const t7_data = [
    { q: "By the time the documentary started, the crew ______ (set up) all the cameras.", ans: "had set up", hint: "Action completed before another past action (Past Perfect)." },
    { q: "Steve was exhausted because he ______ (work) with wild animals since early morning.", ans: "had been working", hint: "Action ongoing before another past action (Past Perfect Progressive)." },
    { q: "Before the guests arrived, she ______ (clean) the house carefully.", ans: "had cleaned", hint: "Action completed before another past action (Past Perfect)." },
    { q: "They ______ (wait) for over an hour before the flight was finally announced.", ans: "had been waiting", hint: "Action ongoing before another past action (Past Perfect Progressive)." },
    { q: "By the end of the day, the zoo keepers ______ (feed) all the animals.", ans: "had fed", hint: "Action completed before a specific time in the past (Past Perfect)." },
    { q: "His hands were shaking because he ______ (hold) a dangerous snake for several minutes.", ans: "had been holding", hint: "Action ongoing before another past action (Past Perfect Progressive)." },
    { q: "Before the teacher entered the classroom, the students ______ (finish) the test.", ans: "had finished", hint: "Action completed before another past action (Past Perfect)." },
    { q: "She felt relieved because she ______ (study) hard for the exam all week.", ans: "had been studying", hint: "Action ongoing before another past action (Past Perfect Progressive)." },
    { q: "When the rescue team arrived, the villagers ______ (search) for the missing child since dawn.", ans: "had been searching", hint: "Action ongoing before another past action (Past Perfect Progressive)." },
    { q: "By the time the storm stopped, the wind ______ (blow) violently for hours.", ans: "had been blowing", hint: "Action ongoing before another past action (Past Perfect Progressive)." }
];

// Data for Task 8: Underline the correct item
const t8_data = [
    { 
        q: "The guide asked us not to touch <span class='bold-option'>anything</span> / <span class='bold-option'>something</span> inside the cave.", 
        ans: "anything", 
        hint: "Use 'anything' in negative sentences.",
        options: ["anything", "something"]
    },
    { 
        q: "There are too <span class='bold-option'>much</span> / <span class='bold-option'>many</span> mistakes in this report to ignore.", 
        ans: "many", 
        hint: "'Many' is used with countable nouns (mistakes).",
        options: ["much", "many"]
    },
    { 
        q: "I checked my bag twice, but I couldn't find <span class='bold-option'>anything</span> / <span class='bold-option'>nothing</span> useful.", 
        ans: "anything", 
        hint: "Use 'anything' in negative sentences (couldn't find).",
        options: ["anything", "nothing"]
    },
    { 
        q: "We don't need a <span class='bold-option'>lot of</span> / <span class='bold-option'>many</span> sugar to make this drink.", 
        ans: "lot of", 
        hint: "'A lot of' is used with uncountable nouns (sugar).",
        options: ["lot of", "many"]
    },
    { 
        q: "Is there <span class='bold-option'>anyone</span> / <span class='bold-option'>someone</span> waiting for the teacher outside the room?", 
        ans: "anyone", 
        hint: "Use 'anyone' in questions.",
        options: ["anyone", "someone"]
    },
    { 
        q: "The town is very quiet at night, and there is <span class='bold-option'>no</span> / <span class='bold-option'>any</span> traffic after midnight.", 
        ans: "no", 
        hint: "'No' means not any.",
        options: ["no", "any"]
    },
    { 
        q: "How <span class='bold-option'>many</span> / <span class='bold-option'>much</span> information did the scientist collect during the trip?", 
        ans: "much", 
        hint: "'Much' is used with uncountable nouns (information).",
        options: ["many", "much"]
    },
    { 
        q: "The classroom was empty, but <span class='bold-option'>somebody</span> / <span class='bold-option'>anybody</span> had left the lights on.", 
        ans: "somebody", 
        hint: "Use 'somebody' in affirmative sentences.",
        options: ["somebody", "anybody"]
    },
    { 
        q: "There wasn't <span class='bold-option'>much</span> / <span class='bold-option'>many</span> time to finish the test, so students hurried.", 
        ans: "much", 
        hint: "'Much' is used with uncountable nouns (time).",
        options: ["much", "many"]
    },
    { 
        q: "She didn't say <span class='bold-option'>nothing</span> / <span class='bold-option'>anything</span> when she heard the bad news.", 
        ans: "anything", 
        hint: "Use 'anything' in negative sentences.",
        options: ["nothing", "anything"]
    },
    { 
        q: "Why didn't <span class='bold-option'>no one</span> / <span class='bold-option'>anyone</span> tell the guide about the broken equipment?", 
        ans: "anyone", 
        hint: "Use 'anyone' in negative questions.",
        options: ["no one", "anyone"]
    },
    { 
        q: "There isn't <span class='bold-option'>no</span> / <span class='bold-option'>any</span> information about this animal in the textbook.", 
        ans: "any", 
        hint: "Use 'any' in negative sentences.",
        options: ["no", "any"]
    },
    { 
        q: "The beach was very crowded, and there were too <span class='bold-option'>many</span> / <span class='bold-option'>much</span> people to relax.", 
        ans: "many", 
        hint: "'Many' is used with countable nouns (people).",
        options: ["many", "much"]
    },
    { 
        q: "Scientists haven't discovered <span class='bold-option'>anything</span> / <span class='bold-option'>nothing</span> new about this species yet.", 
        ans: "anything", 
        hint: "Use 'anything' in negative sentences.",
        options: ["anything", "nothing"]
    }
];

// Data for Task 9: Reading Comprehension
const t9_data = [
    { 
        question: "When Vicky first started cycling", 
        options: [
            "she had a very good coach.",
            "her parents gave her helpful advice.", 
            "she could get to a race track easily.",
            "her brother gave her a great bike."
        ], 
        correct: 2,
        hint: "The text says 'The track was near her school, which meant it was no problem for her to attend training sessions'."
    },
    { 
        question: "Why does Vicky say she stopped cycle racing?", 
        options: [
            "She felt she was too old to do it.",
            "She was becoming bored with it.", 
            "She had won everything she wanted.",
            "She was preparing for a new career."
        ], 
        correct: 1,
        hint: "Vicky said: 'I began to get a bit tired of the whole thing - and when the excitement stops, there's no point.'"
    },
    { 
        question: "What does the charity CycleZone do for young people?", 
        options: [
            "It teaches them how to do track racing.",
            "It supports those who have talent.", 
            "It offers them the chance to try a variety of sports.",
            "It helps them become more confident."
        ], 
        correct: 3,
        hint: "The text says: 'We want them to learn to believe in themselves and their own abilities.'"
    },
    { 
        question: "According to Vicky, some people believe that celebrities can", 
        options: [
            "take attention away from what a charity does.",
            "help people understand a charity's work.", 
            "make the public care less about a charity.",
            "encourage more people to become involved with a charity."
        ], 
        correct: 0,
        hint: "The text says: 'They say the celebrities are only doing it to push themselves forward, which prevents the public from seeing the real work of the charity.'"
    },
    { 
        question: "What would Vicky say on her blog?", 
        options: [
            "As a child, I always knew what I wanted to do when I grew up. But I never expected to become so famous.",
            "If you join CycleZone, you'll get to meet celebrities and learn how they've become successful.", 
            "Although track cycling is not the only sport I've been good at, I've never regretted my choice of career.",
            "In my spare time I love going to schools and helping groups of children learn to ride bikes."
        ], 
        correct: 2,
        hint: "This matches Vicky's story: she tried swimming first, then found cycling, and says it was 'the best decision she ever made'."
    }
];

let answerStates = new Map();
let wordUsageCount = {};
let optionSelections = new Map();
let readingSelections = new Map();

// Render functions for each task
function renderTask1() {
    const vocabContainer = document.getElementById('vocab-t1');
    const defContainer = document.getElementById('def-t1');
    
    vocabContainer.innerHTML = '';
    defContainer.innerHTML = '';
    
    const definitions = {};
    t1_data.forEach(item => {
        definitions[item.letter] = item.def;
    });
    
    const sortedLetters = Object.keys(definitions).sort();
    sortedLetters.forEach(letter => {
        defContainer.innerHTML += `
            <div class="definition-item">
                <span class="definition-letter">${letter}.</span>
                <span class="definition-text">${definitions[letter]}</span>
            </div>`;
    });
    
    t1_data.forEach((item, i) => {
        const qid = `t1-q${i}`;
        
        vocabContainer.innerHTML += `
            <div class="vocab-item">
                <span class="vocab-text">${item.v}</span>
                <input type="text" class="letter-input" id="${qid}" data-type="input" data-ans="${item.letter}" maxlength="1" oninput="adjustWidth(this)">
                <div class="row-btns">
                    <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')" title="Show/Hide answer">üëÅÔ∏è</button>
                    <button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')" title="Show/Hide hint">i</button>
                </div>
                <div class="hint-box" id="${qid}-hint">üí° ${item.hint}</div>
            </div>`;
    });
}

function renderTask2() {
    const bankContainer = document.getElementById('bank-t2');
    const questionContainer = document.getElementById('questions-t2');
    
    bankContainer.innerHTML = '';
    wordUsageCount['t2'] = {};
    
    t2_wordBank.forEach((word, i) => {
        const wordId = `t2-word-${i}`;
        bankContainer.innerHTML += `
            <div class="word-item" id="${wordId}" data-word="${word.toLowerCase()}" draggable="true" ondragstart="dragWord(event)" onclick="selectWordFromBank('${wordId}')">
                ${word}
            </div>`;
        wordUsageCount['t2'][word.toLowerCase()] = 0;
    });
    
    questionContainer.innerHTML = '';
    
    t2_data.forEach((item, i) => {
        const qid = `t2-q${i}`;
        questionContainer.innerHTML += `
            <div class="question-row">
                <strong>${i+1}</strong> ${item.q}
                <input type="text" class="word-input" id="${qid}" data-type="input" data-ans="${item.ans}" oninput="adjustWidth(this); updateWordBank('t2')" ondrop="dropWord(event, '${qid}')" ondragover="allowDrop(event)" onclick="this.select()">
                <div class="row-btns">
                    <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')">üëÅÔ∏è</button>
                    <button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')">i</button>
                </div>
                <div class="hint-box" id="${qid}-hint">üí° ${item.hint}</div>
            </div>`;
    });
    
    addWordBankEventListeners('t2');
}

function renderTask3() {
    const container = document.getElementById('questions-t3');
    container.innerHTML = '';
    
    t3_data.forEach((item, i) => {
        const qid = `t3-q${i}`;
        
        let optionsHtml = '';
        item.options.forEach((option, optIndex) => {
            optionsHtml += `<button class="option-btn" onclick="selectOption('${qid}', '${option}')" id="${qid}-opt${optIndex}">${option}</button>`;
        });
        
        container.innerHTML += `
            <div class="question-row">
                <strong>${i+1}</strong> <span class="sentence-text">
                    ${item.q}
                    <div class="option-container">
                        ${optionsHtml}
                    </div>
                </span>
                <div class="row-btns">
                    <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')">üëÅÔ∏è</button>
                    <button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')">i</button>
                </div>
                <div class="hint-box" id="${qid}-hint">üí° ${item.hint}</div>
            </div>`;
    });
}

function renderTask4() {
    const bankContainer = document.getElementById('bank-t4');
    const questionContainer = document.getElementById('questions-t4');
    
    bankContainer.innerHTML = '';
    wordUsageCount['t4'] = {};
    
    t4_wordBank.forEach((word, i) => {
        const wordId = `t4-word-${i}`;
        bankContainer.innerHTML += `
            <div class="word-item" id="${wordId}" data-word="${word.toLowerCase()}" draggable="true" ondragstart="dragWord(event)" onclick="selectWordFromBank('${wordId}')">
                ${word}
            </div>`;
        wordUsageCount['t4'][word.toLowerCase()] = 0;
    });
    
    questionContainer.innerHTML = '';
    
    t4_data.forEach((item, i) => {
        const qid = `t4-q${i}`;
        questionContainer.innerHTML += `
            <div class="question-row">
                <strong>${i+1}</strong> ${item.q}
                <input type="text" class="word-input" id="${qid}" data-type="input" data-ans="${item.ans}" oninput="adjustWidth(this); updateWordBank('t4')" ondrop="dropWord(event, '${qid}')" ondragover="allowDrop(event)" onclick="this.select()">
                <div class="row-btns">
                    <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')">üëÅÔ∏è</button>
                    <button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')">i</button>
                </div>
                <div class="hint-box" id="${qid}-hint">üí° ${item.hint}</div>
            </div>`;
    });
    
    addWordBankEventListeners('t4');
}

function renderTask5() {
    const bankContainer = document.getElementById('bank-t5');
    const questionContainer = document.getElementById('questions-t5');
    
    bankContainer.innerHTML = '';
    wordUsageCount['t5'] = {};
    
    t5_wordBank.forEach((word, i) => {
        const wordId = `t5-word-${i}`;
        bankContainer.innerHTML += `
            <div class="word-item" id="${wordId}" data-word="${word.toLowerCase()}" draggable="true" ondragstart="dragWord(event)" onclick="selectWordFromBank('${wordId}')">
                ${word}
            </div>`;
        wordUsageCount['t5'][word.toLowerCase()] = 0;
    });
    
    questionContainer.innerHTML = '';
    
    t5_data.forEach((item, i) => {
        const qid = `t5-q${i}`;
        questionContainer.innerHTML += `
            <div class="question-row">
                <strong>${i+1}</strong> ${item.q}
                <input type="text" class="word-input" id="${qid}" data-type="input" data-ans="${item.ans}" oninput="adjustWidth(this); updateWordBank('t5')" ondrop="dropWord(event, '${qid}')" ondragover="allowDrop(event)" onclick="this.select()">
                <div class="row-btns">
                    <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')">üëÅÔ∏è</button>
                    <button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')">i</button>
                </div>
                <div class="hint-box" id="${qid}-hint">üí° ${item.hint}</div>
            </div>`;
    });
    
    addWordBankEventListeners('t5');
}

function renderTask6() {
    const container = document.getElementById('questions-t6');
    container.innerHTML = '';
    
    t6_data.forEach((item, i) => {
        const qid = `t6-q${i}`;
        
        let optionsHtml = '';
        item.options.forEach((option, optIndex) => {
            optionsHtml += `<button class="option-btn" onclick="selectOption('${qid}', '${option}')" id="${qid}-opt${optIndex}">${option}</button>`;
        });
        
        container.innerHTML += `
            <div class="question-row">
                <strong>${i+1}</strong> <span class="sentence-text">
                    ${item.q}
                    <div class="option-container">
                        ${optionsHtml}
                    </div>
                </span>
                <div class="row-btns">
                    <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')">üëÅÔ∏è</button>
                    <button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')">i</button>
                </div>
                <div class="hint-box" id="${qid}-hint">üí° ${item.hint}</div>
            </div>`;
    });
}

function renderTask7() {
    const container = document.getElementById('questions-t7');
    container.innerHTML = '';
    
    t7_data.forEach((item, i) => {
        const qid = `t7-q${i}`;
        container.innerHTML += `
            <div class="question-row">
                <strong>${i+1}</strong> ${item.q}
                <input type="text" class="word-input" id="${qid}" data-type="input" data-ans="${item.ans}" oninput="adjustWidth(this)">
                <div class="row-btns">
                    <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')">üëÅÔ∏è</button>
                    <button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')">i</button>
                </div>
                <div class="hint-box" id="${qid}-hint">üí° ${item.hint}</div>
            </div>`;
    });
}

function renderTask8() {
    const container = document.getElementById('questions-t8');
    container.innerHTML = '';
    
    t8_data.forEach((item, i) => {
        const qid = `t8-q${i}`;
        
        let optionsHtml = '';
        item.options.forEach((option, optIndex) => {
            optionsHtml += `<button class="option-btn" onclick="selectOption('${qid}', '${option}')" id="${qid}-opt${optIndex}">${option}</button>`;
        });
        
        container.innerHTML += `
            <div class="question-row">
                <strong>${i+1}</strong> <span class="sentence-text">
                    ${item.q}
                    <div class="option-container">
                        ${optionsHtml}
                    </div>
                </span>
                <div class="row-btns">
                    <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')">üëÅÔ∏è</button>
                    <button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')">i</button>
                </div>
                <div class="hint-box" id="${qid}-hint">üí° ${item.hint}</div>
            </div>`;
    });
}

function renderTask9() {
    const questionsContainer = document.getElementById('reading-questions-t9');
    questionsContainer.innerHTML = '';
    
    t9_data.forEach((item, i) => {
        const qid = `t9-q${i}`;
        const optionLetters = ['A', 'B', 'C', 'D'];
        
        let optionsHtml = '<div class="mcq-options-container">';
        item.options.forEach((option, optIndex) => {
            const letter = optionLetters[optIndex];
            optionsHtml += `
                <div class="mcq-option" id="${qid}-option-${optIndex}" onclick="selectReadingOption('${qid}', ${optIndex})">
                    <span class="option-letter">${letter}</span>
                    <span class="option-text">${option}</span>
                </div>`;
        });
        optionsHtml += '</div>';
        
        questionsContainer.innerHTML += `
            <div class="mcq-question" id="${qid}-container">
                <p><strong>${i+1}</strong> ${item.question}</p>
                ${optionsHtml}
                <div class="row-btns" style="margin-top: 10px;">
                    <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')">üëÅÔ∏è</button>
                    <button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')">i</button>
                </div>
                <div class="hint-box" id="${qid}-hint">üí° ${item.hint}</div>
            </div>`;
    });
}

// Helper functions
function adjustWidth(el) { 
    let baseWidth;
    if (el.classList.contains('letter-input')) {
        baseWidth = 45;
    } else if (el.classList.contains('word-input')) {
        baseWidth = 120;
    } else {
        baseWidth = 60;
    }
    
    const charWidth = el.classList.contains('word-input') ? 9 : 10;
    const newWidth = Math.max(el.value.length * charWidth + 20, baseWidth);
    
    let maxWidth;
    if (el.classList.contains('letter-input')) {
        maxWidth = 80;
    } else if (el.classList.contains('word-input')) {
        maxWidth = 400;
    } else {
        maxWidth = 300;
    }
    
    el.style.width = Math.min(newWidth, maxWidth) + "px";
}

function toggleHint(id) { 
    const h = document.getElementById(id + '-hint'); 
    const infoBtn = document.getElementById(id + '-info');
    
    if (h) {
        if (h.style.display === 'block') {
            h.style.display = 'none';
            if (infoBtn) infoBtn.classList.remove('active');
        } else {
            h.style.display = 'block';
            if (infoBtn) infoBtn.classList.add('active');
        }
    }
}

function toggleSingleAns(id) { 
    const qid = id.replace('-eye', '');
    
    if (qid.startsWith('t9-q')) {
        const questionIndex = parseInt(qid.split('-q')[1]);
        const questionData = t9_data[questionIndex];
        const correctAnswerIndex = questionData.correct;
        
        const options = document.querySelectorAll(`#${qid}-container .mcq-option`);
        options.forEach((option, index) => {
            option.classList.remove('correct', 'incorrect', 'selected');
            if (index === correctAnswerIndex) {
                option.classList.add('correct');
            }
        });
        
        const eyeBtn = document.getElementById(id);
        if (eyeBtn) eyeBtn.classList.add('active');
        answerStates.set(`${qid}-state`, true);
        return;
    }
    
    if (qid.startsWith('t3-q') || qid.startsWith('t6-q') || qid.startsWith('t8-q')) {
        const questionIndex = parseInt(qid.split('-q')[1]);
        let data;
        
        if (qid.startsWith('t3-q')) data = t3_data;
        else if (qid.startsWith('t6-q')) data = t6_data;
        else data = t8_data;
        
        const questionData = data[questionIndex];
        const correctAnswer = questionData.ans;
        
        const optionButtons = [];
        for (let i = 0; i < questionData.options.length; i++) {
            const btn = document.getElementById(`${qid}-opt${i}`);
            if (btn) optionButtons.push(btn);
        }
        
        const stateKey = `${qid}-state`;
        const isCurrentlyShown = answerStates.get(stateKey) || false;
        
        if (isCurrentlyShown) {
            optionButtons.forEach(btn => {
                btn.classList.remove('correct-option', 'incorrect-option');
                const userSelection = optionSelections.get(qid);
                if (userSelection && btn.textContent === userSelection) {
                    btn.classList.add('selected');
                }
            });
            
            const eyeBtn = document.getElementById(id);
            if (eyeBtn) eyeBtn.classList.remove('active');
            answerStates.set(stateKey, false);
        } else {
            optionButtons.forEach(btn => {
                btn.classList.remove('selected', 'correct-option', 'incorrect-option');
                if (correctAnswer.includes(',')) {
                    const correctAnswers = correctAnswer.split(',').map(a => a.trim());
                    if (correctAnswers.some(ans => btn.textContent.includes(ans))) {
                        btn.classList.add('correct-option');
                    }
                } else if (btn.textContent === correctAnswer) {
                    btn.classList.add('correct-option');
                }
            });
            
            const eyeBtn = document.getElementById(id);
            if (eyeBtn) eyeBtn.classList.add('active');
            answerStates.set(stateKey, true);
        }
        return;
    }
    
    const el = document.getElementById(qid);
    if (!el) return;
    
    const ans = el.dataset.ans;
    const eyeBtn = document.getElementById(id);
    const stateKey = `${qid}-state`;
    const isCurrentlyShown = answerStates.get(stateKey) || false;
    
    if (isCurrentlyShown) {
        el.value = "";
        el.classList.remove('correct', 'incorrect-marked');
        adjustWidth(el);
        if (eyeBtn) eyeBtn.classList.remove('active');
        answerStates.set(stateKey, false);
    } else {
        if (ans) {
            el.value = ans;
            el.classList.add('correct');
            el.classList.remove('incorrect-marked');
            adjustWidth(el);
            if (eyeBtn) eyeBtn.classList.add('active');
            answerStates.set(stateKey, true);
        }
    }
}

function selectOption(qid, option) {
    const questionIndex = parseInt(qid.split('-q')[1]);
    let data;
    
    if (qid.startsWith('t3-q')) data = t3_data;
    else if (qid.startsWith('t6-q')) data = t6_data;
    else if (qid.startsWith('t8-q')) data = t8_data;
    else return;
    
    const questionData = data[questionIndex];
    
    const optionButtons = [];
    for (let i = 0; i < questionData.options.length; i++) {
        const btn = document.getElementById(`${qid}-opt${i}`);
        if (btn) optionButtons.push(btn);
    }
    
    optionButtons.forEach(btn => {
        btn.classList.remove('selected');
    });
    
    const selectedBtn = optionButtons.find(btn => btn.textContent === option);
    if (selectedBtn) {
        selectedBtn.classList.add('selected');
    }
    
    optionSelections.set(qid, option);
}

function selectReadingOption(qid, optionIndex) {
    const questionIndex = parseInt(qid.split('-q')[1]);
    const questionData = t9_data[questionIndex];
    
    const options = document.querySelectorAll(`#${qid}-container .mcq-option`);
    options.forEach(option => {
        option.classList.remove('selected');
    });
    
    const selectedOption = document.getElementById(`${qid}-option-${optionIndex}`);
    if (selectedOption) {
        selectedOption.classList.add('selected');
    }
    
    readingSelections.set(qid, optionIndex);
}

function showAnswers(prefix) { 
    if (prefix === 't9') {
        t9_data.forEach((item, i) => {
            const qid = `${prefix}-q${i}`;
            const correctIndex = item.correct;
            
            const options = document.querySelectorAll(`#${qid}-container .mcq-option`);
            options.forEach((option, index) => {
                option.classList.remove('correct', 'incorrect', 'selected');
                if (index === correctIndex) {
                    option.classList.add('correct');
                }
            });
            
            const eyeBtn = document.getElementById(`${qid}-eye`);
            if (eyeBtn) eyeBtn.classList.add('active');
            answerStates.set(`${qid}-state`, true);
        });
        return;
    }
    
    if (prefix === 't3' || prefix === 't6' || prefix === 't8') {
        let data;
        if (prefix === 't3') data = t3_data;
        else if (prefix === 't6') data = t6_data;
        else data = t8_data;
        
        data.forEach((item, i) => {
            const qid = `${prefix}-q${i}`;
            const correctAnswer = item.ans;
            
            const optionButtons = [];
            for (let j = 0; j < item.options.length; j++) {
                const btn = document.getElementById(`${qid}-opt${j}`);
                if (btn) optionButtons.push(btn);
            }
            
            optionButtons.forEach(btn => {
                btn.classList.remove('selected', 'correct-option', 'incorrect-option');
                if (correctAnswer.includes(',')) {
                    const correctAnswers = correctAnswer.split(',').map(a => a.trim());
                    if (correctAnswers.some(ans => btn.textContent.includes(ans))) {
                        btn.classList.add('correct-option');
                    }
                } else if (btn.textContent === correctAnswer) {
                    btn.classList.add('correct-option');
                }
            });
            
            const eyeBtn = document.getElementById(`${qid}-eye`);
            if (eyeBtn) eyeBtn.classList.add('active');
            answerStates.set(`${qid}-state`, true);
        });
        return;
    }
    
    document.querySelectorAll(`[id^="${prefix}-q"]`).forEach(el => {
        if (el.dataset && el.dataset.type === 'input') {
            const ans = el.dataset.ans;
            const eyeBtn = document.getElementById(el.id + '-eye');
            
            if (ans) {
                el.value = ans;
                el.classList.add('correct');
                el.classList.remove('incorrect-marked');
                adjustWidth(el);
                if (eyeBtn) eyeBtn.classList.add('active');
                answerStates.set(`${el.id}-state`, true);
            }
        }
    });
}

function resetSection(prefix) { 
    document.querySelectorAll(`[id^="${prefix}"]`).forEach(i => { 
        if(i.tagName === 'INPUT') { 
            i.value = ""; 
            i.classList.remove('correct', 'incorrect-marked'); 
            adjustWidth(i); 
        } 
        
        const hBox = document.getElementById(i.id + '-hint'); 
        if(hBox) hBox.style.display = 'none'; 
    });
    
    document.querySelectorAll(`[id$="-eye"], [id$="-info"]`).forEach(btn => {
        if (btn.id.includes(prefix)) {
            btn.classList.remove('active');
        }
    });
    
    if (prefix === 't3' || prefix === 't6' || prefix === 't8') {
        const allOptionBtns = document.querySelectorAll(`#questions-${prefix} .option-btn`);
        
        allOptionBtns.forEach(btn => {
            btn.classList.remove('selected', 'correct-option', 'incorrect-option');
            btn.style.cssText = '';
            btn.style.background = '';
            btn.style.backgroundColor = '';
            btn.style.color = '';
            btn.style.borderColor = '';
            btn.style.border = '';
        });
        
        for (const [key, value] of optionSelections.entries()) {
            if (key.startsWith(`${prefix}-`)) {
                optionSelections.delete(key);
            }
        }
        
        document.querySelectorAll(`#questions-${prefix} .btn-small[id$="-eye"]`).forEach(eyeBtn => {
            eyeBtn.classList.remove('active');
        });
        
        for (const [key, value] of answerStates.entries()) {
            if (key.includes(`${prefix}-q`)) {
                answerStates.delete(key);
            }
        }
    }
    
    if (prefix === 't9') {
        const options = document.querySelectorAll(`#reading-questions-${prefix} .mcq-option`);
        options.forEach(option => {
            option.classList.remove('selected', 'correct', 'incorrect');
        });
        
        readingSelections.clear();
        
        document.querySelectorAll(`#reading-questions-${prefix} .btn-small[id$="-eye"]`).forEach(eyeBtn => {
            eyeBtn.classList.remove('active');
        });
        
        for (const [key, value] of answerStates.entries()) {
            if (key.includes(`${prefix}-q`)) {
                answerStates.delete(key);
            }
        }
    }
    
    if (prefix === 't2' || prefix === 't4' || prefix === 't5') {
        const wordItems = document.querySelectorAll(`#bank-${prefix} .word-item`);
        wordItems.forEach(item => {
            item.classList.remove('used');
            item.style.display = 'flex';
        });
        
        if (wordUsageCount[prefix]) {
            Object.keys(wordUsageCount[prefix]).forEach(word => {
                wordUsageCount[prefix][word] = 0;
            });
        }
    }
}

function normalizeAnswer(answer) {
    return answer.toLowerCase()
        .trim()
        .replace(/\s+/g, ' ')
        .replace(/[.,;:!?]$/, '');
}

function validateMultipleAnswers(userAnswer, correctAnswers) {
    const answers = correctAnswers.split('|').map(ans => normalizeAnswer(ans));
    const normalizedUser = normalizeAnswer(userAnswer);
    
    return answers.some(ans => ans === normalizedUser);
}

function checkAll() { 
    document.querySelectorAll('[data-type="input"]').forEach(el => { 
        const correctAnswers = el.dataset.ans;
        const userAnswer = el.value;
        
        el.classList.remove('correct', 'incorrect-marked'); 
        
        if(!userAnswer.trim()) {
            return;
        }
        
        if(validateMultipleAnswers(userAnswer, correctAnswers)) {
            el.classList.add('correct');
        } else {
            el.classList.add('incorrect-marked');
        }
    });
    
    ['t3', 't6', 't8'].forEach(taskId => {
        let data;
        if (taskId === 't3') data = t3_data;
        else if (taskId === 't6') data = t6_data;
        else data = t8_data;
        
        data.forEach((item, i) => {
            const qid = `${taskId}-q${i}`;
            const selectedOption = optionSelections.get(qid);
            const correctAnswer = item.ans;
            
            if (!selectedOption) {
                return;
            }
            
            const optionButtons = [];
            for (let j = 0; j < item.options.length; j++) {
                const btn = document.getElementById(`${qid}-opt${j}`);
                if (btn) optionButtons.push(btn);
            }
            
            optionButtons.forEach(btn => {
                btn.classList.remove('correct-option', 'incorrect-option');
            });
            
            const userSelectedBtn = optionButtons.find(btn => btn.textContent === selectedOption);
            if (userSelectedBtn) {
                if (correctAnswer.includes(',')) {
                    const correctAnswers = correctAnswer.split(',').map(a => a.trim());
                    if (correctAnswers.some(ans => selectedOption.includes(ans))) {
                        userSelectedBtn.classList.add('correct-option');
                    } else {
                        userSelectedBtn.classList.add('incorrect-option');
                    }
                } else if (selectedOption === correctAnswer) {
                    userSelectedBtn.classList.add('correct-option');
                } else {
                    userSelectedBtn.classList.add('incorrect-option');
                }
            }
        });
    });
    
    t9_data.forEach((item, i) => {
        const qid = `t9-q${i}`;
        const userSelection = readingSelections.get(qid);
        const correctIndex = item.correct;
        
        const options = document.querySelectorAll(`#${qid}-container .mcq-option`);
        options.forEach((option, index) => {
            option.classList.remove('correct', 'incorrect', 'selected');
            
            if (userSelection !== undefined) {
                if (index === userSelection) {
                    if (userSelection === correctIndex) {
                        option.classList.add('correct');
                    } else {
                        option.classList.add('incorrect');
                    }
                }
            }
        });
    });
}

// Word bank functionality - ƒê√É S·ª¨A ƒê·ªîI
function addWordBankEventListeners(id) {
    const wordItems = document.querySelectorAll(`#bank-${id} .word-item`);
    const inputs = document.querySelectorAll(`#questions-${id} input.word-input`);
    
    wordItems.forEach(item => {
        item.addEventListener('click', function() {
            selectWordFromBank(this.id);
        });
        
        item.addEventListener('dragstart', function(e) {
            dragWord(e);
        });
    });
    
    inputs.forEach(input => {
        input.addEventListener('dragover', function(e) {
            allowDrop(e);
        });
        
        input.addEventListener('drop', function(e) {
            dropWord(e, this.id);
        });
        
        input.addEventListener('input', function() {
            updateWordBank(id);
        });
    });
}

function dragWord(event) {
    event.dataTransfer.setData("text/plain", event.target.dataset.word);
    event.dataTransfer.setData("wordId", event.target.id);
}

function allowDrop(event) {
    event.preventDefault();
}

function dropWord(event, inputId) {
    event.preventDefault();
    const word = event.dataTransfer.getData("text/plain");
    const wordId = event.dataTransfer.getData("wordId");
    
    const input = document.getElementById(inputId);
    if (input) {
        input.value = word;
        adjustWidth(input);
        
        // ƒê√°nh d·∫•u t·ª´ ƒë√£ ƒë∆∞·ª£c s·ª≠ d·ª•ng (·∫©n ƒëi)
        const wordElement = document.getElementById(wordId);
        if (wordElement) {
            wordElement.classList.add('used');
        }
        
        const taskId = wordId.split('-')[1];
        updateWordBankUsage(word, `t${taskId}`);
    }
}

function selectWordFromBank(wordId) {
    const wordItem = document.getElementById(wordId);
    if (!wordItem || wordItem.classList.contains('used')) return;
    
    const word = wordItem.dataset.word;
    const taskId = wordId.split('-')[1];
    
    const inputs = document.querySelectorAll(`#questions-t${taskId} input.word-input`);
    let emptyInput = null;
    
    for (const input of inputs) {
        if (!input.value.trim()) {
            emptyInput = input;
            break;
        }
    }
    
    if (emptyInput) {
        emptyInput.value = word;
        adjustWidth(emptyInput);
        
        // ƒê√°nh d·∫•u t·ª´ ƒë√£ ƒë∆∞·ª£c s·ª≠ d·ª•ng (·∫©n ƒëi)
        wordItem.classList.add('used');
        
        updateWordBankUsage(word, `t${taskId}`);
    } else {
        alert('All gaps are filled. You can click on a gap to replace its content.');
    }
}

function updateWordBankUsage(word, taskId) {
    if (!wordUsageCount[taskId]) {
        wordUsageCount[taskId] = {};
    }
    
    if (!wordUsageCount[taskId][word]) {
        wordUsageCount[taskId][word] = 0;
    }
    
    const inputs = document.querySelectorAll(`#questions-${taskId} input.word-input`);
    let count = 0;
    
    inputs.forEach(input => {
        if (normalizeAnswer(input.value) === normalizeAnswer(word)) {
            count++;
        }
    });
    
    wordUsageCount[taskId][word] = count;
    
    updateWordBankDisplay(taskId);
}

function updateWordBankDisplay(taskId) {
    const wordItems = document.querySelectorAll(`#bank-${taskId} .word-item`);
    
    wordItems.forEach(item => {
        const word = item.dataset.word;
        const count = wordUsageCount[taskId][word] || 0;
        
        if (count > 0) {
            item.classList.add('used');
        } else {
            item.classList.remove('used');
            item.style.display = 'flex';
        }
    });
}

function updateWordBank(taskId) {
    const inputs = document.querySelectorAll(`#questions-${taskId} input.word-input`);
    
    // Reset ƒë·∫øm
    if (wordUsageCount[taskId]) {
        Object.keys(wordUsageCount[taskId]).forEach(word => {
            wordUsageCount[taskId][word] = 0;
        });
    }
    
    // ƒê·∫øm l·∫°i
    inputs.forEach(input => {
        const word = normalizeAnswer(input.value);
        if (word) {
            // T√¨m t·ª´ t∆∞∆°ng ·ª©ng trong word bank
            const wordItems = document.querySelectorAll(`#bank-${taskId} .word-item`);
            wordItems.forEach(item => {
                const bankWord = normalizeAnswer(item.dataset.word);
                if (bankWord === word) {
                    if (wordUsageCount[taskId][bankWord] !== undefined) {
                        wordUsageCount[taskId][bankWord]++;
                    }
                }
            });
        }
    });
    
    updateWordBankDisplay(taskId);
}

// Reading panel resizer
function initializeResizer() {
    const resizer = document.getElementById('resizer-t9');
    const leftPanel = document.getElementById('text-panel-t9');
    const rightPanel = document.getElementById('questions-panel-t9');
    
    if (!resizer || !leftPanel || !rightPanel) return;
    
    leftPanel.style.width = '50%';
    rightPanel.style.flex = '1';
    
    let isResizing = false;
    let startX = 0;
    let startLeftWidth = 0;
    let startRightWidth = 0;
    
    resizer.addEventListener('mousedown', function(e) {
        isResizing = true;
        startX = e.clientX;
        startLeftWidth = leftPanel.offsetWidth;
        startRightWidth = rightPanel.offsetWidth;
        
        document.body.style.cursor = 'col-resize';
        document.body.style.userSelect = 'none';
        
        document.addEventListener('mousemove', handleMouseMove);
        document.addEventListener('mouseup', handleMouseUp);
    });
    
    function handleMouseMove(e) {
        if (!isResizing) return;
        
        const dx = e.clientX - startX;
        const newLeftWidth = startLeftWidth + dx;
        
        const containerWidth = leftPanel.parentElement.offsetWidth;
        const minWidth = 200;
        const maxWidth = containerWidth - minWidth - resizer.offsetWidth;
        
        if (newLeftWidth >= minWidth && newLeftWidth <= maxWidth) {
            leftPanel.style.width = newLeftWidth + 'px';
            rightPanel.style.flex = '1';
        }
    }
    
    function handleMouseUp() {
        isResizing = false;
        document.body.style.cursor = '';
        document.body.style.userSelect = '';
        
        document.removeEventListener('mousemove', handleMouseMove);
        document.removeEventListener('mouseup', handleMouseUp);
    }
}

// Grammar reference toggle functions
function toggleGrammar(grammarId) {
    const element = document.getElementById(`grammar-${grammarId}`);
    const toggleBtn = element.querySelector('.group-toggle');
    
    if (element.classList.contains('expanded')) {
        element.classList.remove('expanded');
        element.classList.add('collapsed');
        toggleBtn.textContent = '+';
    } else {
        element.classList.remove('collapsed');
        element.classList.add('expanded');
        toggleBtn.textContent = '‚àí';
    }
}

function toggleTopic(topicId) {
    const element = document.getElementById(`topic-${topicId}`);
    const toggleBtn = element.parentElement.querySelector('.group-toggle');
    
    if (element.classList.contains('expanded')) {
        element.classList.remove('expanded');
        element.classList.add('collapsed');
        toggleBtn.textContent = '+';
    } else {
        element.classList.remove('collapsed');
        element.classList.add('expanded');
        toggleBtn.textContent = '‚àí';
    }
}

// Toggle to√†n b·ªô reference section
function toggleReferenceSection() {
    const content = document.getElementById('reference-content');
    const toggleBtn = document.getElementById('reference-toggle');
    
    if (content.style.display === 'none' || content.style.display === '') {
        content.style.display = 'block';
        toggleBtn.textContent = '‚àí';
    } else {
        content.style.display = 'none';
        toggleBtn.textContent = '+';
    }
}

// Initialize everything when page loads
window.onload = () => {
    renderTask1();
    renderTask2();
    renderTask3();
    renderTask4();
    renderTask5();
    renderTask6();
    renderTask7();
    renderTask8();
    renderTask9();
    initializeResizer();
    
    // M·∫∑c ƒë·ªãnh thu g·ªçn reference section
    const referenceContent = document.getElementById('reference-content');
    const referenceToggle = document.getElementById('reference-toggle');
    if (referenceContent) {
        referenceContent.style.display = 'none';
        referenceToggle.textContent = '+';
    }
};

// Check all answers with Enter key
document.addEventListener('keydown', e => { 
    if(e.key === 'Enter') {
        checkAll(); 
    }
});
</script>
</body>
</html>