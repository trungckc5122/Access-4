<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Access 4 - Review Module 4</title>
    <style>
        :root {
            --primary: #2980b9; 
            --primary-dark: #1c5982; 
            --success: #27ae60;
            --error: #e74c3c; 
            --warning: #f1c40f; 
            --bg: #f4f7f9;
            --text: #2c3e50; 
            --card: #ffffff;
            --selection: #3498db;
            --selection-bg: #ebf5fb;
        }
        
        body { 
            font-family: 'Times New Roman', serif; 
            font-size: 13pt; 
            background-color: var(--bg); 
            color: var(--text); 
            margin: 0; 
            padding: 20px 20px 150px 20px;
            line-height: 1.6; 
        }
        
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
        }
        
        .sticky-bank { 
            position: sticky; 
            top: 15px; 
            z-index: 100;
            background-color: #fff; 
            padding: 15px; 
            border-radius: 10px; 
            margin-bottom: 25px; 
            border: 2px solid var(--primary); 
            display: flex; 
            flex-wrap: wrap; 
            gap: 10px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }
        
        .word-item { 
            background: #eef2f7; 
            border: 1px solid var(--primary); 
            color: var(--primary-dark); 
            padding: 6px 12px; 
            border-radius: 5px; 
            cursor: grab; 
            user-select: none; 
            transition: 0.2s; 
            font-size: 0.9em; 
            font-weight: 500;
        }
        
        .word-item.used { 
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        .word-item:hover:not(.used) { 
            background: var(--primary); 
            color: white; 
        }

        .exercise-card { 
            background: var(--card); 
            border-radius: 12px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); 
            padding: 25px; 
            margin-bottom: 30px; 
        }
        
        .exercise-title { 
            font-weight: bold; 
            font-size: 1.25em; 
            margin-bottom: 18px; 
            color: var(--primary-dark); 
            border-bottom: 2px solid #eee; 
            padding-bottom: 8px; 
        }
        
        .question-row { 
            margin-bottom: 18px; 
            line-height: 2.2; 
            border-bottom: 1px solid #f9f9f9; 
            padding-bottom: 10px; 
            position: relative; 
        }
        
        input[type="text"] { 
            border: none; 
            border-bottom: 2px solid #bdc3c7; 
            background: #fafafa; 
            padding: 2px 8px; 
            font-size: 1em; 
            transition: 0.2s; 
            outline: none;
            min-width: 60px; 
            border-radius: 4px 4px 0 0; 
            text-align: center; 
            font-family: 'Times New Roman';
            box-sizing: border-box;
        }
        
        input.letter-input { 
            width: 45px; 
            min-width: 45px; 
            max-width: 80px;
            text-transform: uppercase; 
            font-weight: bold; 
            color: var(--primary-dark); 
        }
        
        input.word-input { 
            min-width: 120px; 
            max-width: 400px;
            text-align: left; 
        }
        
        input.correct { 
            border-bottom-color: var(--success) !important; 
            background-color: #e8f8f5 !important; 
            color: #1e8449 !important; 
        }
        
        input.incorrect-marked { 
            border-bottom-color: var(--error) !important; 
            background-color: #fdedec !important; 
        }

        .row-btns { 
            display: inline-flex; 
            gap: 5px; 
            vertical-align: middle; 
            margin-left: 10px; 
        }
        
        .btn-small { 
            background: #eee; 
            border: 1px solid #ccc; 
            border-radius: 4px; 
            width: 28px; 
            height: 28px; 
            cursor: pointer; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 14px; 
            transition: 0.2s;
        }
        
        .btn-small:hover {
            background: #ddd;
        }
        
        .btn-small.active {
            background: #3498db;
            color: white;
            border-color: #2980b9;
        }
        
        .info-btn { 
            background: #95a5a6; 
            color: white; 
            border: none; 
            border-radius: 50%; 
            width: 20px; 
            height: 20px; 
            font-size: 11px; 
            cursor: pointer; 
            display: inline-flex; 
            align-items: center; 
            justify-content: center; 
            transition: 0.2s;
        }
        
        .info-btn:hover {
            background: #7f8c8d;
        }
        
        .info-btn.active {
            background: #5d6d6e;
        }
        
        .hint-box { 
            display: none; 
            margin-top: 8px; 
            padding: 10px; 
            background-color: #fef9e7; 
            border-left: 4px solid var(--warning); 
            color: #7d6608; 
            border-radius: 4px; 
            font-size: 0.85em; 
        }
        
        .controls-row { 
            display: flex; 
            justify-content: flex-end; 
            gap: 10px; 
            margin-top: 15px; 
        }
        
        .btn { 
            padding: 8px 20px; 
            border-radius: 6px; 
            cursor: pointer; 
            border: none; 
            font-weight: bold; 
            transition: 0.3s; 
        }
        
        .btn-reset { 
            background: #95a5a6; 
            color: white; 
        }
        
        .btn-show-all { 
            background: var(--primary); 
            color: white; 
        }
        
        .check-all-btn { 
            position: fixed; 
            right: 45px;
            bottom: 30px; 
            background-color: var(--success); 
            color: white; 
            padding: 15px 30px; 
            border-radius: 50px; 
            cursor: pointer; 
            z-index: 10000;
            font-weight: bold; 
            border: none; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.2); 
        }
        
        .odd-one-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        .odd-one-table th {
            background-color: #e3f2fd;
            padding: 12px;
            text-align: left;
            border: 1px solid #ddd;
        }
        
        .odd-one-table td {
            padding: 12px;
            border: 1px solid #ddd;
            vertical-align: top;
        }
        
        .odd-one-table input {
            width: 150px;
            min-width: 150px;
        }
        
        .web-diagram-container {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            justify-content: space-between;
            margin: 20px 0;
        }
        
        .web-category {
            flex: 1;
            min-width: 250px;
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #e9ecef;
        }
        
        .web-category h3 {
            margin-top: 0;
            color: var(--primary-dark);
            text-align: center;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        
        .web-words {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }
        
        .web-word-input {
            width: 100%;
            box-sizing: border-box;
        }
        
        .dual-screen-container {
            display: flex;
            margin: 20px 0;
            position: relative;
            height: 450px;
        }
        
        .people-panel, .restaurants-panel {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #e9ecef;
            overflow-y: auto;
            position: relative;
            user-select: text;
            height: 100%;
        }
        
        .people-panel {
            width: 50%;
            min-width: 200px;
            max-width: calc(100% - 210px);
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
        }
        
        .restaurants-panel {
            width: 50%;
            min-width: 200px;
            max-width: calc(100% - 210px);
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
        }
        
        .people-panel h3, .restaurants-panel h3 {
            margin-top: 0;
            color: var(--primary-dark);
            text-align: center;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        
        .person-item, .restaurant-item {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .person-number, .restaurant-letter {
            font-weight: bold;
            color: var(--primary);
            margin-right: 10px;
            background-color: #e3f2fd;
            padding: 4px 8px;
            border-radius: 4px;
        }
        
        .matching-input {
            width: 80px;
            margin-left: 10px;
            text-align: center;
            font-weight: bold;
        }
        
        .instructions {
            color: #7f8c8d;
            font-size: 0.95em;
            margin-bottom: 15px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        
        .existing-number {
            font-weight: bold;
            color: var(--primary);
            margin-right: 8px;
        }
        
        .option-container {
            display: inline-flex;
            gap: 10px;
            margin-left: 10px;
            margin-right: 10px;
            flex-wrap: wrap;
        }
        
        .option-btn {
            background: #eef2f7;
            border: 2px solid #bdc3c7;
            border-radius: 6px;
            padding: 6px 15px;
            cursor: pointer;
            font-weight: 500;
            transition: 0.2s;
            min-width: 80px;
            text-align: center;
            font-size: 0.9em;
        }
        
        .option-btn:hover {
            background: #dfe6f0;
            border-color: #95a5a6;
        }
        
        .option-btn.selected {
            background: #3498db;
            color: white;
            border-color: #2980b9;
        }
        
        .option-btn.correct-option {
            background: #27ae60;
            color: white;
            border-color: #219653;
        }
        
        .option-btn.incorrect-option {
            background: #e74c3c;
            color: white;
            border-color: #c0392b;
        }
        
        .bold-option {
            font-weight: bold;
            color: var(--primary-dark);
        }
        
        .resizer {
            position: relative;
            width: 10px;
            background-color: #ddd;
            cursor: col-resize;
            z-index: 10;
            flex-shrink: 0;
            margin: 0;
        }
        
        .resizer:hover {
            background-color: #3498db;
        }
        
        .resizer::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 2px;
            height: 40px;
            background-color: #95a5a6;
            border-radius: 1px;
        }
        
        .context-menu {
            position: absolute;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 10000;
            min-width: 150px;
            display: none;
        }
        
        .context-menu-item {
            padding: 8px 12px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background-color 0.2s;
        }
        
        .context-menu-item:hover {
            background-color: #f5f5f5;
        }
        
        .highlighted-text {
            background-color: rgba(255, 235, 59, 0.4) !important;
            padding: 0 2px;
            border-radius: 2px;
            color: inherit !important;
            display: inline;
        }
        
        html {
            overflow-x: hidden;
        }
        
        body {
            overflow-y: scroll;
            padding-right: 0 !important;
        }
        
        .reading-container {
            display: flex;
            margin: 20px 0;
            position: relative;
            min-height: 500px;
            height: 600px;
        }
        
        .text-panel, .questions-panel {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            border: 1px solid #e9ecef;
            overflow-y: auto;
            position: relative;
            height: 100%;
            flex: 1;
        }
        
        .text-panel {
            margin-right: 0;
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
        }
        
        .questions-panel {
            margin-left: 0;
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
        }
        
        .text-panel h3, .questions-panel h3 {
            margin-top: 0;
            color: var(--primary-dark);
            text-align: center;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        
        .reading-text {
            line-height: 1.8;
            text-align: justify;
            user-select: text;
        }
        
        .mcq-question {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .mcq-question p {
            margin-bottom: 12px;
            font-weight: 500;
            font-size: 1.05em;
        }
        
        .mcq-options-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .mcq-option {
            margin-bottom: 8px;
            padding: 8px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            background-color: #f9f9f9;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
        }
        
        .mcq-option:hover {
            background-color: #f0f0f0;
            border-color: #bdc3c7;
        }
        
        .mcq-option.selected {
            background-color: #e3f2fd;
            border-color: #3498db;
        }
        
        .mcq-option.correct {
            background-color: #d4edda;
            border-color: #27ae60;
            color: #155724;
        }
        
        .mcq-option.incorrect {
            background-color: #f8d7da;
            border-color: #e74c3c;
            color: #721c24;
        }
        
        .mcq-option input {
            margin-right: 10px;
        }
        
        .option-letter {
            display: inline-block;
            width: 24px;
            height: 24px;
            line-height: 24px;
            text-align: center;
            background-color: #3498db;
            color: white;
            border-radius: 50%;
            margin-right: 10px;
            font-weight: bold;
        }
        
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        .comparison-table th, .comparison-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
        }
        
        .comparison-table th {
            background-color: #e3f2fd;
            font-weight: bold;
        }
        
        .paragraph-exercise {
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            margin: 20px 0;
            line-height: 1.8;
        }
        
        .paragraph-exercise p {
            margin: 0 0 15px 0;
        }
        
        .gap-input {
            border: none;
            border-bottom: 2px dashed #3498db;
            background-color: #f0f8ff;
            padding: 2px 6px;
            margin: 0 5px;
            min-width: 80px;
            text-align: center;
            font-family: 'Times New Roman', serif;
            font-size: 1em;
            border-radius: 0;
        }
        
        .gap-input.correct {
            border-bottom-color: #27ae60;
            background-color: #e8f8f5;
            color: #1e8449;
        }
        
        .gap-input.incorrect {
            border-bottom-color: #e74c3c;
            background-color: #fdedec;
            color: #c0392b;
        }
        
        @media (max-width: 768px) {
            .check-all-btn {
                right: 15px;
                bottom: 20px;
                padding: 12px 20px;
                font-size: 0.9em;
            }
            
            body {
                padding: 15px 15px 120px 15px;
            }
            
            .mcq-options-container {
                grid-template-columns: 1fr;
            }
            
            .reading-container {
                flex-direction: column;
                height: 800px;
            }
            
            .text-panel, .questions-panel {
                width: 100% !important;
                height: 50% !important;
                margin: 0;
                border-radius: 10px;
                margin-bottom: 10px;
            }
            
            .resizer {
                display: none;
            }
        }
    </style>
</head>
<body>

<div class="container">
    <h1 style="text-align: center; color: var(--primary-dark); margin-bottom: 30px;">Access 4 - Review Module 4</h1>
    
    <!-- Vocabulary Section -->
    <div class="exercise-card">
        <div class="exercise-title">Vocabulary: Physical Appearance</div>
        
        <div class="instructions">1. Match the words to form phrases.</div>
        
        <div class="sticky-bank" id="bank-t1"></div>
        
        <div id="questions-t1"></div>
        <div class="controls-row">
            <button class="btn btn-show-all" onclick="showAnswers('t1')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('t1')">Reset</button>
        </div>
        
        <div class="instructions">2. Read the text and replace the bold words with their opposites.</div>
        
        <div class="paragraph-exercise" id="paragraph-t2">
            <p>
                My best friend Isabelle is a very <input type="text" class="gap-input" id="t2-q0" data-ans="tall"> 
                (short) and <input type="text" class="gap-input" id="t2-q1" data-ans="pretty"> (ugly) girl. She has 
                <input type="text" class="gap-input" id="t2-q2" data-ans="long"> (short) 
                <input type="text" class="gap-input" id="t2-q3" data-ans="curly"> (straight) hair and 
                <input type="text" class="gap-input" id="t2-q4" data-ans="full"> (thin) lips. Isabelle is 
                <input type="text" class="gap-input" id="t2-q5" data-ans="friendly"> (unfriendly) and smart.
            </p>
            <p>
                Isabelle's younger sister, Marie, is also my friend. Marie doesn't look like Isabelle, though. Marie is 
                <input type="text" class="gap-input" id="t2-q6" data-ans="short"> (tall) and 
                <input type="text" class="gap-input" id="t2-q7" data-ans="plump"> (skinny) with 
                <input type="text" class="gap-input" id="t2-q8" data-ans="straight"> (curly) brown hair. However, 
                Marie is friendly and smart like her sister. I'm very 
                <input type="text" class="gap-input" id="t2-q9" data-ans="happy"> (sad) that they are my friends!
            </p>
        </div>
        
        <div class="controls-row">
            <button class="btn btn-show-all" onclick="showAnswers('t2')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('t2')">Reset</button>
        </div>
        
        <div class="instructions">3. Circle the correct adjective.</div>
        <div id="questions-t3"></div>
        <div class="controls-row">
            <button class="btn btn-show-all" onclick="showAnswers('t3')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('t3')">Reset</button>
        </div>
        
        <div class="instructions">4. Complete the sentences with the verbs below. Pay attention to the tenses.</div>
        
        <div class="sticky-bank" id="bank-t4"></div>
        
        <div id="questions-t4"></div>
        <div class="controls-row">
            <button class="btn btn-show-all" onclick="showAnswers('t4')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('t4')">Reset</button>
        </div>
    </div>
    
    <!-- Clothes and Fashion Section -->
    <div class="exercise-card">
        <div class="exercise-title">Clothes and Fashion</div>
        
        <div class="instructions">5. Circle the word that's out of place. Then add another word to each group.</div>
        
        <table class="odd-one-table" id="table-t5">
            <thead>
                <tr>
                    <th>Word Group</th>
                    <th>Odd Word</th>
                    <th>New Word</th>
                </tr>
            </thead>
            <tbody id="questions-t5"></tbody>
        </table>
        <div class="controls-row">
            <button class="btn btn-show-all" onclick="showAnswers('t5')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('t5')">Reset</button>
        </div>
        
        <div class="instructions">6. Look at the table and complete the sentences using the correct form of the adjectives and any other necessary words.</div>
        
        <table class="comparison-table">
            <thead>
                <tr>
                    <th></th>
                    <th>Katherine</th>
                    <th>Lucy</th>
                    <th>Maria</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>friendly</strong></td>
                    <td>✓</td>
                    <td>✓</td>
                    <td>✓</td>
                </tr>
                <tr>
                    <td><strong>old</strong></td>
                    <td></td>
                    <td>✓</td>
                    <td>✓</td>
                </tr>
                <tr>
                    <td><strong>tall</strong></td>
                    <td>✓</td>
                    <td></td>
                    <td>✓</td>
                </tr>
                <tr>
                    <td><strong>beautiful</strong></td>
                    <td>✓</td>
                    <td>✓</td>
                    <td></td>
                </tr>
            </tbody>
        </table>
        
        <div id="questions-t6"></div>
        <div class="controls-row">
            <button class="btn btn-show-all" onclick="showAnswers('t6')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('t6')">Reset</button>
        </div>
    </div>
    
    <!-- Grammar Section -->
    <div class="exercise-card">
        <div class="exercise-title">Grammar: Comparatives and Superlatives</div>
        
        <div class="instructions">7. Put the adjectives in parentheses in the correct form. Add any necessary words where needed.</div>
        <div id="questions-t7"></div>
        <div class="controls-row">
            <button class="btn btn-show-all" onclick="showAnswers('t7')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('t7')">Reset</button>
        </div>
        
        <div class="instructions">8. Circle the correct answer.</div>
        <div id="questions-t8"></div>
        <div class="controls-row">
            <button class="btn btn-show-all" onclick="showAnswers('t8')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('t8')">Reset</button>
        </div>
        
        <div class="instructions">9. Circle the correct answer (so / such / too / enough).</div>
        <div id="questions-t9"></div>
        <div class="controls-row">
            <button class="btn btn-show-all" onclick="showAnswers('t9')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('t9')">Reset</button>
        </div>
        
        <div class="instructions">10. Circle the correct item.</div>
        <div id="questions-t10"></div>
        <div class="controls-row">
            <button class="btn btn-show-all" onclick="showAnswers('t10')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('t10')">Reset</button>
        </div>
    </div>
    
    <!-- Reading Section -->
    <div class="exercise-card">
        <div class="exercise-title">Reading: Dealing with Stress and Growing Up</div>
        
        <div class="instructions">Read the text and choose the correct option for each gap.</div>
        
        <div class="reading-container" id="reading-t11">
            <div class="text-panel" id="text-panel-t11">
                <h3>Reading Text</h3>
                <div class="reading-text" id="reading-text-t11">
                    You feel overwhelmed and confused. You're always 1) <span class="gap" id="gap1">______</span> pressure and it seems like people expect too 2) <span class="gap" id="gap2">______</span> from you. You have a difficult time controlling your emotions and your mood seems to change constantly. These things are all part of growing up and it's normal to feel stress and pressure 3) <span class="gap" id="gap3">______</span>. However, stress becomes a problem when you start losing sleep and when your ability to 4) <span class="gap" id="gap4">______</span> on basic things, like studying, decreases.<br><br>
                    
                    Teenagers these days have a lot to deal with. When teens are forced to 5) <span class="gap" id="gap5">______</span> their problems alone over a long period of time, then stress becomes 6) <span class="gap" id="gap6">______</span> major problem and can lead to serious physical and emotional side-effects. Here are some simple things that you can do to reduce your stress and to feel better about yourself again:<br><br>
                    
                    - Think positive! Push away those negative thoughts that make you feel sad and angry. Having a positive 7) <span class="gap" id="gap7">______</span> will help you deal with any situation more calmly.<br>
                    - Don't set 8) <span class="gap" id="gap8">______</span> goals and don't try to achieve perfection. No one is perfect, so just do your best.<br>
                    - Rest, eat well, and exercise. Your body needs a lot of 9) <span class="gap" id="gap9">______</span> and minerals in order to stay healthy, so avoid unhealthy food and bad habits such as smoking or drinking alcohol. Exercising a few days a week will make you feel better about yourself and it will help you fight stress.<br>
                    - Communication is extremely important. Find someone you can trust and talk to them about how you feel and what you're going through. 10) <span class="gap" id="gap10">______</span> your thoughts with others is a wonderful way to release stress.<br><br>
                    
                    Everyone experiences stress and pressure. Just try to find helpful ways to handle your problems and don't forget to relax.
                </div>
            </div>
            
            <div class="resizer" id="resizer-t11"></div>
            
            <div class="questions-panel" id="questions-panel-t11">
                <h3>Questions</h3>
                <div id="reading-questions-t11"></div>
            </div>
        </div>
        
        <div class="controls-row" style="margin-top: 40px !important; display: block !important; clear: both !important; position: relative !important; z-index: 1000; background: #f8f9fa; padding: 20px; border-radius: 8px; border: 1px solid #e9ecef;">
            <button class="btn btn-show-all" onclick="showAnswers('t11')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('t11')">Reset</button>
        </div>
    </div>
    
    <!-- Grammar Review Section -->
    <div class="exercise-card">
        <div class="exercise-title">Grammar Review: Prepositions and Phrasal Verbs</div>
        
        <div class="instructions">12. Fill in the blanks. Use on, to, at, up, for, and with.</div>
        <div id="questions-t12"></div>
        <div class="controls-row">
            <button class="btn btn-show-all" onclick="showAnswers('t12')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('t12')">Reset</button>
        </div>
        
        <div class="instructions">13. Underline the correct particle.</div>
        <div id="questions-t13"></div>
        <div class="controls-row">
            <button class="btn btn-show-all" onclick="showAnswers('t13')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('t13')">Reset</button>
        </div>
        
        <div class="instructions">14. Fill in the blanks with an adjective derived from the words in capitals.</div>
        <div id="questions-t14"></div>
        <div class="controls-row">
            <button class="btn btn-show-all" onclick="showAnswers('t14')">Show All</button>
            <button class="btn btn-reset" onclick="resetSection('t14')">Reset</button>
        </div>
    </div>
</div>

<button class="check-all-btn" onclick="checkAll()">CHECK ALL ANSWERS (ENTER)</button>

<div class="context-menu" id="context-menu">
    <div class="context-menu-item" id="highlight-text">Highlight Text</div>
    <div class="context-menu-item" id="remove-highlight">Remove Highlight</div>
    <div class="context-menu-item" id="clear-highlights">Clear All Highlights</div>
</div>

<script>
// Data for Task 1: Match words to form phrases
const t1_data = [
    { left: "bushy", right: "eyebrows", ans: "d" },
    { left: "deep", right: "wrinkles", ans: "e" },
    { left: "bald", right: "head", ans: "f" },
    { left: "full", right: "lips", ans: "b" },
    { left: "pierced", right: "ears", ans: "c" },
    { left: "curly", right: "hair", ans: "g" },
    { left: "thin", right: "mustache", ans: "a" }
];

const t1_wordBank = [
    "mustache", "lips", "ears", "eyebrows", "wrinkles", "head", "hair"
];

// Data for Task 2: Replace with opposites (đã được tích hợp trực tiếp trong HTML)

// Data for Task 3: Circle the correct adjective
const t3_data = [
    { 
        q: "My dad has <span class='bold-option'>bushy</span> / <span class='bold-option'>deep</span> eyebrows.", 
        ans: "bushy", 
        hint: "'Bushy' describes thick eyebrows, while 'deep' would describe wrinkles or voice.",
        options: ["bushy", "deep"]
    },
    { 
        q: "Kate's ears are <span class='bold-option'>wide</span> / <span class='bold-option'>pierced</span>.", 
        ans: "pierced", 
        hint: "Ears are typically described as 'pierced' when they have earrings.",
        options: ["wide", "pierced"]
    },
    { 
        q: "Ann's lips are very <span class='bold-option'>chubby</span> / <span class='bold-option'>full</span>; I'm so jealous!", 
        ans: "full", 
        hint: "'Full lips' is the common expression for lips that are nicely shaped and plump.",
        options: ["chubby", "full"]
    },
    { 
        q: "I think that Josh is a very <span class='bold-option'>long</span> / <span class='bold-option'>handsome</span> young man.", 
        ans: "handsome", 
        hint: "'Handsome' describes an attractive man, while 'long' would describe height or hair.",
        options: ["long", "handsome"]
    },
    { 
        q: "My best friend has <span class='bold-option'>wavy</span> / <span class='bold-option'>narrow</span> hair.", 
        ans: "wavy", 
        hint: "Hair is described as 'wavy', 'curly', or 'straight'. 'Narrow' describes width, not hair type.",
        options: ["wavy", "narrow"]
    },
    { 
        q: "My teacher has a <span class='bold-option'>high</span> / <span class='bold-option'>double</span> chin because she is <span class='bold-option'>skinny</span> / <span class='bold-option'>overweight</span>.", 
        ans: "double - overweight", 
        hint: "'Double chin' is the correct phrase, and it's typically associated with being overweight.",
        options: ["high - skinny", "double - overweight", "high 0 overweight", "double - skinny"]
    },
    { 
        q: "Anthony doesn't eat very much so he's quite <span class='bold-option'>skinny</span> / <span class='bold-option'>overweight</span>.", 
        ans: "skinny", 
        hint: "If someone doesn't eat much, they would likely be skinny, not overweight.",
        options: ["skinny", "overweight"]
    }
];

// Data for Task 4: Complete with verbs
const t4_data = [
    { q: "I cut my hair every month because it ______ fast.", ans: "grows", hint: "Hair grows fast, requiring regular cuts." },
    { q: "The boy ______ his hand in class because he wanted to answer the question.", ans: "raised", hint: "Students raise their hands to answer questions." },
    { q: "Luis ______ his shoulders because he didn't know the answer.", ans: "shrugged", hint: "People shrug their shoulders to show they don't know something." },
    { q: "When mom asked me if I wanted more spaghetti, I ______ my head.", ans: "nodded", hint: "Nodding means moving your head up and down to say yes." },
    { q: "Felicity ______ too much on her appearance.", ans: "focuses", hint: "Focus on appearance means paying too much attention to how one looks." },
    { q: "I've gained some weight this past month and now my clothes don't ______ me.", ans: "fit", hint: "Clothes fit when they are the right size for your body." },
    { q: "Boys and girls ______ at different speeds.", ans: "mature", hint: "Mature means to develop and grow up." },
    { q: "The things that women and girls see on TV and in magazines often ______ them.", ans: "affect", hint: "Media images can affect (influence) people's self-image." },
    { q: "My sister ______ at herself in the mirror all the time.", ans: "stares", hint: "Stare means to look fixedly for a long time." }
];

const t4_wordBank = ["raise", "stare", "shrug", "mature", "nod", "grow", "focus", "affect", "fit"];

// Data for Task 5: Circle the odd word out
const t5_data = [
    { 
        list: "bright, polka-dot, nylon, plaid", 
        odd: "nylon", 
        newWord: "striped",
        reason: "nylon is a material, others are patterns/colors",
        hint: "Bright, polka-dot, and plaid are patterns or color descriptions, while nylon is a type of fabric material."
    },
    { 
        list: "plain, classy, classy, silk", 
        odd: "silk", 
        newWord: "elegant",
        reason: "silk is a material, others are style descriptions",
        hint: "Plain and classy describe style or appearance, while silk is a specific fabric material."
    },
    { 
        list: "elegant, woolen, denim, scruffy", 
        odd: "denim", 
        newWord: "casual",
        reason: "denim is a specific fabric type, others are general style descriptions",
        hint: "Elegant, woolen, and scruffy are style or fabric type descriptions, while denim is a specific fabric (jeans material)."
    }
];

// Data for Task 6: Complete comparative sentences
const t6_data = [
    { 
        q: "Katherine is <strong>friendlier than</strong> Lucy.", 
        ans: "friendlier than",
        showInput: false
    },
    { 
        q: "Maria is ______ of all.", 
        ans: "the friendliest",
        hint: "Maria has all checks for friendly, so she is the friendliest."
    },
    { 
        q: "Lucy is ______ Maria, but Katherine is ______ of all.", 
        ans: "older than, the oldest",
        hint: "Lucy has a check for old but Maria doesn't, so Lucy is older than Maria. Katherine has no check for old, so she's the oldest."
    },
    { 
        q: "Maria is ______ Katherine, but Lucy is ______ of all.", 
        ans: "taller than, the tallest",
        hint: "Maria has a check for tall but Katherine doesn't, so Maria is taller than Katherine. Lucy has no check for tall, so she's the tallest."
    },
    { 
        q: "Maria is ______ Lucy, but Katherine is ______ of all.", 
        ans: "more beautiful than, the most beautiful",
        hint: "Maria has no check for beautiful but Lucy does, so Maria is more beautiful than Lucy. Katherine has all checks for beautiful, so she's the most beautiful."
    }
];

// Data for Task 7: Put adjectives in correct form
const t7_data = [
    { 
        q: "A: That was such a great movie.<br>B: I agree. It was one of ______ (good) movies I've seen in a long time.", 
        ans: "the best",
        hint: "'Good' becomes 'the best' in superlative form when comparing to all other movies."
    },
    { 
        q: "A: Are you older than Greg?<br>B: No, actually I'm a couple of years ______ (young) than him.", 
        ans: "younger",
        hint: "Comparative form of 'young' is 'younger than'."
    },
    { 
        q: "A: Meg is so pretty, isn't she?<br>B: Yeah, she's one of ______ (beautiful) girls I know.", 
        ans: "the most beautiful",
        hint: "'Beautiful' becomes 'the most beautiful' in superlative form (three or more syllables)."
    },
    { 
        q: "A: I think we should travel by plane.<br>B: Well, traveling by plane is ______ (fast) way to get there, but it is also ______ (expensive).", 
        ans: "the fastest, the most expensive",
        hint: "Both are superlative forms comparing all ways of travel."
    },
    { 
        q: "A: The service is terrible.<br>B: I know. This is ______ (bad) restaurant I've ever been to.", 
        ans: "the worst",
        hint: "'Bad' becomes 'the worst' in superlative form."
    },
    { 
        q: "A: I am so relieved that I passed my exam.<br>B: I can tell. You definitely look ______ (relax) now than you did before.", 
        ans: "more relaxed",
        hint: "Comparative form of 'relaxed' (two syllables ending in -ed) is 'more relaxed than'."
    }
];

// Data for Task 8: Circle the correct answer
const t8_data = [
    { 
        q: "Fred is ..... his brother, Jack.", 
        ans: "taller than", 
        hint: "We use comparative form when comparing two people.",
        options: ["taller than", "as tall as", "the tallest"]
    },
    { 
        q: "He's ..... of his friends.", 
        ans: "the least successful", 
        hint: "We use superlative form when comparing one person to a group (all his friends).",
        options: ["successful as", "less successful than", "the least successful"]
    },
    { 
        q: "My mom is ..... my dad.", 
        ans: "much younger than", 
        hint: "We use comparative form when comparing two people, and 'much' emphasizes the difference.",
        options: ["much younger than", "younger", "young as"]
    },
    { 
        q: "Planes are ..... trains and cars.", 
        ans: "faster than", 
        hint: "We use comparative form when comparing one type of transportation to others.",
        options: ["faster than", "as fast as", "fast"]
    },
    { 
        q: "Jason is ..... person I know. He always makes me laugh.", 
        ans: "the funniest", 
        hint: "We use superlative form when comparing to all other people I know.",
        options: ["funnier than", "the funnier", "the funniest"]
    },
    { 
        q: "I bought a ..... new pair of gold earrings yesterday.", 
        ans: "beautiful", 
        hint: "No comparison is being made, so we use the simple adjective form.",
        options: ["most beautiful", "more beautiful", "beautiful"]
    }
];

// Data for Task 9: so / such / too / enough
const t9_data = [
    { 
        q: "These shoes are <span class='bold-option'>so</span> / <span class='bold-option'>such</span> comfortable.", 
        ans: "so", 
        hint: "Use 'so' before adjectives without nouns.",
        options: ["so", "such"]
    },
    { 
        q: "David is <span class='bold-option'>so</span> / <span class='bold-option'>such</span> a handsome young man.", 
        ans: "such", 
        hint: "Use 'such' before adjective + noun combinations.",
        options: ["so", "such"]
    },
    { 
        q: "I'm <span class='bold-option'>too</span> / <span class='bold-option'>enough</span> tired to go out tonight.", 
        ans: "too", 
        hint: "'Too' means more than necessary or wanted.",
        options: ["too", "enough"]
    },
    { 
        q: "Let's go swimming today. It's warm <span class='bold-option'>too</span> / <span class='bold-option'>enough</span>.", 
        ans: "enough", 
        hint: "'Enough' means sufficient or adequate.",
        options: ["too", "enough"]
    },
    { 
        q: "This is <span class='bold-option'>such</span> / <span class='bold-option'>so</span> a beautiful bracelet.", 
        ans: "such", 
        hint: "Use 'such' before adjective + noun combinations.",
        options: ["such", "so"]
    }
];

// Data for Task 10: Circle the correct item
const t10_data = [
    { 
        q: "I ...... in my room when I ...... an unusual noise.", 
        ans: "was studying, heard", 
        hint: "Past continuous for background action, simple past for interrupting action.",
        options: ["was studying, was hearing", "was studying, heard", "studied, was hearing"]
    },
    { 
        q: "I called ...... last night.", 
        ans: "him", 
        hint: "Use object pronoun after verbs.",
        options: ["him", "his", "he"]
    },
    { 
        q: "Nicole ...... her cell phone during the exam.", 
        ans: "turned off", 
        hint: "Phrasal verb 'turn off' means to switch something off.",
        options: ["turn off", "turned around", "turned off"]
    },
    { 
        q: "Jason ...... Chinese food.", 
        ans: "has never eaten", 
        hint: "Present perfect for experiences in life up to now.",
        options: ["has never eaten", "have never eaten", "has never eat"]
    },
    { 
        q: "...... best friend, Ellen, is from New York.", 
        ans: "My", 
        hint: "Possessive adjective before noun.",
        options: ["My", "Mine", "Me"]
    },
    { 
        q: "Sandra is ...... a difficult time at home.", 
        ans: "going through", 
        hint: "Phrasal verb 'go through' means to experience something difficult.",
        options: ["going out", "going through", "going about"]
    },
    { 
        q: "Ted ...... a movie with his friends right now.", 
        ans: "is watching", 
        hint: "Present continuous for actions happening now.",
        options: ["watches", "is watching", "watching"]
    },
    { 
        q: "Andrea is ...... Joanne but ...... Katie.", 
        ans: "taller than - shorter than", 
        hint: "Comparative forms when comparing two people.",
        options: ["taller - shorter", "taller than - the shortest", "taller than - shorter than"]
    },
    { 
        q: "Alison wants ...... a doctor when she grows up.", 
        ans: "to become", 
        hint: "'Want to + verb' is the correct structure.",
        options: ["becoming", "to become", "to becoming"]
    },
    { 
        q: "It's not warm ...... to go to the beach yet.", 
        ans: "enough", 
        hint: "'Enough' comes after adjectives.",
        options: ["enough", "too", "such"]
    },
    { 
        q: "Chad is ...... a friendly person. He's always willing to help.", 
        ans: "such", 
        hint: "Use 'such' before adjective + noun combinations.",
        options: ["so", "too", "such"]
    },
    { 
        q: "I had ...... sandwich and ...... apple for lunch today.", 
        ans: "a - an", 
        hint: "'A' before consonant sounds, 'an' before vowel sounds.",
        options: ["an - a", "a - a", "a - an"]
    },
    { 
        q: "Andrew ...... reading books about animals and nature.", 
        ans: "enjoys", 
        hint: "Third person singular present simple.",
        options: ["enjoying", "enjoys", "enjoy"]
    },
    { 
        q: "Grant is the ...... student in the class.", 
        ans: "quietest", 
        hint: "Superlative form of 'quiet'.",
        options: ["quietest", "quieter", "quiet"]
    },
    { 
        q: "You shouldn't ...... doing your homework.", 
        ans: "put off", 
        hint: "Phrasal verb 'put off' means to postpone or delay.",
        options: ["put out", "put on", "put off"]
    },
    { 
        q: "I ...... that book four times in the past year.", 
        ans: "have read", 
        hint: "Present perfect for actions in an unfinished time period (the past year).",
        options: ["has read", "have read", "have been reading"]
    }
];

// Data for Task 11: Reading comprehension
const t11_data = [
    { 
        question: "1", 
        options: ["with", "on", "under", "in"], 
        correct: 2, // under
        hint: "The phrase is 'under pressure' meaning feeling stressed."
    },
    { 
        question: "2", 
        options: ["more", "lots", "many", "much"], 
        correct: 3, // much
        hint: "Use 'much' with uncountable nouns like 'pressure' or expectations."
    },
    { 
        question: "3", 
        options: ["sometimes", "anytime", "anyhow", "everytime"], 
        correct: 0, // sometimes
        hint: "'Sometimes' means occasionally, which fits the context."
    },
    { 
        question: "4", 
        options: ["do", "see", "think", "concentrate"], 
        correct: 3, // concentrate
        hint: "The phrase is 'concentrate on' meaning to focus attention on something."
    },
    { 
        question: "5", 
        options: ["see", "stare", "face", "deal"], 
        correct: 2, // face
        hint: "'Face their problems' means to confront or deal with difficulties."
    },
    { 
        question: "6", 
        options: ["an", "a", "the", "one"], 
        correct: 1, // a
        hint: "'A major problem' - indefinite article before consonant sound."
    },
    { 
        question: "7", 
        options: ["idea", "position", "attitude", "thought"], 
        correct: 2, // attitude
        hint: "Positive attitude helps deal with situations calmly."
    },
    { 
        question: "8", 
        options: ["strange", "complicated", "high", "unrealistic"], 
        correct: 3, // unrealistic
        hint: "The text advises against trying to achieve perfection, so unrealistic goals."
    },
    { 
        question: "9", 
        options: ["energy", "health", "vitamins", "fruit"], 
        correct: 2, // vitamins
        hint: "Vitamins and minerals are what the body needs to stay healthy."
    },
    { 
        question: "10", 
        options: ["Giving", "Showing", "Sharing", "Dividing"], 
        correct: 2, // Sharing
        hint: "'Sharing your thoughts' means talking about your feelings with others."
    }
];

// Data for Task 12: Prepositions
const t12_data = [
    { q: "Stop looking ______ yourself in the mirror.", ans: "at", hint: "'Look at' is the correct preposition." },
    { q: "Ryan doesn't focus ______ his appearance.", ans: "on", hint: "'Focus on' means to pay attention to." },
    { q: "I enjoy talking ______ my mom.", ans: "to", hint: "'Talk to' someone means to have a conversation with them." },
    { q: "Tim grew ______ in LA.", ans: "up", hint: "'Grow up' means to become an adult." },
    { q: "Kim loves going out ______ her friends.", ans: "with", hint: "'Go out with' means to socialize with." },
    { q: "I need to buy a gift ______ Brenda.", ans: "for", hint: "Buy something 'for' someone." }
];

// Data for Task 13: Phrasal verbs
const t13_data = [
    { 
        q: "Tony decided to put <span class='bold-option'>on</span> / <span class='bold-option'>off</span> going to the dentist.", 
        ans: "off", 
        hint: "'Put off' means to postpone or delay.",
        options: ["on", "off"]
    },
    { 
        q: "You should put <span class='bold-option'>with</span> / <span class='bold-option'>on</span> your coat. It's cold.", 
        ans: "on", 
        hint: "'Put on' means to wear clothing.",
        options: ["with", "on"]
    },
    { 
        q: "I refuse to put <span class='bold-option'>up with</span> / <span class='bold-option'>on with</span> mean people.", 
        ans: "up with", 
        hint: "'Put up with' means to tolerate.",
        options: ["up with", "on with"]
    },
    { 
        q: "The firemen put <span class='bold-option'>up</span> / <span class='bold-option'>out</span> the fire.", 
        ans: "out", 
        hint: "'Put out' a fire means to extinguish it.",
        options: ["up", "out"]
    },
    { 
        q: "It's not right to put <span class='bold-option'>down</span> / <span class='bold-option'>up</span> people who disagree with you.", 
        ans: "down", 
        hint: "'Put down' means to criticize or belittle someone.",
        options: ["down", "up"]
    },
    { 
        q: "Can you please put me <span class='bold-option'>through</span> / <span class='bold-option'>on</span> to the customer service department.", 
        ans: "through", 
        hint: "'Put through' means to connect by telephone.",
        options: ["through", "on"]
    }
];

// Data for Task 14: Adjective derivation
const t14_data = [
    { q: "These shoes are very ______ I can't wait to take them off. <strong>COMFORTABLE</strong>", ans: "uncomfortable", hint: "Prefix 'un-' makes the opposite meaning." },
    { q: "The boy's bad behavior was ______ <strong>APPROPRIATE</strong>", ans: "inappropriate", hint: "Prefix 'in-' makes the opposite meaning." },
    { q: "Peter is ______ of operating his computer, so he always asks for help. <strong>CAPABLE</strong>", ans: "incapable", hint: "Prefix 'in-' makes the opposite meaning." },
    { q: "Brad is ______ because he can't go to his friend's party on Saturday. <strong>HAPPY</strong>", ans: "unhappy", hint: "Prefix 'un-' makes the opposite meaning." }
];

let answerStates = new Map();
let wordUsageCount = {};
let optionSelections = new Map();
let hintVisible = {};
let selectedTextRange = null;
let contextMenu = null;
let readingSelections = new Map();

// Render functions for each task
function renderTask1() {
    const bankContainer = document.getElementById('bank-t1');
    const questionContainer = document.getElementById('questions-t1');
    
    bankContainer.innerHTML = '';
    wordUsageCount['t1'] = {};
    
    t1_wordBank.forEach((word, i) => {
        const wordId = `t1-word-${i}`;
        bankContainer.innerHTML += `
            <div class="word-item" id="${wordId}" data-word="${word.toLowerCase()}" draggable="true" ondragstart="dragWord(event)" onclick="selectWordFromBank('${wordId}')">
                ${word.toLowerCase()}
            </div>`;
        wordUsageCount['t1'][word.toLowerCase()] = 0;
    });
    
    questionContainer.innerHTML = '';
    
    t1_data.forEach((item, i) => {
        const qid = `t1-q${i}`;
        const leftItem = item.left;
        questionContainer.innerHTML += `
            <div class="question-row">
                <strong>${i+1}</strong> ${leftItem} 
                <input type="text" class="word-input" id="${qid}" data-type="input" data-ans="${item.right}" oninput="adjustWidth(this); updateWordBank('t1')" ondrop="dropWord(event, '${qid}')" ondragover="allowDrop(event)" onclick="this.select()">
                <div class="row-btns">
                    <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')">👁️</button>
                    <button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')">i</button>
                </div>
                <div class="hint-box" id="${qid}-hint">💡 Match: ${leftItem} + ${item.right}</div>
            </div>`;
    });
    
    addWordBankEventListeners('t1');
}

function renderTask3() {
    const container = document.getElementById('questions-t3');
    container.innerHTML = '';
    
    t3_data.forEach((item, i) => {
        const qid = `t3-q${i}`;
        
        let optionsHtml = '';
        item.options.forEach((option, optIndex) => {
            optionsHtml += `<button class="option-btn" onclick="selectOption('${qid}', '${option}')" id="${qid}-opt${optIndex}">${option}</button>`;
        });
        
        container.innerHTML += `
            <div class="question-row">
                <strong>${i+1}</strong> <span class="sentence-text">
                    ${item.q}
                    <div class="option-container">
                        ${optionsHtml}
                    </div>
                </span>
                <div class="row-btns">
                    <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')">👁️</button>
                    <button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')">i</button>
                </div>
                <div class="hint-box" id="${qid}-hint">💡 ${item.hint}</div>
            </div>`;
    });
}

function renderTask4() {
    const bankContainer = document.getElementById('bank-t4');
    const questionContainer = document.getElementById('questions-t4');
    
    bankContainer.innerHTML = '';
    wordUsageCount['t4'] = {};
    
    t4_wordBank.forEach((word, i) => {
        const wordId = `t4-word-${i}`;
        bankContainer.innerHTML += `
            <div class="word-item" id="${wordId}" data-word="${word.toLowerCase()}" draggable="true" ondragstart="dragWord(event)" onclick="selectWordFromBank('${wordId}')">
                ${word.toLowerCase()}
            </div>`;
        wordUsageCount['t4'][word.toLowerCase()] = 0;
    });
    
    questionContainer.innerHTML = '';
    
    t4_data.forEach((item, i) => {
        const qid = `t4-q${i}`;
        questionContainer.innerHTML += `
            <div class="question-row">
                <strong>${i+1}</strong> ${item.q}
                <input type="text" class="word-input" id="${qid}" data-type="input" data-ans="${item.ans}" oninput="adjustWidth(this); updateWordBank('t4')" ondrop="dropWord(event, '${qid}')" ondragover="allowDrop(event)" onclick="this.select()">
                <div class="row-btns">
                    <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')">👁️</button>
                    <button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')">i</button>
                </div>
                <div class="hint-box" id="${qid}-hint">💡 ${item.hint}</div>
            </div>`;
    });
    
    addWordBankEventListeners('t4');
}

function renderTask5() {
    const container = document.getElementById('questions-t5');
    container.innerHTML = '';
    
    t5_data.forEach((item, i) => {
        const qid = `t5-q${i}`;
        container.innerHTML += `
            <tr>
                <td><strong>${i+1}</strong> ${item.list}</td>
                <td>
                    <input type="text" class="word-input" id="${qid}-odd" data-type="input" data-ans="${item.odd}" oninput="adjustWidth(this)">
                    <div class="row-btns">
                        <button class="btn-small" id="${qid}-odd-eye" onclick="toggleSingleAns('${qid}-odd')">👁️</button>
                        <button class="info-btn" id="${qid}-odd-info" onclick="toggleHint('${qid}-odd')">i</button>
                    </div>
                    <div class="hint-box" id="${qid}-odd-hint">💡 ${item.hint}</div>
                </td>
                <td>
                    <input type="text" class="word-input" id="${qid}-new" data-type="input" data-ans="${item.newWord}" oninput="adjustWidth(this)">
                    <div class="row-btns">
                        <button class="btn-small" id="${qid}-new-eye" onclick="toggleSingleAns('${qid}-new')">👁️</button>
                    </div>
                </td>
            </tr>`;
    });
}

function renderTask6() {
    const container = document.getElementById('questions-t6');
    container.innerHTML = '';
    
    t6_data.forEach((item, i) => {
        const qid = `t6-q${i}`;
        
        if (item.showInput === false) {
            container.innerHTML += `
                <div class="question-row">
                    <strong>${i+1}</strong> ${item.q}
                </div>`;
        } else {
            container.innerHTML += `
                <div class="question-row">
                    <strong>${i+1}</strong> ${item.q.split('______')[0]}
                    <input type="text" class="word-input" id="${qid}" data-type="input" data-ans="${item.ans}" oninput="adjustWidth(this)">
                    ${item.q.split('______')[1] || ''}
                    <div class="row-btns">
                        <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')">👁️</button>
                        <button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')">i</button>
                    </div>
                    <div class="hint-box" id="${qid}-hint">💡 ${item.hint}</div>
                </div>`;
        }
    });
}

function renderTask7() {
    const container = document.getElementById('questions-t7');
    container.innerHTML = '';
    
    t7_data.forEach((item, i) => {
        const qid = `t7-q${i}`;
        container.innerHTML += `
            <div class="question-row">
                <strong>${i+1}</strong> ${item.q.split('______')[0]}
                <input type="text" class="word-input" id="${qid}" data-type="input" data-ans="${item.ans}" oninput="adjustWidth(this)">
                ${item.q.split('______')[1] || ''}
                <div class="row-btns">
                    <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')">👁️</button>
                    <button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')">i</button>
                </div>
                <div class="hint-box" id="${qid}-hint">💡 ${item.hint}</div>
            </div>`;
    });
}

function renderTask8() {
    const container = document.getElementById('questions-t8');
    container.innerHTML = '';
    
    t8_data.forEach((item, i) => {
        const qid = `t8-q${i}`;
        
        let optionsHtml = '';
        item.options.forEach((option, optIndex) => {
            optionsHtml += `<button class="option-btn" onclick="selectOption('${qid}', '${option}')" id="${qid}-opt${optIndex}">${option}</button>`;
        });
        
        container.innerHTML += `
            <div class="question-row">
                <strong>${i+1}</strong> <span class="sentence-text">
                    ${item.q}
                    <div class="option-container">
                        ${optionsHtml}
                    </div>
                </span>
                <div class="row-btns">
                    <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')">👁️</button>
                    <button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')">i</button>
                </div>
                <div class="hint-box" id="${qid}-hint">💡 ${item.hint}</div>
            </div>`;
    });
}

function renderTask9() {
    const container = document.getElementById('questions-t9');
    container.innerHTML = '';
    
    t9_data.forEach((item, i) => {
        const qid = `t9-q${i}`;
        
        let optionsHtml = '';
        item.options.forEach((option, optIndex) => {
            optionsHtml += `<button class="option-btn" onclick="selectOption('${qid}', '${option}')" id="${qid}-opt${optIndex}">${option}</button>`;
        });
        
        container.innerHTML += `
            <div class="question-row">
                <strong>${i+1}</strong> <span class="sentence-text">
                    ${item.q}
                    <div class="option-container">
                        ${optionsHtml}
                    </div>
                </span>
                <div class="row-btns">
                    <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')">👁️</button>
                    <button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')">i</button>
                </div>
                <div class="hint-box" id="${qid}-hint">💡 ${item.hint}</div>
            </div>`;
    });
}

function renderTask10() {
    const container = document.getElementById('questions-t10');
    container.innerHTML = '';
    
    t10_data.forEach((item, i) => {
        const qid = `t10-q${i}`;
        
        let optionsHtml = '';
        item.options.forEach((option, optIndex) => {
            optionsHtml += `<button class="option-btn" onclick="selectOption('${qid}', '${option}')" id="${qid}-opt${optIndex}">${option}</button>`;
        });
        
        container.innerHTML += `
            <div class="question-row">
                <strong>${i+1}</strong> <span class="sentence-text">
                    ${item.q}
                    <div class="option-container">
                        ${optionsHtml}
                    </div>
                </span>
                <div class="row-btns">
                    <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')">👁️</button>
                    <button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')">i</button>
                </div>
                <div class="hint-box" id="${qid}-hint">💡 ${item.hint}</div>
            </div>`;
    });
}

function renderTask11() {
    const questionsContainer = document.getElementById('reading-questions-t11');
    questionsContainer.innerHTML = '';
    
    t11_data.forEach((item, i) => {
        const qid = `t11-q${i}`;
        const optionLetters = ['A', 'B', 'C', 'D'];
        
        let optionsHtml = '<div class="mcq-options-container">';
        item.options.forEach((option, optIndex) => {
            const letter = optionLetters[optIndex];
            optionsHtml += `
                <div class="mcq-option" id="${qid}-option-${optIndex}" onclick="selectReadingOption('${qid}', ${optIndex})">
                    <span class="option-letter">${letter}</span>
                    <span class="option-text">${option}</span>
                </div>`;
        });
        optionsHtml += '</div>';
        
        questionsContainer.innerHTML += `
            <div class="mcq-question" id="${qid}-container">
                <p><strong>${item.question}</strong></p>
                ${optionsHtml}
                <div class="row-btns" style="margin-top: 10px;">
                    <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')">👁️</button>
                    <button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')">i</button>
                </div>
                <div class="hint-box" id="${qid}-hint">💡 ${item.hint}</div>
            </div>`;
    });
}

function renderTask12() {
    const container = document.getElementById('questions-t12');
    container.innerHTML = '';
    
    t12_data.forEach((item, i) => {
        const qid = `t12-q${i}`;
        container.innerHTML += `
            <div class="question-row">
                <strong>${i+1}</strong> ${item.q}
                <input type="text" class="word-input" id="${qid}" data-type="input" data-ans="${item.ans}" oninput="adjustWidth(this)">
                <div class="row-btns">
                    <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')">👁️</button>
                    <button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')">i</button>
                </div>
                <div class="hint-box" id="${qid}-hint">💡 ${item.hint}</div>
            </div>`;
    });
}

function renderTask13() {
    const container = document.getElementById('questions-t13');
    container.innerHTML = '';
    
    t13_data.forEach((item, i) => {
        const qid = `t13-q${i}`;
        
        let optionsHtml = '';
        item.options.forEach((option, optIndex) => {
            optionsHtml += `<button class="option-btn" onclick="selectOption('${qid}', '${option}')" id="${qid}-opt${optIndex}">${option}</button>`;
        });
        
        container.innerHTML += `
            <div class="question-row">
                <strong>${i+1}</strong> <span class="sentence-text">
                    ${item.q}
                    <div class="option-container">
                        ${optionsHtml}
                    </div>
                </span>
                <div class="row-btns">
                    <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')">👁️</button>
                    <button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')">i</button>
                </div>
                <div class="hint-box" id="${qid}-hint">💡 ${item.hint}</div>
            </div>`;
    });
}

function renderTask14() {
    const container = document.getElementById('questions-t14');
    container.innerHTML = '';
    
    t14_data.forEach((item, i) => {
        const qid = `t14-q${i}`;
        container.innerHTML += `
            <div class="question-row">
                <strong>${i+1}</strong> ${item.q}
                <input type="text" class="word-input" id="${qid}" data-type="input" data-ans="${item.ans}" oninput="adjustWidth(this)">
                <div class="row-btns">
                    <button class="btn-small" id="${qid}-eye" onclick="toggleSingleAns('${qid}')">👁️</button>
                    <button class="info-btn" id="${qid}-info" onclick="toggleHint('${qid}')">i</button>
                </div>
                <div class="hint-box" id="${qid}-hint">💡 ${item.hint}</div>
            </div>`;
    });
}

// Helper functions
function adjustWidth(el) { 
    let baseWidth;
    if (el.classList.contains('letter-input')) {
        baseWidth = 45;
    } else if (el.classList.contains('word-input')) {
        baseWidth = 120;
    } else {
        baseWidth = 60;
    }
    
    const charWidth = el.classList.contains('word-input') ? 9 : 10;
    const newWidth = Math.max(el.value.length * charWidth + 20, baseWidth);
    
    let maxWidth;
    if (el.classList.contains('letter-input')) {
        maxWidth = 80;
    } else if (el.classList.contains('word-input')) {
        maxWidth = 400;
    } else {
        maxWidth = 300;
    }
    
    el.style.width = Math.min(newWidth, maxWidth) + "px";
}

function toggleHint(id) { 
    const h = document.getElementById(id + '-hint'); 
    const infoBtn = document.getElementById(id + '-info');
    
    if (h) {
        if (h.style.display === 'block') {
            h.style.display = 'none';
            if (infoBtn) infoBtn.classList.remove('active');
        } else {
            h.style.display = 'block';
            if (infoBtn) infoBtn.classList.add('active');
        }
    }
}

function toggleSingleAns(id) { 
    const qid = id.replace('-eye', '');
    
    // Check if this is a reading question
    if (qid.startsWith('t11-q')) {
        const questionIndex = parseInt(qid.split('-q')[1]);
        const questionData = t11_data[questionIndex];
        const correctAnswerIndex = questionData.correct;
        
        // Highlight the correct option
        const options = document.querySelectorAll(`#${qid}-container .mcq-option`);
        options.forEach((option, index) => {
            option.classList.remove('correct', 'incorrect', 'selected');
            if (index === correctAnswerIndex) {
                option.classList.add('correct');
            }
        });
        
        const eyeBtn = document.getElementById(id);
        if (eyeBtn) eyeBtn.classList.add('active');
        answerStates.set(`${qid}-state`, true);
        return;
    }
    
    // Check if this is an option-based question
    if (qid.startsWith('t3-q') || qid.startsWith('t8-q') || qid.startsWith('t9-q') || qid.startsWith('t10-q') || qid.startsWith('t13-q')) {
        const questionIndex = parseInt(qid.split('-q')[1]);
        let data;
        
        if (qid.startsWith('t3-q')) data = t3_data;
        else if (qid.startsWith('t8-q')) data = t8_data;
        else if (qid.startsWith('t9-q')) data = t9_data;
        else if (qid.startsWith('t10-q')) data = t10_data;
        else data = t13_data;
        
        const questionData = data[questionIndex];
        const correctAnswer = questionData.ans;
        
        const optionButtons = [];
        for (let i = 0; i < questionData.options.length; i++) {
            const btn = document.getElementById(`${qid}-opt${i}`);
            if (btn) optionButtons.push(btn);
        }
        
        const stateKey = `${qid}-state`;
        const isCurrentlyShown = answerStates.get(stateKey) || false;
        
        if (isCurrentlyShown) {
            optionButtons.forEach(btn => {
                btn.classList.remove('correct-option', 'incorrect-option');
                const userSelection = optionSelections.get(qid);
                if (userSelection && btn.textContent === userSelection) {
                    btn.classList.add('selected');
                }
            });
            
            const eyeBtn = document.getElementById(id);
            if (eyeBtn) eyeBtn.classList.remove('active');
            answerStates.set(stateKey, false);
        } else {
            optionButtons.forEach(btn => {
                btn.classList.remove('selected', 'correct-option', 'incorrect-option');
                if (correctAnswer.includes(',')) {
                    const correctAnswers = correctAnswer.split(',').map(a => a.trim());
                    if (correctAnswers.some(ans => btn.textContent.includes(ans))) {
                        btn.classList.add('correct-option');
                    }
                } else if (btn.textContent === correctAnswer) {
                    btn.classList.add('correct-option');
                }
            });
            
            const eyeBtn = document.getElementById(id);
            if (eyeBtn) eyeBtn.classList.add('active');
            answerStates.set(stateKey, true);
        }
        return;
    }
    
    // Regular input-based questions
    const el = document.getElementById(qid);
    if (!el) return;
    
    const ans = el.dataset.ans;
    const eyeBtn = document.getElementById(id);
    const stateKey = `${qid}-state`;
    const isCurrentlyShown = answerStates.get(stateKey) || false;
    
    if (isCurrentlyShown) {
        el.value = "";
        el.classList.remove('correct', 'incorrect-marked');
        adjustWidth(el);
        if (eyeBtn) eyeBtn.classList.remove('active');
        answerStates.set(stateKey, false);
    } else {
        if (ans) {
            el.value = ans;
            el.classList.add('correct');
            el.classList.remove('incorrect-marked');
            adjustWidth(el);
            if (eyeBtn) eyeBtn.classList.add('active');
            answerStates.set(stateKey, true);
        }
    }
}

function selectOption(qid, option) {
    const questionIndex = parseInt(qid.split('-q')[1]);
    let data;
    
    if (qid.startsWith('t3-q')) data = t3_data;
    else if (qid.startsWith('t8-q')) data = t8_data;
    else if (qid.startsWith('t9-q')) data = t9_data;
    else if (qid.startsWith('t10-q')) data = t10_data;
    else if (qid.startsWith('t13-q')) data = t13_data;
    else return;
    
    const questionData = data[questionIndex];
    
    const optionButtons = [];
    for (let i = 0; i < questionData.options.length; i++) {
        const btn = document.getElementById(`${qid}-opt${i}`);
        if (btn) optionButtons.push(btn);
    }
    
    optionButtons.forEach(btn => {
        btn.classList.remove('selected');
    });
    
    const selectedBtn = optionButtons.find(btn => btn.textContent === option);
    if (selectedBtn) {
        selectedBtn.classList.add('selected');
    }
    
    optionSelections.set(qid, option);
}

function selectReadingOption(qid, optionIndex) {
    const questionIndex = parseInt(qid.split('-q')[1]);
    const questionData = t11_data[questionIndex];
    
    // Remove selected class from all options
    const options = document.querySelectorAll(`#${qid}-container .mcq-option`);
    options.forEach(option => {
        option.classList.remove('selected');
    });
    
    // Add selected class to clicked option
    const selectedOption = document.getElementById(`${qid}-option-${optionIndex}`);
    if (selectedOption) {
        selectedOption.classList.add('selected');
    }
    
    readingSelections.set(qid, optionIndex);
}

function showAnswers(prefix) { 
    if (prefix === 't11') {
        // Handle reading questions - CHỈ HIỆN ĐÁP ÁN ĐÚNG KHI NHẤN SHOW ALL
        t11_data.forEach((item, i) => {
            const qid = `${prefix}-q${i}`;
            const correctIndex = item.correct;
            
            // Highlight correct answer
            const options = document.querySelectorAll(`#${qid}-container .mcq-option`);
            options.forEach((option, index) => {
                option.classList.remove('correct', 'incorrect', 'selected');
                if (index === correctIndex) {
                    option.classList.add('correct');
                }
            });
            
            const eyeBtn = document.getElementById(`${qid}-eye`);
            if (eyeBtn) eyeBtn.classList.add('active');
            answerStates.set(`${qid}-state`, true);
        });
        return;
    }
    
    if (prefix === 't2') {
        // Handle paragraph exercise
        for (let i = 0; i < 10; i++) {
            const inputId = `t2-q${i}`;
            const input = document.getElementById(inputId);
            if (input) {
                const ans = input.dataset.ans;
                input.value = ans;
                input.classList.add('correct');
                input.classList.remove('incorrect');
            }
        }
        return;
    }
    
    if (prefix === 't3' || prefix === 't8' || prefix === 't9' || prefix === 't10' || prefix === 't13') {
        let data;
        if (prefix === 't3') data = t3_data;
        else if (prefix === 't8') data = t8_data;
        else if (prefix === 't9') data = t9_data;
        else if (prefix === 't10') data = t10_data;
        else data = t13_data;
        
        data.forEach((item, i) => {
            const qid = `${prefix}-q${i}`;
            const correctAnswer = item.ans;
            
            const optionButtons = [];
            for (let j = 0; j < item.options.length; j++) {
                const btn = document.getElementById(`${qid}-opt${j}`);
                if (btn) optionButtons.push(btn);
            }
            
            optionButtons.forEach(btn => {
                btn.classList.remove('selected', 'correct-option', 'incorrect-option');
                if (correctAnswer.includes(',')) {
                    const correctAnswers = correctAnswer.split(',').map(a => a.trim());
                    if (correctAnswers.some(ans => btn.textContent.includes(ans))) {
                        btn.classList.add('correct-option');
                    }
                } else if (btn.textContent === correctAnswer) {
                    btn.classList.add('correct-option');
                }
            });
            
            const eyeBtn = document.getElementById(`${qid}-eye`);
            if (eyeBtn) eyeBtn.classList.add('active');
            answerStates.set(`${qid}-state`, true);
        });
        return;
    }
    
    document.querySelectorAll(`[id^="${prefix}-"]`).forEach(el => {
        if (el.dataset && el.dataset.type === 'input') {
            const ans = el.dataset.ans;
            const eyeBtn = document.getElementById(el.id + '-eye');
            
            if (ans) {
                el.value = ans;
                el.classList.add('correct');
                el.classList.remove('incorrect-marked');
                adjustWidth(el);
                if (eyeBtn) eyeBtn.classList.add('active');
                
                answerStates.set(`${el.id}-state`, true);
            }
        }
    });
}

function resetSection(prefix) { 
    if (prefix === 't2') {
        // Reset paragraph exercise
        for (let i = 0; i < 10; i++) {
            const inputId = `t2-q${i}`;
            const input = document.getElementById(inputId);
            if (input) {
                input.value = "";
                input.classList.remove('correct', 'incorrect');
            }
        }
        return;
    }
    
    document.querySelectorAll(`[id^="${prefix}"]`).forEach(i => { 
        if(i.tagName === 'INPUT') { 
            i.value = ""; 
            i.classList.remove('correct', 'incorrect-marked'); 
            adjustWidth(i); 
            
            answerStates.delete(`${i.id}-state`);
        } 
        
        const hBox = document.getElementById(i.id + '-hint'); 
        if(hBox) hBox.style.display = 'none'; 
    });
    
    document.querySelectorAll(`[id$="-eye"], [id$="-info"]`).forEach(btn => {
        if (btn.id.includes(prefix)) {
            btn.classList.remove('active');
        }
    });
    
    if (prefix === 't3' || prefix === 't8' || prefix === 't9' || prefix === 't10' || prefix === 't13') {
        const allOptionBtns = document.querySelectorAll(`#questions-${prefix} .option-btn`);
        
        allOptionBtns.forEach(btn => {
            btn.classList.remove('selected', 'correct-option', 'incorrect-option');
            btn.style.cssText = '';
            btn.style.background = '';
            btn.style.backgroundColor = '';
            btn.style.color = '';
            btn.style.borderColor = '';
            btn.style.border = '';
        });
        
        for (const [key, value] of optionSelections.entries()) {
            if (key.startsWith(`${prefix}-`)) {
                optionSelections.delete(key);
            }
        }
        
        document.querySelectorAll(`#questions-${prefix} .btn-small[id$="-eye"]`).forEach(eyeBtn => {
            eyeBtn.classList.remove('active');
        });
        
        for (const [key, value] of answerStates.entries()) {
            if (key.includes(`${prefix}-q`)) {
                answerStates.delete(key);
            }
        }
    }
    
    if (prefix === 't11') {
        // Reset reading questions
        const options = document.querySelectorAll(`#reading-questions-${prefix} .mcq-option`);
        options.forEach(option => {
            option.classList.remove('selected', 'correct', 'incorrect');
        });
        
        readingSelections.clear();
        
        document.querySelectorAll(`#reading-questions-${prefix} .btn-small[id$="-eye"]`).forEach(eyeBtn => {
            eyeBtn.classList.remove('active');
        });
        
        for (const [key, value] of answerStates.entries()) {
            if (key.includes(`${prefix}-q`)) {
                answerStates.delete(key);
            }
        }
    }
    
    if (prefix === 't1' || prefix === 't4') {
        const wordItems = document.querySelectorAll(`#bank-${prefix} .word-item`);
        wordItems.forEach(item => {
            item.classList.remove('used');
        });
        
        if (wordUsageCount[prefix]) {
            Object.keys(wordUsageCount[prefix]).forEach(word => {
                wordUsageCount[prefix][word] = 0;
            });
        }
    }
    
    Object.keys(hintVisible).forEach(key => {
        if (key.startsWith(prefix)) {
            hintVisible[key] = false;
            const hint = document.getElementById(`hint-${key}`);
            if (hint) hint.style.display = 'none';
        }
    });
}

function normalizeAnswer(answer) {
    return answer.toLowerCase()
        .trim()
        .replace(/\s+/g, ' ')
        .replace(/[.,;:!?]$/, '');
}

function validateMultipleAnswers(userAnswer, correctAnswers) {
    const answers = correctAnswers.split('|').map(ans => normalizeAnswer(ans));
    const normalizedUser = normalizeAnswer(userAnswer);
    
    return answers.some(ans => ans === normalizedUser);
}

function checkAll() { 
    // Check paragraph exercise (Task 2)
    for (let i = 0; i < 10; i++) {
        const inputId = `t2-q${i}`;
        const input = document.getElementById(inputId);
        if (input) {
            const userAnswer = input.value.trim();
            const correctAnswer = input.dataset.ans;
            
            input.classList.remove('correct', 'incorrect');
            
            if (userAnswer) {
                if (normalizeAnswer(userAnswer) === normalizeAnswer(correctAnswer)) {
                    input.classList.add('correct');
                } else {
                    input.classList.add('incorrect');
                }
            }
        }
    }
    
    // Check all input-based questions
    document.querySelectorAll('[data-type="input"]').forEach(el => { 
        const correctAnswers = el.dataset.ans;
        const userAnswer = el.value;
        
        el.classList.remove('correct', 'incorrect-marked'); 
        
        if(!userAnswer.trim()) {
            return;
        }
        
        if(validateMultipleAnswers(userAnswer, correctAnswers)) {
            el.classList.add('correct');
        } else {
            el.classList.add('incorrect-marked');
        }
    });
    
    // Check option-based questions
    ['t3', 't8', 't9', 't10', 't13'].forEach(taskId => {
        let data;
        if (taskId === 't3') data = t3_data;
        else if (taskId === 't8') data = t8_data;
        else if (taskId === 't9') data = t9_data;
        else if (taskId === 't10') data = t10_data;
        else data = t13_data;
        
        data.forEach((item, i) => {
            const qid = `${taskId}-q${i}`;
            const selectedOption = optionSelections.get(qid);
            const correctAnswer = item.ans;
            
            if (!selectedOption) {
                return;
            }
            
            const optionButtons = [];
            for (let j = 0; j < item.options.length; j++) {
                const btn = document.getElementById(`${qid}-opt${j}`);
                if (btn) optionButtons.push(btn);
            }
            
            optionButtons.forEach(btn => {
                btn.classList.remove('correct-option', 'incorrect-option');
            });
            
            const userSelectedBtn = optionButtons.find(btn => btn.textContent === selectedOption);
            if (userSelectedBtn) {
                if (correctAnswer.includes(',')) {
                    const correctAnswers = correctAnswer.split(',').map(a => a.trim());
                    if (correctAnswers.some(ans => selectedOption.includes(ans))) {
                        userSelectedBtn.classList.add('correct-option');
                    } else {
                        userSelectedBtn.classList.add('incorrect-option');
                    }
                } else if (selectedOption === correctAnswer) {
                    userSelectedBtn.classList.add('correct-option');
                } else {
                    userSelectedBtn.classList.add('incorrect-option');
                }
            }
        });
    });
    
    // Check reading questions - ĐÂY LÀ PHẦN QUAN TRỌNG: CHỈ HIỆN ĐÚNG/SAI, KHÔNG HIỆN ĐÁP ÁN ĐÚNG
    t11_data.forEach((item, i) => {
        const qid = `t11-q${i}`;
        const userSelection = readingSelections.get(qid);
        const correctIndex = item.correct;
        
        const options = document.querySelectorAll(`#${qid}-container .mcq-option`);
        options.forEach((option, index) => {
            option.classList.remove('correct', 'incorrect', 'selected');
            
            if (userSelection !== undefined) {
                if (index === userSelection) {
                    if (userSelection === correctIndex) {
                        option.classList.add('correct');
                    } else {
                        option.classList.add('incorrect');
                    }
                }
            }
        });
    });
}

// Word bank functionality
function addWordBankEventListeners(id) {
    const wordItems = document.querySelectorAll(`#bank-${id} .word-item`);
    const inputs = document.querySelectorAll(`#questions-${id} input.word-input`);
    
    wordItems.forEach(item => {
        item.addEventListener('click', function() {
            selectWordFromBank(this.id);
        });
        
        item.addEventListener('dragstart', function(e) {
            dragWord(e);
        });
    });
    
    inputs.forEach(input => {
        input.addEventListener('dragover', function(e) {
            allowDrop(e);
        });
        
        input.addEventListener('drop', function(e) {
            dropWord(e, this.id);
        });
    });
}

function dragWord(event) {
    event.dataTransfer.setData("text/plain", event.target.dataset.word);
    event.dataTransfer.setData("wordId", event.target.id);
}

function allowDrop(event) {
    event.preventDefault();
}

function dropWord(event, inputId) {
    event.preventDefault();
    const word = event.dataTransfer.getData("text/plain");
    const wordId = event.dataTransfer.getData("wordId");
    
    const input = document.getElementById(inputId);
    if (input) {
        input.value = word;
        adjustWidth(input);
        
        const taskId = wordId.split('-')[1];
        updateWordBankUsage(word, `t${taskId}`);
    }
}

function selectWordFromBank(wordId) {
    const wordItem = document.getElementById(wordId);
    if (!wordItem || wordItem.classList.contains('used')) return;
    
    const word = wordItem.dataset.word;
    const taskId = wordId.split('-')[1];
    
    const inputs = document.querySelectorAll(`#questions-t${taskId} input.word-input`);
    let emptyInput = null;
    
    for (const input of inputs) {
        if (!input.value.trim()) {
            emptyInput = input;
            break;
        }
    }
    
    if (emptyInput) {
        emptyInput.value = word;
        adjustWidth(emptyInput);
        
        updateWordBankUsage(word, `t${taskId}`);
    } else {
        alert('All gaps are filled. You can click on a gap to replace its content.');
    }
}

function updateWordBankUsage(word, taskId) {
    if (!wordUsageCount[taskId]) {
        wordUsageCount[taskId] = {};
    }
    
    if (!wordUsageCount[taskId][word]) {
        wordUsageCount[taskId][word] = 0;
    }
    
    const inputs = document.querySelectorAll(`#questions-${taskId} input.word-input`);
    let count = 0;
    
    inputs.forEach(input => {
        if (normalizeAnswer(input.value) === normalizeAnswer(word)) {
            count++;
        }
    });
    
    wordUsageCount[taskId][word] = count;
    
    updateWordBankDisplay(taskId);
}

function updateWordBankDisplay(taskId) {
    const wordItems = document.querySelectorAll(`#bank-${taskId} .word-item`);
    
    wordItems.forEach(item => {
        const word = item.dataset.word;
        const count = wordUsageCount[taskId][word] || 0;
        
        if (count > 0) {
            item.classList.add('used');
        } else {
            item.classList.remove('used');
        }
    });
}

function updateWordBank(taskId) {
    const inputs = document.querySelectorAll(`#questions-${taskId} input.word-input`);
    
    if (wordUsageCount[taskId]) {
        Object.keys(wordUsageCount[taskId]).forEach(word => {
            wordUsageCount[taskId][word] = 0;
        });
    }
    
    inputs.forEach(input => {
        const word = input.value.trim().toLowerCase();
        if (word) {
            if (wordUsageCount[taskId][word] !== undefined) {
                wordUsageCount[taskId][word]++;
            }
        }
    });
    
    updateWordBankDisplay(taskId);
}

// Reading panel resizer
function initializeResizer() {
    const resizer = document.getElementById('resizer-t11');
    const leftPanel = document.getElementById('text-panel-t11');
    const rightPanel = document.getElementById('questions-panel-t11');
    
    if (!resizer || !leftPanel || !rightPanel) return;
    
    // Set initial widths (50% each)
    leftPanel.style.width = '50%';
    rightPanel.style.flex = '1';
    
    let isResizing = false;
    let startX = 0;
    let startLeftWidth = 0;
    let startRightWidth = 0;
    
    resizer.addEventListener('mousedown', function(e) {
        isResizing = true;
        startX = e.clientX;
        startLeftWidth = leftPanel.offsetWidth;
        startRightWidth = rightPanel.offsetWidth;
        
        document.body.style.cursor = 'col-resize';
        document.body.style.userSelect = 'none';
        
        document.addEventListener('mousemove', handleMouseMove);
        document.addEventListener('mouseup', handleMouseUp);
    });
    
    function handleMouseMove(e) {
        if (!isResizing) return;
        
        const dx = e.clientX - startX;
        const newLeftWidth = startLeftWidth + dx;
        
        const containerWidth = leftPanel.parentElement.offsetWidth;
        const minWidth = 200;
        const maxWidth = containerWidth - minWidth - resizer.offsetWidth;
        
        if (newLeftWidth >= minWidth && newLeftWidth <= maxWidth) {
            leftPanel.style.width = newLeftWidth + 'px';
            rightPanel.style.flex = '1';
        }
    }
    
    function handleMouseUp() {
        isResizing = false;
        document.body.style.cursor = '';
        document.body.style.userSelect = '';
        
        document.removeEventListener('mousemove', handleMouseMove);
        document.removeEventListener('mouseup', handleMouseUp);
    }
}

// Text highlighting functionality
function initializeTextHighlighting() {
    contextMenu = document.getElementById('context-menu');
    const highlightBtn = document.getElementById('highlight-text');
    const removeHighlightBtn = document.getElementById('remove-highlight');
    const clearHighlightsBtn = document.getElementById('clear-highlights');
    
    // Context menu for text highlighting
    document.addEventListener('contextmenu', function(e) {
        const selection = window.getSelection();
        if (selection.toString().trim() && 
            (e.target.closest('.reading-text') || e.target.closest('.text-panel'))) {
            selectedTextRange = saveSelection();
            
            contextMenu.style.display = 'block';
            contextMenu.style.left = e.pageX + 'px';
            contextMenu.style.top = e.pageY + 'px';
            
            e.preventDefault();
        } else {
            contextMenu.style.display = 'none';
        }
    });
    
    // Hide context menu when clicking elsewhere
    document.addEventListener('click', function(e) {
        if (contextMenu && !contextMenu.contains(e.target)) {
            contextMenu.style.display = 'none';
        }
    });
    
    // Highlight selected text
    if (highlightBtn) {
        highlightBtn.addEventListener('click', function() {
            if (selectedTextRange) {
                highlightSelection(selectedTextRange);
                contextMenu.style.display = 'none';
            }
        });
    }
    
    // Remove highlight from selected text
    if (removeHighlightBtn) {
        removeHighlightBtn.addEventListener('click', function() {
            if (selectedTextRange) {
                removeHighlightFromSelection(selectedTextRange);
                contextMenu.style.display = 'none';
            }
        });
    }
    
    // Clear all highlights
    if (clearHighlightsBtn) {
        clearHighlightsBtn.addEventListener('click', function() {
            clearAllHighlights();
            contextMenu.style.display = 'none';
        });
    }
}

function saveSelection() {
    const selection = window.getSelection();
    if (selection.rangeCount === 0) return null;
    
    return selection.getRangeAt(0).cloneRange();
}

function highlightSelection(range) {
    if (!range) return;
    
    const span = document.createElement('span');
    span.className = 'highlighted-text';
    
    try {
        range.surroundContents(span);
    } catch(e) {
        // If the range selects partially across nodes, we need a different approach
        const div = document.createElement('div');
        div.innerHTML = range.toString();
        span.innerHTML = div.innerHTML;
        range.deleteContents();
        range.insertNode(span);
    }
    
    const selection = window.getSelection();
    selection.removeAllRanges();
}

function removeHighlightFromSelection(range) {
    if (!range) return;
    
    const parent = range.commonAncestorContainer;
    const highlightSpans = parent.parentElement.querySelectorAll('.highlighted-text');
    
    highlightSpans.forEach(span => {
        if (range.intersectsNode(span)) {
            const parent = span.parentNode;
            while (span.firstChild) {
                parent.insertBefore(span.firstChild, span);
            }
            parent.removeChild(span);
        }
    });
    
    const selection = window.getSelection();
    selection.removeAllRanges();
}

function clearAllHighlights() {
    const highlights = document.querySelectorAll('.highlighted-text');
    highlights.forEach(highlight => {
        const parent = highlight.parentNode;
        while (highlight.firstChild) {
            parent.insertBefore(highlight.firstChild, highlight);
        }
        parent.removeChild(highlight);
    });
}

// Initialize everything when page loads
window.onload = () => {
    renderTask1();
    renderTask3();
    renderTask4();
    renderTask5();
    renderTask6();
    renderTask7();
    renderTask8();
    renderTask9();
    renderTask10();
    renderTask11();
    renderTask12();
    renderTask13();
    renderTask14();
    initializeResizer();
    initializeTextHighlighting();
};

// Check all answers with Enter key
document.addEventListener('keydown', e => { 
    if(e.key === 'Enter') {
        checkAll(); 
    }
});
</script>
</body>

</html>
